# ูุธุงู ุงูุฃุตูู ูุงูุตูุงูุฉ ุงูููุญุฏ (Unified Assets & Maintenance System)

> **ุขุฎุฑ ุชุญุฏูุซ:** 16 ุฏูุณูุจุฑ 2025
> **ุงูุญุงูุฉ:** ุชุตููู ููุงุฆู
> **ููุงุญุธุฉ:** ุชู ุฏูุฌ ููู 03 (ูุธุงู ุงูุฃุตูู) ูุน ููู 05 (ุงูุฃุตูู ูุงูุตูุงูุฉ) ูู ููู ูุงุญุฏ ุดุงูู

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงูุฃุตูู ูุงูุตูุงูุฉ ุงูููุญุฏ ูุฏูุฑ:
1. **ุงูุฃุตูู ุงููููุฉ** - ุงููุญุทุงุชุ ุงููููุฏุงุชุ ุงูุฃููุงุญ ุงูุดูุณูุฉุ ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ
2. **ุงูุฃุตูู ุงููุญุงุณุจูุฉ** - ุงูุชุณุฌููุ ุงูุฅููุงูุ ุงููููุฉ ุงูุฏูุชุฑูุฉ
3. **ุงูุตูุงูุฉ** - ุงูููุงุฆูุฉ ูุงูุทุงุฑุฆุฉ
4. **ุงูููุงุฑุฏ** - ุงููููููุ ูุทุน ุงูุบูุงุฑ

---

## ๐๏ธ ูููู ุงููุธุงู ุงูููุญุฏ

```
ูุธุงู ุงูุฃุตูู ูุงูุตูุงูุฉ ุงูููุญุฏ
โ
โโโ ุงูุฌุฒุก ุงูุฃูู: ุงูุฃุตูู ุงููููุฉ (ูู ููู 03)
โ   โโโ 1๏ธโฃ ุงููุญุทุงุช (Stations)
โ   โ   โโโ ุงููููุฏุงุช
โ   โ   โโโ ููุญุงุช ุงูุชุญูู
โ   โ   โโโ ุงููุญููุงุช
โ   โ
โ   โโโ 2๏ธโฃ ูุญุทุงุช ุงูุทุงูุฉ ุงูุดูุณูุฉ (Solar)
โ   โ   โโโ ุงูุฃููุงุญ ุงูุดูุณูุฉ
โ   โ   โโโ ุงูุงููุฑุชุฑุงุช
โ   โ   โโโ ุงูุจุทุงุฑูุงุช
โ   โ
โ   โโโ 3๏ธโฃ ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ (Network)
โ       โโโ ุงูููุงุจู/ุงูุฎุทูุท
โ       โโโ ููุงุท ุงูุงูุชูุงุก
โ       โโโ ุงูููุงุชูุญ/ุงูููุงุทุน
โ       โโโ ุงูุนุฏุงุฏุงุช
โ
โโโ ุงูุฌุฒุก ุงูุซุงูู: ุงูุตูุงูุฉ ูุงููุญุงุณุจุฉ (ูู ููู 05)
    โโโ 4๏ธโฃ ุฅุฏุงุฑุฉ ุงูุฃุตูู ุงููุญุงุณุจูุฉ
    โ   โโโ ุชุณุฌูู ุงูุฃุตูู
    โ   โโโ ุงูุฅููุงู
    โ   โโโ ุงูุฌุฑุฏ
    โ
    โโโ 5๏ธโฃ ุงูุตูุงูุฉ ุงูููุงุฆูุฉ
    โ   โโโ ุฌุฏุงูู ุงูุตูุงูุฉ
    โ   โโโ ุงูุชูููุฐ ูุงููุชุงุจุนุฉ
    โ
    โโโ 6๏ธโฃ ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ
    โ   โโโ ุทูุจุงุช ุงูุตูุงูุฉ
    โ   โโโ ุงูุฅุตูุงุญุงุช
    โ
    โโโ 7๏ธโฃ ุงูููุงุฑุฏ
        โโโ ุงูููููู ูุงูููุงูููู
        โโโ ูุทุน ุงูุบูุงุฑ
```

---

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ุงูุฌุฒุก ุงูุฃูู: ุงูุฃุตูู ุงููููุฉ
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงูุฃุตูู ูุฏูุฑ ุฌููุน ุงูุฃุตูู ุงููุงุฏูุฉ ููุดุจูุฉ ุงูููุฑุจุงุฆูุฉุ ููุณู ุฅูู ุซูุงุซุฉ ุฃูุณุงู ุฑุฆูุณูุฉ:

1. **ุงููุญุทุงุช** (ุงูุชูููุฏ + ุงูุชูุฒูุน)
2. **ูุญุทุงุช ุงูุทุงูุฉ ุงูุดูุณูุฉ**
3. **ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ**

---

## ๐๏ธ ูููู ูุธุงู ุงูุฃุตูู

```
ูุธุงู ุงูุฃุตูู
    โ
    โโโ 1๏ธโฃ ุงููุญุทุงุช (Stations)
    โ   โโโ ุงููููุฏุงุช
    โ   โโโ ููุญุงุช ุงูุชุญูู
    โ   โโโ ุงููุญููุงุช
    โ   โโโ ูุนุฏุงุช ุงูุชูุฒูุน
    โ
    โโโ 2๏ธโฃ ูุญุทุงุช ุงูุทุงูุฉ ุงูุดูุณูุฉ (Solar Stations)
    โ   โโโ ุงูุฃููุงุญ ุงูุดูุณูุฉ
    โ   โโโ ุงูุงููุฑุชุฑุงุช
    โ   โโโ ุงูุจุทุงุฑูุงุช
    โ   โโโ ุฃูุธูุฉ ุงูุชุชุจุน
    โ
    โโโ 3๏ธโฃ ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ (Electrical Network)
        โโโ ุงูููุงุจู/ุงูุฎุทูุท
        โโโ ููุงุท ุงูุงูุชูุงุก
        โโโ ุงูููุงุชูุญ/ุงูููุงุทุน
        โโโ ุงูุนุฏุงุฏุงุช
```

---

# 1๏ธโฃ ุงููุญุทุงุช (Stations)

## ๐ ุชุนุฑูู ุงููุญุทุฉ

ุงููุญุทุฉ ูู ูุญุฏุฉ ุชูููุฏ ูุชูุฒูุน ุงูููุฑุจุงุกุ ุชุญุชูู ุนูู ูููุฏุงุช ููุนุฏุงุช ุชูุฒูุน.

## ๐ง ููููุงุช ุงููุญุทุฉ

### ุฃ) ุงููููุฏุงุช (Generators)

```
ุงููููุฏ
    โ
    โโโ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ:
    โ   โโโ ุงูููุฏ/ุงูุฑูู ุงูุชุณูุณูู
    โ   โโโ ุงูุดุฑูุฉ ุงููุตูุนุฉ
    โ   โโโ ุงูููุฏูู
    โ   โโโ ุณูุฉ ุงูุตูุน
    โ   โโโ ุงููุฏุฑุฉ (KVA/KW)
    โ   โโโ ููุน ุงููููุฏ
    โ
    โโโ ุงูููููุงุช ุงููุฑุนูุฉ:
    โ   โโโ ุงููุญุฑู (Engine)
    โ   โโโ ุงููููุฏ ุงูููุฑุจุงุฆู (Alternator)
    โ   โโโ ููุญุฉ ุงูุชุญูู (Control Panel)
    โ   โโโ ุฎุฒุงู ุงููููุฏ (Fuel Tank)
    โ   โโโ ูุธุงู ุงูุชุจุฑูุฏ (Cooling System)
    โ   โโโ ุงูููุงุชุฑ (Filters)
    โ   โโโ ุงูุจุทุงุฑูุฉ (Battery)
    โ
    โโโ ุงููุฑุงุกุงุช/ุงูุจูุงูุงุช ุงูุญูุฉ:
    โ   โโโ ุณุงุนุงุช ุงูุชุดุบูู
    โ   โโโ ุงุณุชููุงู ุงููููุฏ
    โ   โโโ ุงูุฌูุฏ (Voltage)
    โ   โโโ ุงูุชูุงุฑ (Current)
    โ   โโโ ุงูุชุฑุฏุฏ (Frequency)
    โ   โโโ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ
    โ   โโโ ุถุบุท ุงูุฒูุช
    โ
    โโโ ุณุฌูุงุช:
        โโโ ุณุฌู ุงูุตูุงูุฉ
        โโโ ุณุฌู ุงูุฃุนุทุงู
        โโโ ุณุฌู ูุทุน ุงูุบูุงุฑ
        โโโ ุณุฌู ุงูุชุดุบูู
```

### ุจ) ููุญุงุช ุงูุชุญูู (Control Panels)

```
ููุญุฉ ุงูุชุญูู
    โ
    โโโ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ:
    โ   โโโ ุงูููุฏ
    โ   โโโ ุงูููุน (ุฑุฆูุณูุฉ/ูุฑุนูุฉ)
    โ   โโโ ุงูุณุนุฉ (ุฃูุจูุฑ)
    โ   โโโ ุนุฏุฏ ุงููุฎุงุฑุฌ
    โ
    โโโ ุงูููููุงุช:
    โ   โโโ ุงูููุงุทุน ุงูุฑุฆูุณูุฉ
    โ   โโโ ุงูููุงุทุน ุงููุฑุนูุฉ
    โ   โโโ ุฃุฌูุฒุฉ ุงูููุงุณ
    โ   โโโ ุฃุฌูุฒุฉ ุงูุญูุงูุฉ
    โ
    โโโ ุงูุฑุจุท:
        โโโ ุงููููุฏุงุช ุงููุชุตูุฉ
        โโโ ุงูููุงุจู ุงูุฎุงุฑุฌุฉ
```

### ุฌ) ุงููุญููุงุช (Transformers)

```
ุงููุญูู
    โ
    โโโ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ:
    โ   โโโ ุงูููุฏ
    โ   โโโ ุงููุฏุฑุฉ (KVA)
    โ   โโโ ูุณุจุฉ ุงูุชุญููู
    โ   โโโ ููุน ุงูุชุจุฑูุฏ
    โ
    โโโ ุงููุฑุงุกุงุช:
        โโโ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ
        โโโ ูุณุชูู ุงูุฒูุช
        โโโ ุงูุญูู ุงูุญุงูู
```

## ๐ ุฌุฏุงูู ุงููุญุทุงุช

```sql
-- ุงููุญุทุงุช
stations
    id
    business_id          -- ุงููุฌููุนุฉ
    name                 -- ุงุณู ุงููุญุทุฉ
    code                 -- ููุฏ ุงููุญุทุฉ
    type                 -- ููุน (ุชูููุฏ+ุชูุฒูุนุ ุชูุฒูุน ููุท)
    location_lat         -- ุฎุท ุงูุนุฑุถ
    location_lng         -- ุฎุท ุงูุทูู
    address              -- ุงูุนููุงู
    status               -- ุงูุญุงูุฉ (ูุดุทุ ูุชูููุ ุตูุงูุฉ)
    created_at
    updated_at

-- ุงููููุฏุงุช
generators
    id
    station_id           -- ุงููุญุทุฉ
    code                 -- ููุฏ ุงููููุฏ
    manufacturer         -- ุงูุดุฑูุฉ ุงููุตูุนุฉ
    model                -- ุงูููุฏูู
    year                 -- ุณูุฉ ุงูุตูุน
    capacity_kva         -- ุงููุฏุฑุฉ KVA
    capacity_kw          -- ุงููุฏุฑุฉ KW
    fuel_type            -- ููุน ุงููููุฏ
    serial_number        -- ุงูุฑูู ุงูุชุณูุณูู
    status               -- ุงูุญุงูุฉ
    purchase_date        -- ุชุงุฑูุฎ ุงูุดุฑุงุก
    warranty_end         -- ููุงูุฉ ุงูุถูุงู
    created_at
    updated_at

-- ููููุงุช ุงููููุฏ
generator_components
    id
    generator_id         -- ุงููููุฏ
    component_type       -- ููุน ุงููููู (ูุญุฑูุ ููุชุฑุ ุฅูุฎ)
    name                 -- ุงูุงุณู
    serial_number        -- ุงูุฑูู ุงูุชุณูุณูู
    install_date         -- ุชุงุฑูุฎ ุงูุชุฑููุจ
    lifespan_hours       -- ุงูุนูุฑ ุงูุงูุชุฑุงุถู (ุณุงุนุงุช)
    current_hours        -- ุงูุณุงุนุงุช ุงูุญุงููุฉ
    status               -- ุงูุญุงูุฉ
    last_maintenance     -- ุขุฎุฑ ุตูุงูุฉ
    next_maintenance     -- ุงูุตูุงูุฉ ุงููุงุฏูุฉ

-- ูุฑุงุกุงุช ุงููููุฏ
generator_readings
    id
    generator_id         -- ุงููููุฏ
    reading_time         -- ููุช ุงููุฑุงุกุฉ
    running_hours        -- ุณุงุนุงุช ุงูุชุดุบูู
    fuel_consumption     -- ุงุณุชููุงู ุงููููุฏ
    voltage              -- ุงูุฌูุฏ
    current              -- ุงูุชูุงุฑ
    frequency            -- ุงูุชุฑุฏุฏ
    temperature          -- ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ
    oil_pressure         -- ุถุบุท ุงูุฒูุช
    power_output         -- ุงูุทุงูุฉ ุงูููุชุฌุฉ
    source               -- ูุตุฏุฑ ุงููุฑุงุกุฉ (ูุฏููุ IoT)

-- ููุญุงุช ุงูุชุญูู
control_panels
    id
    station_id           -- ุงููุญุทุฉ
    code                 -- ุงูููุฏ
    type                 -- ุงูููุน (ุฑุฆูุณูุฉุ ูุฑุนูุฉ)
    capacity_amp         -- ุงูุณุนุฉ (ุฃูุจูุฑ)
    outputs_count        -- ุนุฏุฏ ุงููุฎุงุฑุฌ
    status               -- ุงูุญุงูุฉ

-- ุงููุญููุงุช
transformers
    id
    station_id           -- ุงููุญุทุฉ
    code                 -- ุงูููุฏ
    capacity_kva         -- ุงููุฏุฑุฉ
    ratio                -- ูุณุจุฉ ุงูุชุญููู
    cooling_type         -- ููุน ุงูุชุจุฑูุฏ
    status               -- ุงูุญุงูุฉ
```

---

# 2๏ธโฃ ูุญุทุงุช ุงูุทุงูุฉ ุงูุดูุณูุฉ (Solar Stations)

## โ๏ธ ุชุนุฑูู ูุญุทุฉ ุงูุทุงูุฉ ุงูุดูุณูุฉ

ูุญุทุฉ ุชููุชุฌ ุงูุทุงูุฉ ูู ุงูุฃููุงุญ ุงูุดูุณูุฉ ูุชูุบุฐู ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ.

## ๐ง ููููุงุช ูุญุทุฉ ุงูุทุงูุฉ ุงูุดูุณูุฉ

### ุฃ) ุงูุฃููุงุญ ุงูุดูุณูุฉ (Solar Panels)

```
ุงูููุญ ุงูุดูุณู
    โ
    โโโ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ:
    โ   โโโ ุงูููุฏ
    โ   โโโ ุงูุดุฑูุฉ ุงููุตูุนุฉ
    โ   โโโ ุงูููุฏูู
    โ   โโโ ุงููุฏุฑุฉ (Watt)
    โ   โโโ ุงูุฌูุฏ (Volt)
    โ   โโโ ุงูุชูุงุฑ (Amp)
    โ   โโโ ุงูููุงุกุฉ (%)
    โ
    โโโ ุงููููุน:
    โ   โโโ ุงูุตู
    โ   โโโ ุงูุนููุฏ
    โ   โโโ ุฒุงููุฉ ุงูููู
    โ   โโโ ุงูุงุชุฌุงู
    โ
    โโโ ุงููุฑุงุกุงุช:
        โโโ ุงูุทุงูุฉ ุงูููุชุฌุฉ
        โโโ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ
        โโโ ุงูููุงุกุฉ ุงููุนููุฉ
```

### ุจ) ุงูุงููุฑุชุฑุงุช (Inverters)

```
ุงูุงููุฑุชุฑ
    โ
    โโโ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ:
    โ   โโโ ุงูููุฏ
    โ   โโโ ุงูุดุฑูุฉ ุงููุตูุนุฉ
    โ   โโโ ุงูููุฏูู
    โ   โโโ ุงููุฏุฑุฉ (KW)
    โ   โโโ ููุน (String/Central/Micro)
    โ   โโโ ุนุฏุฏ ุงููุฏุงุฎู MPPT
    โ
    โโโ ุงูุฑุจุท:
    โ   โโโ ุงูุฃููุงุญ ุงููุชุตูุฉ
    โ   โโโ ุงูููุจู ุงูุฎุงุฑุฌ (ุฅูู ุงูุดุจูุฉ)
    โ
    โโโ ุงููุฑุงุกุงุช:
        โโโ ุงูุทุงูุฉ ุงููุฏุฎูุฉ (DC)
        โโโ ุงูุทุงูุฉ ุงููุฎุฑุฌุฉ (AC)
        โโโ ุงูููุงุกุฉ
        โโโ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ
        โโโ ุญุงูุฉ MPPT
```

### ุฌ) ุงูุจุทุงุฑูุงุช (Batteries) - ุงุฎุชูุงุฑู

```
ุงูุจุทุงุฑูุฉ/ุจูู ุงูุจุทุงุฑูุงุช
    โ
    โโโ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ:
    โ   โโโ ุงูููุฏ
    โ   โโโ ุงูููุน (Lithium/Lead-Acid)
    โ   โโโ ุงูุณุนุฉ (KWh)
    โ   โโโ ุงูุฌูุฏ
    โ   โโโ ุนุฏุฏ ุงูุฏูุฑุงุช
    โ
    โโโ ุงููุฑุงุกุงุช:
        โโโ ูุณุชูู ุงูุดุญู (%)
        โโโ ุงูุฌูุฏ ุงูุญุงูู
        โโโ ุงูุชูุงุฑ (ุดุญู/ุชูุฑูุบ)
        โโโ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ
        โโโ ุตุญุฉ ุงูุจุทุงุฑูุฉ (%)
```

## ๐ ุฌุฏุงูู ูุญุทุงุช ุงูุทุงูุฉ ุงูุดูุณูุฉ

```sql
-- ูุญุทุงุช ุงูุทุงูุฉ ุงูุดูุณูุฉ
solar_stations
    id
    business_id          -- ุงููุฌููุนุฉ
    name                 -- ุงูุงุณู (ูุซู: ูุฏุฑุณุฉ ุนูุฑ)
    code                 -- ุงูููุฏ
    location_lat         -- ุฎุท ุงูุนุฑุถ
    location_lng         -- ุฎุท ุงูุทูู
    address              -- ุงูุนููุงู
    total_capacity_kw    -- ุงููุฏุฑุฉ ุงูุฅุฌูุงููุฉ
    panels_count         -- ุนุฏุฏ ุงูุฃููุงุญ
    inverters_count      -- ุนุฏุฏ ุงูุงููุฑุชุฑุงุช
    installation_date    -- ุชุงุฑูุฎ ุงูุชุฑููุจ
    status               -- ุงูุญุงูุฉ
    created_at
    updated_at

-- ุงูุฃููุงุญ ุงูุดูุณูุฉ
solar_panels
    id
    solar_station_id     -- ุงููุญุทุฉ ุงูุดูุณูุฉ
    code                 -- ุงูููุฏ
    manufacturer         -- ุงูุดุฑูุฉ ุงููุตูุนุฉ
    model                -- ุงูููุฏูู
    capacity_watt        -- ุงููุฏุฑุฉ (ูุงุท)
    voltage              -- ุงูุฌูุฏ
    current              -- ุงูุชูุงุฑ
    efficiency           -- ุงูููุงุกุฉ
    row_number           -- ุฑูู ุงูุตู
    column_number        -- ุฑูู ุงูุนููุฏ
    tilt_angle           -- ุฒุงููุฉ ุงูููู
    orientation          -- ุงูุงุชุฌุงู
    status               -- ุงูุญุงูุฉ
    installation_date    -- ุชุงุฑูุฎ ุงูุชุฑููุจ

-- ุงูุงููุฑุชุฑุงุช
inverters
    id
    solar_station_id     -- ุงููุญุทุฉ ุงูุดูุณูุฉ
    code                 -- ุงูููุฏ
    manufacturer         -- ุงูุดุฑูุฉ ุงููุตูุนุฉ
    model                -- ุงูููุฏูู
    capacity_kw          -- ุงููุฏุฑุฉ
    type                 -- ุงูููุน (String/Central/Micro)
    mppt_count           -- ุนุฏุฏ ูุฏุงุฎู MPPT
    output_cable_id      -- ุงูููุจู ุงูุฎุงุฑุฌ (ุฅูู ุงูุดุจูุฉ)
    status               -- ุงูุญุงูุฉ

-- ุฑุจุท ุงูุงููุฑุชุฑ ุจุงูุฃููุงุญ
inverter_panels
    id
    inverter_id          -- ุงูุงููุฑุชุฑ
    panel_id             -- ุงูููุญ
    mppt_input           -- ุฑูู ูุฏุฎู MPPT

-- ูุฑุงุกุงุช ุงูุงููุฑุชุฑ
inverter_readings
    id
    inverter_id          -- ุงูุงููุฑุชุฑ
    reading_time         -- ููุช ุงููุฑุงุกุฉ
    dc_power             -- ุงูุทุงูุฉ ุงููุฏุฎูุฉ (DC)
    ac_power             -- ุงูุทุงูุฉ ุงููุฎุฑุฌุฉ (AC)
    efficiency           -- ุงูููุงุกุฉ
    temperature          -- ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ
    daily_energy         -- ุงูุทุงูุฉ ุงูููููุฉ
    total_energy         -- ุงูุทุงูุฉ ุงูุฅุฌูุงููุฉ
    source               -- ูุตุฏุฑ ุงููุฑุงุกุฉ

-- ุงูุจุทุงุฑูุงุช
batteries
    id
    solar_station_id     -- ุงููุญุทุฉ ุงูุดูุณูุฉ (ุฃู ุงููุญุทุฉ ุงูุนุงุฏูุฉ)
    code                 -- ุงูููุฏ
    type                 -- ุงูููุน
    capacity_kwh         -- ุงูุณุนุฉ
    voltage              -- ุงูุฌูุฏ
    max_cycles           -- ุนุฏุฏ ุงูุฏูุฑุงุช ุงููุตูู
    current_cycles       -- ุงูุฏูุฑุงุช ุงูุญุงููุฉ
    status               -- ุงูุญุงูุฉ

-- ูุฑุงุกุงุช ุงูุจุทุงุฑูุฉ
battery_readings
    id
    battery_id           -- ุงูุจุทุงุฑูุฉ
    reading_time         -- ููุช ุงููุฑุงุกุฉ
    charge_level         -- ูุณุชูู ุงูุดุญู (%)
    voltage              -- ุงูุฌูุฏ
    current              -- ุงูุชูุงุฑ
    temperature          -- ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ
    health               -- ุตุญุฉ ุงูุจุทุงุฑูุฉ (%)
```

---

# 3๏ธโฃ ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ (Electrical Network)

## ๐ ุชุนุฑูู ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ

ุงูุดุจูุฉ ูู ุงูุจููุฉ ุงูุชุญุชูุฉ ุงูุชู ุชุฑุจุท ุงููุญุทุงุช ุจุจุนุถูุง ูุชูุตู ุงูููุฑุจุงุก ูููุดุชุฑููู.

## ๐ง ููููุงุช ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ

### ุฃ) ุงูููุงุจู/ุงูุฎุทูุท (Cables/Lines)

```
ุงูููุจู
    โ
    โโโ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ:
    โ   โโโ ุงูููุฏ/ุงูุงุณู (ูุซู: ุงูุซูุฑุฉ 1ุ ุบููู 2)
    โ   โโโ ุงูููุน (ุฑุฆูุณูุ ูุฑุนูุ ุฑุจุท)
    โ   โโโ ุงูููุทุน (mmยฒ)
    โ   โโโ ุงููุงุฏุฉ (ูุญุงุณุ ุฃูููููู)
    โ   โโโ ุงูุทูู (ูุชุฑ)
    โ   โโโ ุงูุณุนุฉ (ุฃูุจูุฑ)
    โ
    โโโ ุงููุณุงุฑ:
    โ   โโโ ููุทุฉ ุงูุจุฏุงูุฉ (ูุญุทุฉ/ููุทุฉ ุงูุชูุงุก)
    โ   โโโ ููุทุฉ ุงูููุงูุฉ (ูุญุทุฉ/ููุทุฉ ุงูุชูุงุก/ูุดุชุฑููู)
    โ   โโโ ุงููุณุงุฑ ุงูุฌุบุฑุงูู (ุฅุญุฏุงุซูุงุช)
    โ
    โโโ ุงูุญุงูุฉ:
    โ   โโโ ุงูุญุงูุฉ ุงูุญุงููุฉ (ูุดุทุ ูุนุทูุ ุตูุงูุฉ)
    โ   โโโ ุงูุญูู ุงูุญุงูู
    โ   โโโ ูุณุจุฉ ุงูุชุญููู (%)
    โ
    โโโ ุณุฌูุงุช:
        โโโ ุณุฌู ุงูุฃุนุทุงู
        โโโ ุณุฌู ุงูุตูุงูุฉ
        โโโ ุณุฌู ุงูุชุญููู
```

### ุจ) ููุงุท ุงูุงูุชูุงุก (Junction Points)

```
ููุทุฉ ุงูุงูุชูุงุก
    โ
    โโโ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ:
    โ   โโโ ุงูููุฏ
    โ   โโโ ุงููููุน (ุฅุญุฏุงุซูุงุช)
    โ   โโโ ุงูููุน (ุชูุงุทุนุ ุชูุฒูุนุ ุฑุจุทุ ุตูุฏูู_ุชุฌููุน)
    โ   โโโ ุงููุตู
    โ
    โโโ ุงูููุงุจู ุงููุชุตูุฉ:
    โ   โโโ ููุจู 1 (ูู ูุญุทุฉ X)
    โ   โโโ ููุจู 2 (ูู ูุญุทุฉ Y)
    โ   โโโ ููุจู 3 (ุฅูู ููุทูุฉ Z)
    โ
    โโโ ุงูููุงุชูุญ:
        โโโ ููุชุงุญ 1 (ููุชุญูู ูู ุงุชุฌุงู ุงูุชุบุฐูุฉ)
        โโโ ููุชุงุญ 2
```

### ุฌ) ุงูููุงุชูุญ/ุงูููุงุทุน (Switches/Breakers)

```
ุงูููุชุงุญ/ุงููุงุทุน
    โ
    โโโ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ:
    โ   โโโ ุงูููุฏ
    โ   โโโ ุงูููุน (ูุฏููุ ุขููุ ุนู ุจุนุฏ)
    โ   โโโ ุงูุณุนุฉ (ุฃูุจูุฑ)
    โ   โโโ ุงููููุน (ูุญุทุฉ/ููุทุฉ ุงูุชูุงุก/ููุจู)
    โ
    โโโ ุงูุญุงูุฉ:
    โ   โโโ ููุชูุญ/ูุบูู
    โ   โโโ ุขุฎุฑ ุชุบููุฑ
    โ   โโโ ูู ูุงู ุจุงูุชุบููุฑ
    โ
    โโโ ุงูุฑุจุท:
        โโโ ุงูููุจู/ุงูุฎุท ุงููุชุญูู ููู
        โโโ ุงูุชุญูู ุนู ุจุนุฏ (IoT)
```

### ุฏ) ุงูุนุฏุงุฏุงุช (Meters)

```
ุงูุนุฏุงุฏ
    โ
    โโโ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ:
    โ   โโโ ุงูููุฏ/ุงูุฑูู ุงูุชุณูุณูู
    โ   โโโ ุงูููุน (ุชูููุฏูุ STSุ ุฐูู)
    โ   โโโ ุงูุดุฑูุฉ ุงููุตูุนุฉ
    โ   โโโ ุงูููุฏูู
    โ   โโโ ุงูุณุนุฉ (ุฃูุจูุฑ)
    โ
    โโโ ุงููููุน:
    โ   โโโ ุงููุญุทุฉ
    โ   โโโ ุงูููุจู
    โ   โโโ ุตูุฏูู ุงูุชุฌููุน (ุฑูู ุงูุตูุฏูู)
    โ   โโโ ุงููุดุชุฑู (ุฅู ูุฌุฏ)
    โ   โโโ ุงูุฅุญุฏุงุซูุงุช
    โ
    โโโ ุงููุฑุงุกุงุช:
    โ   โโโ ุงููุฑุงุกุฉ ุงูุญุงููุฉ
    โ   โโโ ุงูุงุณุชููุงู
    โ   โโโ ุงูุฐุฑูุฉ
    โ   โโโ ูุนุงูู ุงููุฏุฑุฉ
    โ
    โโโ ุงูุงุชุตุงู:
        โโโ ููุน ุงูุงุชุตุงู (ูุฏููุ WiFiุ GPRSุ LoRa)
        โโโ ุขุฎุฑ ุงุชุตุงู
```

## ๐บ๏ธ ูุซุงู: ุดุจูุฉ ุงููุญุทุงุช ุงูุญููููุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                           ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ ุงููุงููุฉ                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ                              ุงูุฏูููุฉ โก                                     โ
โ                             (ุดูุงู ุบุฑุจ)                                      โ
โ                                  โ                                          โ
โ                            10 ููุงุจู                                         โ
โ                          (4 ุงุชุฌุงูุงุช)                                        โ
โ                                  โ                                          โ
โ                                  โผ                                          โ
โ    ุงูุตุจุงููุฉ โกโโโโโ800ูโโโโโบ ุงููุฑูุฒูุฉ โกโโโโโ850ูโโโโโบ ุบููู โก              โ
โ   (ุฌููุจ ุบุฑุจ)                  (ุงููุณุท)                  (ุดุฑู)               โ
โ        โ                         โ                        โ                 โ
โ   ุงูููุงุจู:                       โ                   ุงูููุงุจู:               โ
โ   - ุงูุตุจุงููุฉ 1,2                 โ                   - ุบููู 1,2 (โุฌูุงู)     โ
โ   - ุนุฑุด ุจูููุณ 50,70         500ู                    - 4 ููุงุจู (โุฃุณุงูุฉ)      โ
โ   - ุฃุจู 120                      โ                   - 8 ููุงุจู (โูุฑูุฒูุฉ)    โ
โ   - ุงูุจุฑูุฏ 1,2                   โ                   - 5 ููุงุจู (ูุดุชุฑููู)    โ
โ   - ุงููุฑููุด 1,2                  โ                        โ                 โ
โ   - ุงูุญูู 1,2,3                  โ                        โ                 โ
โ        โ                         โ                        โ                 โ
โ     450ู                         โ                        โ                 โ
โ        โ                         โผ                        โ                 โ
โ        โโโโโโโโโโโโโโโโโโบ ุฌูุงู โกโโโโโโโโโ1200ูโโโโโโโโโโโโ                 โ
โ                           (ุฌููุจ)                                            โ
โ                         ุงูููุงุจู:                                            โ
โ                         - ุงูุซูุฑุฉ 1,2                                        โ
โ                         - ุฎุท ุงูุฌุงูุนุฉ                                        โ
โ                         - ุฌูุงู 1, 120, ุฃููุงู (โูุฑูุฒูุฉ)                      โ
โ                         - 4 ููุงุจู (โุตุจุงููุฉ)                                 โ
โ                         - ุบููู 1,2 (โุบููู)                                  โ
โ                                                                             โ
โ   โ๏ธ ุงููุญุทุงุช ุงูุดูุณูุฉ:                                                      โ
โ   - ูุฏุฑุณุฉ ุนูุฑ โ ุงููุฑุชุฑ 1 (โุฎุท ุงูุฌุงูุนุฉ) + ุงููุฑุชุฑ 2 (โุงูุซูุฑุฉ 2)              โ
โ   - ูุฏุฑุณุฉ ุฃุณุงูุฉ โ 4 ููุงุจู (โุบููู)                                          โ
โ   - ูุฏุฑุณุฉ ุงูุตุจุงุญ โ [ูุญุชุงุฌ ุชุญุฏูุฏ]                                           โ
โ   - ุฃุดุจุงู ุงููุฏุณ โ [ูุญุชุงุฌ ุชุญุฏูุฏ]                                            โ
โ   - ุงูุนูุงุฑุฉ ุงูุนุจุงุณู โ (โุงููุฑูุฒูุฉ + ุงูุฏูููุฉ)                                 โ
โ                                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ ุฌุฏุงูู ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ

```sql
-- ุงูููุงุจู/ุงูุฎุทูุท
cables
    id
    business_id          -- ุงููุฌููุนุฉ
    code                 -- ุงูููุฏ (ูุซู: ุงูุซูุฑุฉ 1)
    name                 -- ุงูุงุณู
    type                 -- ุงูููุน (ุฑุฆูุณูุ ูุฑุนูุ ุฑุจุท)
    cross_section        -- ุงูููุทุน (mmยฒ)
    material             -- ุงููุงุฏุฉ (ูุญุงุณุ ุฃูููููู)
    length_meters        -- ุงูุทูู (ูุชุฑ)
    capacity_amp         -- ุงูุณุนุฉ (ุฃูุจูุฑ)
    start_point_type     -- ููุน ููุทุฉ ุงูุจุฏุงูุฉ (ูุญุทุฉุ ููุทุฉ ุงูุชูุงุก)
    start_point_id       -- ูุนุฑู ููุทุฉ ุงูุจุฏุงูุฉ
    end_point_type       -- ููุน ููุทุฉ ุงูููุงูุฉ
    end_point_id         -- ูุนุฑู ููุทุฉ ุงูููุงูุฉ
    path_coordinates     -- ุงููุณุงุฑ ุงูุฌุบุฑุงูู (JSON)
    status               -- ุงูุญุงูุฉ
    installation_date    -- ุชุงุฑูุฎ ุงูุชุฑููุจ
    created_at
    updated_at

-- ููุงุท ุงูุงูุชูุงุก
junction_points
    id
    business_id          -- ุงููุฌููุนุฉ
    code                 -- ุงูููุฏ
    name                 -- ุงูุงุณู
    type                 -- ุงูููุน (ุชูุงุทุนุ ุชูุฒูุนุ ุฑุจุท)
    location_lat         -- ุฎุท ุงูุนุฑุถ
    location_lng         -- ุฎุท ุงูุทูู
    description          -- ุงููุตู
    status               -- ุงูุญุงูุฉ
    created_at
    updated_at

-- ุฑุจุท ุงูููุงุจู ุจููุงุท ุงูุงูุชูุงุก
junction_cables
    id
    junction_point_id    -- ููุทุฉ ุงูุงูุชูุงุก
    cable_id             -- ุงูููุจู
    direction            -- ุงูุงุชุฌุงู (ุฏุงุฎูุ ุฎุงุฑุฌ)

-- ุงูููุงุชูุญ/ุงูููุงุทุน
switches
    id
    business_id          -- ุงููุฌููุนุฉ
    code                 -- ุงูููุฏ
    name                 -- ุงูุงุณู
    type                 -- ุงูููุน (ูุฏููุ ุขููุ ุนู ุจุนุฏ)
    capacity_amp         -- ุงูุณุนุฉ
    location_type        -- ููุน ุงููููุน (ูุญุทุฉุ ููุทุฉ ุงูุชูุงุกุ ููุจู)
    location_id          -- ูุนุฑู ุงููููุน
    is_open              -- ููุชูุญ/ูุบูู
    is_remote            -- ูููู ุงูุชุญูู ุนู ุจุนุฏ
    iot_device_id        -- ุฌูุงุฒ IoT (ุฅู ูุฌุฏ)
    status               -- ุงูุญุงูุฉ
    created_at
    updated_at

-- ุณุฌู ุชุบููุฑุงุช ุงูููุงุชูุญ
switch_logs
    id
    switch_id            -- ุงูููุชุงุญ
    action               -- ุงูุฅุฌุฑุงุก (ูุชุญุ ุฅุบูุงู)
    performed_by         -- ูู ูุงู ุจุงูุฅุฌุฑุงุก
    performed_at         -- ููุช ุงูุฅุฌุฑุงุก
    reason               -- ุงูุณุจุจ
    notes                -- ููุงุญุธุงุช

-- ุตูุงุฏูู ุงูุชุฌููุน (Distribution Boxes)
distribution_boxes
    id
    business_id          -- ุงููุฌููุนุฉ
    code                 -- ุงูููุฏ (ูุซู: ุตูุฏูู 55)
    name                 -- ุงูุงุณู
    station_id           -- ุงููุญุทุฉ
    cable_id             -- ุงูููุจู ุงููุบุฐู
    location_lat         -- ุฎุท ุงูุนุฑุถ
    location_lng         -- ุฎุท ุงูุทูู
    address              -- ุงูุนููุงู/ุงูููุทูุฉ
    max_capacity         -- ุงูุณุนุฉ ุงููุตูู (ุนุฏุฏ ุงูุนุฏุงุฏุงุช)
    current_meters_count -- ุนุฏุฏ ุงูุนุฏุงุฏุงุช ุงูุญุงูู
    status               -- ุงูุญุงูุฉ (ูุดุทุ ูุนุทูุ ุตูุงูุฉ)
    last_inspection_date -- ุชุงุฑูุฎ ุขุฎุฑ ูุญุต
    notes                -- ููุงุญุธุงุช
    created_at
    updated_at

-- ุงูุนุฏุงุฏุงุช
meters
    id
    business_id          -- ุงููุฌููุนุฉ
    code                 -- ุงูููุฏ
    serial_number        -- ุงูุฑูู ุงูุชุณูุณูู
    type                 -- ุงูููุน (ุชูููุฏูุ STSุ ุฐูู)
    manufacturer         -- ุงูุดุฑูุฉ ุงููุตูุนุฉ
    model                -- ุงูููุฏูู
    capacity_amp         -- ุงูุณุนุฉ
    station_id           -- ุงููุญุทุฉ
    cable_id             -- ุงูููุจู
    distribution_box_id  -- ุตูุฏูู ุงูุชุฌููุน
    subscriber_id        -- ุงููุดุชุฑู (ุฅู ูุฌุฏ)
    location_lat         -- ุฎุท ุงูุนุฑุถ
    location_lng         -- ุฎุท ุงูุทูู
    connection_type      -- ููุน ุงูุงุชุตุงู (ูุฏููุ WiFiุ GPRSุ LoRa)
    iot_device_id        -- ุฌูุงุฒ IoT (ุฅู ูุฌุฏ)
    status               -- ุงูุญุงูุฉ
    installation_date    -- ุชุงุฑูุฎ ุงูุชุฑููุจ
    created_at
    updated_at

-- ูุฑุงุกุงุช ุงูุนุฏุงุฏุงุช
meter_readings
    id
    meter_id             -- ุงูุนุฏุงุฏ
    reading_time         -- ููุช ุงููุฑุงุกุฉ
    reading_value        -- ูููุฉ ุงููุฑุงุกุฉ
    consumption          -- ุงูุงุณุชููุงู
    peak_demand          -- ุงูุฐุฑูุฉ
    power_factor         -- ูุนุงูู ุงููุฏุฑุฉ
    source               -- ูุตุฏุฑ ุงููุฑุงุกุฉ (ูุฏููุ IoT)
    reader_id            -- ุงููุงุฑุฆ (ุฅู ูุงู ูุฏูู)
    created_at

-- ุญุงูุฉ ุงูููุงุจู (ูููุฑุงูุจุฉ)
cable_status
    id
    cable_id             -- ุงูููุจู
    reading_time         -- ููุช ุงููุฑุงุกุฉ
    current_load         -- ุงูุญูู ุงูุญุงูู
    load_percentage      -- ูุณุจุฉ ุงูุชุญููู
    temperature          -- ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ (ุฅู ูุฌุฏ ุญุณุงุณ)
    status               -- ุงูุญุงูุฉ
    source               -- ูุตุฏุฑ ุงููุฑุงุกุฉ
```

---

## ๐ ุดุงุดุงุช ูุธุงู ุงูุฃุตูู

### ุงููุณู ุงูุฃูู: ุงููุญุทุงุช

1. **ูุงุฆูุฉ ุงููุญุทุงุช**
2. **ุชูุงุตูู ุงููุญุทุฉ**
3. **ุฅุถุงูุฉ/ุชุนุฏูู ูุญุทุฉ**
4. **ูุงุฆูุฉ ุงููููุฏุงุช**
5. **ุชูุงุตูู ุงููููุฏ**
6. **ูุฑุงุกุงุช ุงููููุฏ**
7. **ุตูุงูุฉ ุงููููุฏ**

### ุงููุณู ุงูุซุงูู: ูุญุทุงุช ุงูุทุงูุฉ ุงูุดูุณูุฉ

1. **ูุงุฆูุฉ ุงููุญุทุงุช ุงูุดูุณูุฉ**
2. **ุชูุงุตูู ุงููุญุทุฉ ุงูุดูุณูุฉ**
3. **ูุงุฆูุฉ ุงูุงููุฑุชุฑุงุช**
4. **ูุฑุงุกุงุช ุงูุงููุฑุชุฑ**
5. **ุฃุฏุงุก ุงูุฃููุงุญ**
6. **ุฅูุชุงุฌ ุงูุทุงูุฉ**

### ุงููุณู ุงูุซุงูุซ: ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ

1. **ุฎุฑูุทุฉ ุงูุดุจูุฉ** (ุชูุงุนููุฉ)
2. **ูุงุฆูุฉ ุงูููุงุจู**
3. **ุชูุงุตูู ุงูููุจู**
4. **ููุงุท ุงูุงูุชูุงุก**
5. **ุงูููุงุชูุญ ูุงูููุงุทุน**
6. **ุงูุนุฏุงุฏุงุช**
7. **ุญุงูุฉ ุงูุดุจูุฉ** (ูุฑุงูุจุฉ ุญูุฉ)

### ุดุงุดุงุช ูุดุชุฑูุฉ

1. **ููุญุฉ ุชุญูู ุงูุฃุตูู**
2. **ุชูุงุฑูุฑ ุงูุฃุตูู**
3. **ุณุฌู ุงูุตูุงูุฉ**
4. **ุณุฌู ุงูุฃุนุทุงู**
5. **ุฌุฏููุฉ ุงูุตูุงูุฉ**

---

## ๐ ุณูุฑ ุงูุนูู

### ุฅุถุงูุฉ ููุจู ุฌุฏูุฏ:

```
1. ุชุญุฏูุฏ ุงุณู/ููุฏ ุงูููุจู
2. ุชุญุฏูุฏ ููุทุฉ ุงูุจุฏุงูุฉ (ูุญุทุฉ ุฃู ููุทุฉ ุงูุชูุงุก)
3. ุชุญุฏูุฏ ููุทุฉ ุงูููุงูุฉ
4. ุฅุฏุฎุงู ุงูููุงุตูุงุช (ููุทุนุ ุทููุ ุณุนุฉ)
5. ุฑุณู ุงููุณุงุฑ ุนูู ุงูุฎุฑูุทุฉ (ุงุฎุชูุงุฑู)
6. ุญูุธ ุงูููุจู
```

### ุฑุจุท ูุญุทุฉ ุดูุณูุฉ ุจุงูุดุจูุฉ:

```
1. ุฅูุดุงุก ุงููุญุทุฉ ุงูุดูุณูุฉ
2. ุฅุถุงูุฉ ุงูุงููุฑุชุฑุงุช
3. ููู ุงููุฑุชุฑ:
   - ุชุญุฏูุฏ ุงูููุจู ุงูุฎุงุฑุฌ
   - ุงูููุจู ูุฑุจุท ุจูุญุทุฉ ุฃู ููุทุฉ ุงูุชูุงุก
4. ุชูุนูู ุงููุญุทุฉ
```

### ุชุณุฌูู ุนุทู ูู ููุจู:

```
1. ุชุญุฏูุฏ ุงูููุจู
2. ุชุณุฌูู ููุน ุงูุนุทู
3. ุชุญุฏูุฏ ุงููููุน ุงูุชูุฑูุจู
4. ุฅูุดุงุก ุฃูุฑ ุตูุงูุฉ
5. ุชุญุฏูุซ ุญุงูุฉ ุงูููุจู
6. ุจุนุฏ ุงูุฅุตูุงุญ: ุชุญุฏูุซ ุงูุญุงูุฉ ูุฅุบูุงู ุงูุฃูุฑ
```

---

## โฑ๏ธ ุงูุฌุฏูู ุงูุฒููู ุงูููุชุฑุญ

| ุงููููุฉ | ุงููุฏุฉ |
|--------|-------|
| ูุณู ุงููุญุทุงุช | 3 ุฃุณุงุจูุน |
| ูุณู ูุญุทุงุช ุงูุทุงูุฉ ุงูุดูุณูุฉ | 2 ุฃุณุงุจูุน |
| ูุณู ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ | 4 ุฃุณุงุจูุน |
| ุฎุฑูุทุฉ ุงูุดุจูุฉ ุงูุชูุงุนููุฉ | 2 ุฃุณุงุจูุน |
| ุงูุชูุงูู ูุน IoT | 2 ุฃุณุงุจูุน |
| **ุงูุฅุฌูุงูู** | **13 ุฃุณุจูุน** |

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูููุงุจู ูู ุงูุนููุฏ ุงูููุฑู** - ูู ุดูุก ูุฑุชุจุท ุจูุง
2. **ููุงุท ุงูุงูุชูุงุก ูููุฉ** - ุชุญุฏุฏ ูุณุงุฑุงุช ุงูุชุบุฐูุฉ ุงูุจุฏููุฉ
3. **ุงููุญุทุงุช ุงูุดูุณูุฉ** - ุชูุบุฐู ููุงุจู ูุญุฏุฏุฉ ูููุณ ูุญุทุงุช ูุจุงุดุฑุฉ
4. **ุงูููุงุชูุญ** - ููุชุญูู ูู ุงุชุฌุงู ุงูุชุบุฐูุฉ

---

## ๐ ุงูุฃูุธูุฉ ุงููุฑุชุจุทุฉ

- **ุงููุธุงู ุงูุฃู** - ูููุฑ ุจูุงูุงุช ุงููุฌููุนุฉ ูุงููุญุทุงุช
- **ูุธุงู ุงููุทูุฑ** - ูุณุชูุจู ุจูุงูุงุช IoT
- **ูุธุงู ุงูุนููุงุก** - ุงูุนุฏุงุฏุงุช ูุงููุดุชุฑููู
- **ูุธุงู ุงูุตูุงูุฉ** - ุตูุงูุฉ ุงูุฃุตูู
- **ูุธุงู ุงููุฎุฒูู** - ูุทุน ุงูุบูุงุฑ

---

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ุงูุฌุฒุก ุงูุซุงูู: ุงูุตูุงูุฉ ูุงููุญุงุณุจุฉ
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

---

## ๐๏ธ ูููู ูุธุงู ุงูุฃุตูู ูุงูุตูุงูุฉ

```
ูุธุงู ุงูุฃุตูู ูุงูุตูุงูุฉ
โ
โโโ 1๏ธโฃ ุฅุฏุงุฑุฉ ุงูุฃุตูู (Asset Management)
โ   โโโ ุชุณุฌูู ุงูุฃุตูู
โ   โโโ ุชุชุจุน ุงูุฃุตูู
โ   โโโ ุงูุฅููุงู ูุงูุฅุทูุงุก
โ   โโโ ุงูุฌุฑุฏ ูุงููุญุต
โ
โโโ 2๏ธโฃ ุงูุตูุงูุฉ ุงูููุงุฆูุฉ (Preventive Maintenance)
โ   โโโ ุฌุฏุงูู ุงูุตูุงูุฉ
โ   โโโ ุชุชุจุน ุงูุชูููุฐ
โ   โโโ ุฅุฏุงุฑุฉ ูุทุน ุงูุบูุงุฑ
โ   โโโ ุงูุชูุงุฑูุฑ
โ
โโโ 3๏ธโฃ ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ (Corrective Maintenance)
โ   โโโ ุทูุจุงุช ุงูุตูุงูุฉ
โ   โโโ ุชุนููู ุงูููููู
โ   โโโ ุชุชุจุน ุงูุฅุตูุงุญุงุช
โ   โโโ ุฅุฏุงุฑุฉ ุงูุชูุงููู
โ
โโโ 4๏ธโฃ ุฅุฏุงุฑุฉ ุงูููููู ูุงูููุงูููู
โ   โโโ ุชุณุฌูู ุงูููููู
โ   โโโ ุชูููู ุงูุฃุฏุงุก
โ   โโโ ุฅุฏุงุฑุฉ ุงูุนููุฏ
โ   โโโ ุงูุฏูุน ูุงูุชุณููุฉ
โ
โโโ 5๏ธโฃ ุฅุฏุงุฑุฉ ูุทุน ุงูุบูุงุฑ
โ   โโโ ุชุณุฌูู ูุทุน ุงูุบูุงุฑ
โ   โโโ ุฅุฏุงุฑุฉ ุงููุฎุฒูู
โ   โโโ ุงูุทูุจุงุช ูุงูุชูุฑูุฏ
โ   โโโ ุงูุชูุงุฑูุฑ
โ
โโโ 6๏ธโฃ ุงูุชูุงุฑูุฑ ูุงูุชุญูููุงุช
    โโโ ุชูุงุฑูุฑ ุงูุตูุงูุฉ ุงูุฏูุฑูุฉ
    โโโ ุชูุงุฑูุฑ ุงูุฃุฏุงุก ูุงูููุงุกุฉ
    โโโ ุชูุงุฑูุฑ ุงูุชูุงููู
    โโโ ุงูุชูุจุคุงุช ูุงูุชุฎุทูุท
```

---

## ๐ ุงูุฑุจุท ุจุงูุฃูุธูุฉ ุงูุฃุฎุฑู

| ุงููุธุงู | ููุน ุงูุฑุจุท | ุงููุตู |
|--------|-----------|-------|
| **03_ูุธุงู_ุงูุฃุตูู** | ููู | ุจูุงูุงุช ุงูุฃุตูู ุงููููุฉ (ูููุฏุงุชุ ุฃููุงุญุ ููุงุจู) |
| **01_ุงููุธุงู_ุงูุฃู** | ูุญุงุณุจู | ูููุฏ ุงูุฅููุงูุ ุดุฑุงุก ุงูุฃุตููุ ุงูุงุณุชุจุนุงุฏ |
| **04_ูุธุงู_ุงูุนูููุงุช_ุงูููุฏุงููุฉ** | ุชุดุบููู | ููุงู ุงูุตูุงูุฉ ุงูููุฏุงููุฉ |
| **ูุธุงู ุงููุฎุฒูู** | ุชุดุบููู | ูุทุน ุงูุบูุงุฑ ูุงูููุงุฏ |
| **02_ูุธุงู_ุงููุทูุฑ** | ุชููู | IoTุ ุงูุชูุจููุงุช ุงูุชููุงุฆูุฉ |

---

# 1๏ธโฃ ุฅุฏุงุฑุฉ ุงูุฃุตูู (ุงููููุฉ 18)

## ๐ฏ ุงูุบุฑุถ

ุฅุฏุงุฑุฉ ุฏูุฑุฉ ุญูุงุฉ ุงูุฃุตูู ุงูุซุงุจุชุฉ ูู ุงูุงูุชูุงุก ุญุชู ุงูุงุณุชุจุนุงุฏุ ูุน ุญุณุงุจ ุงูุฅููุงู ูุงููููุฉ ุงูุฏูุชุฑูุฉ.

## ๐ ุชุตูููุงุช ุงูุฃุตูู

| ุงูุชุตููู | ุงูุฑูุฒ | ุฃูุซูุฉ | ุทุฑููุฉ ุงูุฅููุงู | ุงูุนูุฑ ุงูุงูุชุฑุงุถู |
|---------|-------|-------|---------------|-----------------|
| ูุจุงูู ูููุดุขุช | 1410 | ูุญุทุงุชุ ูุจุงูู ุฅุฏุงุฑูุฉ | ูุณุท ุซุงุจุช | 20-50 ุณูุฉ |
| ุขูุงุช ููุนุฏุงุช | 1420 | ูููุฏุงุชุ ูุญููุงุช | ูุณุท ุซุงุจุช | 10-15 ุณูุฉ |
| ูุนุฏุงุช ุทุงูุฉ ุดูุณูุฉ | 1421 | ุฃููุงุญุ ุงููุฑุชุฑุงุช | ูุณุท ุซุงุจุช | 20-25 ุณูุฉ |
| ุดุจูุงุช ููุฑุจุงุฆูุฉ | 1422 | ููุงุจูุ ููุงุชูุญ | ูุณุท ุซุงุจุช | 15-20 ุณูุฉ |
| ูุฑูุจุงุช | 1430 | ุณูุงุฑุงุชุ ุดุงุญูุงุช | ูุณุท ูุชูุงูุต | 5-8 ุณููุงุช |
| ุฃุซุงุซ ูุชุฌููุฒุงุช | 1440 | ููุงุชุจุ ุฃุฌูุฒุฉ | ูุณุท ุซุงุจุช | 5-10 ุณููุงุช |
| ุฃุฌูุฒุฉ ุญุงุณุจ | 1450 | ุฎูุงุฏูุ ุญูุงุณูุจ | ูุณุท ุซุงุจุช | 3-5 ุณููุงุช |
| ุนุฏุงุฏุงุช | 1460 | ุนุฏุงุฏุงุช ุฐููุฉุ STS | ูุณุท ุซุงุจุช | 10-15 ุณูุฉ |

## ๐ ุงูุฌุฏุงูู

### ุฌุฏูู ุชุตูููุงุช ุงูุฃุตูู: `asset_categories`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| code | VARCHAR(20) | ุฑูุฒ ุงูุชุตููู |
| name | VARCHAR(255) | ุงุณู ุงูุชุตููู |
| name_en | VARCHAR(255) | ุงูุงุณู ุจุงูุฅูุฌููุฒูุฉ |
| parent_id | UUID | ุงูุชุตููู ุงูุฃุจ |
| account_id | UUID | ุญุณุงุจ ุงูุฃุตูู (FK) |
| depreciation_account_id | UUID | ุญุณุงุจ ูุตุฑูู ุงูุฅููุงู |
| accumulated_dep_account_id | UUID | ุญุณุงุจ ูุฌูุน ุงูุฅููุงู |
| default_useful_life | INT | ุงูุนูุฑ ุงูุงูุชุฑุงุถู (ุฃุดูุฑ) |
| default_depreciation_method | ENUM | ุทุฑููุฉ ุงูุฅููุงู |
| is_active | BOOLEAN | ูุดุท |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุงูุฃุตูู: `assets`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| station_id | UUID | ุงููุญุทุฉ |
| category_id | UUID | ุงูุชุตููู |
| asset_code | VARCHAR(50) | ููุฏ ุงูุฃุตู (ูุฑูุฏ) |
| name | VARCHAR(255) | ุงุณู ุงูุฃุตู |
| description | TEXT | ุงููุตู |
| serial_number | VARCHAR(100) | ุงูุฑูู ุงูุชุณูุณูู |
| barcode | VARCHAR(100) | ุงูุจุงุฑููุฏ |
| **reference_type** | VARCHAR(50) | ููุน ุงููุฑุฌุน ุงูููู (generator, solar_panel, cable, meter) |
| **reference_id** | UUID | ูุนุฑู ุงูุฃุตู ุงูููู ูู ููู 03 |
| manufacturer | VARCHAR(255) | ุงูุดุฑูุฉ ุงููุตูุนุฉ |
| model | VARCHAR(255) | ุงูููุฏูู |
| purchase_date | DATE | ุชุงุฑูุฎ ุงูุดุฑุงุก |
| purchase_cost | DECIMAL | ุชูููุฉ ุงูุดุฑุงุก |
| installation_cost | DECIMAL | ุชูููุฉ ุงูุชุฑููุจ |
| total_cost | DECIMAL | ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ |
| useful_life_months | INT | ุงูุนูุฑ ุงูุงูุชุฑุงุถู (ุฃุดูุฑ) |
| salvage_value | DECIMAL | ุงููููุฉ ุงูุชุฎุฑูุฏูุฉ |
| depreciation_method | ENUM | ุทุฑููุฉ ุงูุฅููุงู (straight_line, declining_balance, units_of_production) |
| depreciation_start_date | DATE | ุชุงุฑูุฎ ุจุฏุก ุงูุฅููุงู |
| current_value | DECIMAL | ุงููููุฉ ุงูุฏูุชุฑูุฉ ุงูุญุงููุฉ |
| accumulated_depreciation | DECIMAL | ูุฌูุน ุงูุฅููุงู |
| location | VARCHAR(255) | ุงููููุน |
| location_lat | DECIMAL | ุฎุท ุงูุนุฑุถ |
| location_lng | DECIMAL | ุฎุท ุงูุทูู |
| custodian_id | UUID | ุงููุณุคูู/ุงูุญุงุฑุณ |
| warranty_start | DATE | ุจุฏุก ุงูุถูุงู |
| warranty_end | DATE | ููุงูุฉ ุงูุถูุงู |
| status | ENUM | ุงูุญุงูุฉ (active, under_maintenance, disposed, sold) |
| disposal_date | DATE | ุชุงุฑูุฎ ุงูุงุณุชุจุนุงุฏ |
| disposal_reason | TEXT | ุณุจุจ ุงูุงุณุชุจุนุงุฏ |
| disposal_value | DECIMAL | ูููุฉ ุงูุจูุน/ุงูุงุณุชุจุนุงุฏ |
| notes | TEXT | ููุงุญุธุงุช |
| created_by | UUID | ุงูููุดุฆ |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |
| updated_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุชุญุฏูุซ |

### ุฌุฏูู ูููุฏ ุงูุฅููุงู: `depreciation_entries`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| asset_id | UUID | ุงูุฃุตู |
| period_start | DATE | ุจุฏุงูุฉ ุงููุชุฑุฉ |
| period_end | DATE | ููุงูุฉ ุงููุชุฑุฉ |
| depreciation_amount | DECIMAL | ูุจูุบ ุงูุฅููุงู |
| accumulated_before | DECIMAL | ุงููุฌูุน ูุจู |
| accumulated_after | DECIMAL | ุงููุฌูุน ุจุนุฏ |
| book_value_before | DECIMAL | ุงููููุฉ ุงูุฏูุชุฑูุฉ ูุจู |
| book_value_after | DECIMAL | ุงููููุฉ ุงูุฏูุชุฑูุฉ ุจุนุฏ |
| journal_entry_id | UUID | ุงูููุฏ ุงููุญุงุณุจู |
| status | ENUM | ุงูุญุงูุฉ (draft, posted) |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุญุฑูุงุช ุงูุฃุตูู: `asset_movements`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| asset_id | UUID | ุงูุฃุตู |
| movement_type | ENUM | ููุน ุงูุญุฑูุฉ (acquisition, transfer, revaluation, disposal, sale) |
| movement_date | DATE | ุชุงุฑูุฎ ุงูุญุฑูุฉ |
| from_location | VARCHAR(255) | ูู ูููุน |
| to_location | VARCHAR(255) | ุฅูู ูููุน |
| from_custodian_id | UUID | ูู ูุณุคูู |
| to_custodian_id | UUID | ุฅูู ูุณุคูู |
| value_before | DECIMAL | ุงููููุฉ ูุจู |
| value_after | DECIMAL | ุงููููุฉ ุจุนุฏ |
| reason | TEXT | ุงูุณุจุจ |
| journal_entry_id | UUID | ุงูููุฏ ุงููุญุงุณุจู |
| approved_by | UUID | ุงูููุงูู |
| approved_at | TIMESTAMP | ุชุงุฑูุฎ ุงูููุงููุฉ |
| created_by | UUID | ุงูููุดุฆ |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุงูุฌุฑุฏ: `asset_inventory`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| inventory_number | VARCHAR(20) | ุฑูู ุงูุฌุฑุฏ |
| inventory_date | DATE | ุชุงุฑูุฎ ุงูุฌุฑุฏ |
| station_id | UUID | ุงููุญุทุฉ (ุงุฎุชูุงุฑู) |
| category_id | UUID | ุงูุชุตููู (ุงุฎุชูุงุฑู) |
| status | ENUM | ุงูุญุงูุฉ (draft, in_progress, completed, approved) |
| total_assets | INT | ุฅุฌูุงูู ุงูุฃุตูู |
| found_assets | INT | ุงูููุฌูุฏุฉ |
| missing_assets | INT | ุงูููููุฏุฉ |
| damaged_assets | INT | ุงูุชุงููุฉ |
| notes | TEXT | ููุงุญุธุงุช |
| conducted_by | UUID | ุงููููุฐ |
| approved_by | UUID | ุงูููุงูู |
| approved_at | TIMESTAMP | ุชุงุฑูุฎ ุงูููุงููุฉ |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุจููุฏ ุงูุฌุฑุฏ: `asset_inventory_items`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| inventory_id | UUID | ุงูุฌุฑุฏ |
| asset_id | UUID | ุงูุฃุตู |
| expected_location | VARCHAR(255) | ุงููููุน ุงููุชููุน |
| actual_location | VARCHAR(255) | ุงููููุน ุงููุนูู |
| condition | ENUM | ุงูุญุงูุฉ (good, fair, poor, damaged, missing) |
| notes | TEXT | ููุงุญุธุงุช |
| checked_by | UUID | ุงููุงุญุต |
| checked_at | TIMESTAMP | ููุช ุงููุญุต |

---

# 2๏ธโฃ ุงูุตูุงูุฉ ุงูููุงุฆูุฉ (ุงููููุฉ 19)

## ๐ฏ ุงูุบุฑุถ

ุฌุฏููุฉ ูุชูููุฐ ุงูุตูุงูุฉ ุงูุฏูุฑูุฉ ููุฃุตูู ูููุน ุงูุฃุนุทุงู ูุฅุทุงูุฉ ุงูุนูุฑ ุงูุงูุชุฑุงุถู.

## ๐ ุงูุฌุฏุงูู

### ุฌุฏูู ุฎุทุท ุงูุตูุงูุฉ: `maintenance_plans`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| name | VARCHAR(255) | ุงุณู ุงูุฎุทุฉ |
| description | TEXT | ุงููุตู |
| asset_category_id | UUID | ุชุตููู ุงูุฃุตูู |
| frequency_type | ENUM | ููุน ุงูุชูุฑุงุฑ (daily, weekly, monthly, quarterly, yearly, hours_based, custom) |
| frequency_value | INT | ูููุฉ ุงูุชูุฑุงุฑ |
| frequency_unit | VARCHAR(20) | ูุญุฏุฉ ุงูุชูุฑุงุฑ |
| estimated_duration | INT | ุงููุฏุฉ ุงูููุฏุฑุฉ (ุฏูุงุฆู) |
| estimated_cost | DECIMAL | ุงูุชูููุฉ ุงูููุฏุฑุฉ |
| checklist | JSON | ูุงุฆูุฉ ุงููุญุต |
| required_parts | JSON | ูุทุน ุงูุบูุงุฑ ุงููุทููุจุฉ |
| required_skills | JSON | ุงูููุงุฑุงุช ุงููุทููุจุฉ |
| is_active | BOOLEAN | ูุดุทุฉ |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุฌุฏุงูู ุงูุตูุงูุฉ: `maintenance_schedules`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| plan_id | UUID | ุฎุทุฉ ุงูุตูุงูุฉ |
| asset_id | UUID | ุงูุฃุตู |
| schedule_number | VARCHAR(20) | ุฑูู ุงูุฌุฏูู |
| scheduled_date | DATE | ุงูุชุงุฑูุฎ ุงููุฌุฏูู |
| due_date | DATE | ุชุงุฑูุฎ ุงูุงุณุชุญูุงู |
| status | ENUM | ุงูุญุงูุฉ (scheduled, in_progress, completed, overdue, cancelled) |
| priority | ENUM | ุงูุฃููููุฉ (low, medium, high, critical) |
| assigned_to | UUID | ุงููุนูู ูู |
| team_id | UUID | ุงููุฑูู |
| started_at | TIMESTAMP | ููุช ุงูุจุฏุก |
| completed_at | TIMESTAMP | ููุช ุงูุฅููุงู |
| actual_duration | INT | ุงููุฏุฉ ุงููุนููุฉ (ุฏูุงุฆู) |
| actual_cost | DECIMAL | ุงูุชูููุฉ ุงููุนููุฉ |
| notes | TEXT | ููุงุญุธุงุช |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุณุฌูุงุช ุงูุตูุงูุฉ: `maintenance_records`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| schedule_id | UUID | ุงูุฌุฏูู (ููููุงุฆูุฉ) |
| work_order_id | UUID | ุฃูุฑ ุงูุนูู (ููุทุงุฑุฆุฉ) |
| asset_id | UUID | ุงูุฃุตู |
| maintenance_type | ENUM | ุงูููุน (preventive, corrective, emergency) |
| record_number | VARCHAR(20) | ุฑูู ุงูุณุฌู |
| performed_date | DATE | ุชุงุฑูุฎ ุงูุชูููุฐ |
| performed_by | UUID | ุงููููุฐ |
| description | TEXT | ูุตู ุงูุนูู ุงูููุฌุฒ |
| findings | TEXT | ุงูููุงุญุธุงุช ูุงูุงูุชุดุงูุงุช |
| actions_taken | TEXT | ุงูุฅุฌุฑุงุกุงุช ุงููุชุฎุฐุฉ |
| parts_used | JSON | ูุทุน ุงูุบูุงุฑ ุงููุณุชุฎุฏูุฉ |
| labor_hours | DECIMAL | ุณุงุนุงุช ุงูุนูู |
| labor_cost | DECIMAL | ุชูููุฉ ุงูุนูุงูุฉ |
| parts_cost | DECIMAL | ุชูููุฉ ูุทุน ุงูุบูุงุฑ |
| other_cost | DECIMAL | ุชูุงููู ุฃุฎุฑู |
| total_cost | DECIMAL | ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ |
| condition_before | ENUM | ุงูุญุงูุฉ ูุจู |
| condition_after | ENUM | ุงูุญุงูุฉ ุจุนุฏ |
| next_maintenance_date | DATE | ุชุงุฑูุฎ ุงูุตูุงูุฉ ุงููุงุฏูุฉ |
| attachments | JSON | ุงููุฑููุงุช (ุตูุฑุ ุชูุงุฑูุฑ) |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

---

# 3๏ธโฃ ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ (ุงููููุฉ 20)

## ๐ฏ ุงูุบุฑุถ

ุฅุฏุงุฑุฉ ุทูุจุงุช ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ ูุงูุฅุตูุงุญุงุช ุบูุฑ ุงููุฎุทุทุฉ.

## ๐ ุงูุฌุฏุงูู

### ุฌุฏูู ุทูุจุงุช ุงูุตูุงูุฉ: `maintenance_requests`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| request_number | VARCHAR(20) | ุฑูู ุงูุทูุจ |
| asset_id | UUID | ุงูุฃุตู |
| station_id | UUID | ุงููุญุทุฉ |
| request_type | ENUM | ููุน ุงูุทูุจ (breakdown, malfunction, damage, other) |
| priority | ENUM | ุงูุฃููููุฉ (low, medium, high, critical) |
| title | VARCHAR(255) | ุนููุงู ุงูุทูุจ |
| description | TEXT | ูุตู ุงููุดููุฉ |
| reported_by | UUID | ุงููุจูุบ |
| reported_at | TIMESTAMP | ููุช ุงูุจูุงุบ |
| location | VARCHAR(255) | ุงููููุน |
| status | ENUM | ุงูุญุงูุฉ (new, assigned, in_progress, pending_parts, completed, cancelled) |
| assigned_to | UUID | ุงููุนูู ูู |
| team_id | UUID | ุงููุฑูู |
| estimated_completion | TIMESTAMP | ุงูููุช ุงููุชููุน ููุฅูุฌุงุฒ |
| actual_completion | TIMESTAMP | ููุช ุงูุฅูุฌุงุฒ ุงููุนูู |
| resolution | TEXT | ุงูุญู |
| root_cause | TEXT | ุงูุณุจุจ ุงูุฌุฐุฑู |
| attachments | JSON | ุงููุฑููุงุช |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุฃูุงูุฑ ุงูุนูู: `work_orders`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| work_order_number | VARCHAR(20) | ุฑูู ุฃูุฑ ุงูุนูู |
| request_id | UUID | ุทูุจ ุงูุตูุงูุฉ |
| asset_id | UUID | ุงูุฃุตู |
| **customer_id** | **UUID** | **ุงูุนููู (ูุฑุจุท ุฃูุฑ ุงูุนูู ุจููู ุงููุดุชุฑู)** |
| order_type | ENUM | ุงูููุน (repair, replacement, inspection, upgrade) |
| priority | ENUM | ุงูุฃููููุฉ |
| title | VARCHAR(255) | ุงูุนููุงู |
| description | TEXT | ุงููุตู |
| instructions | TEXT | ุงูุชุนูููุงุช |
| status | ENUM | ุงูุญุงูุฉ (draft, approved, assigned, in_progress, completed, closed) |
| assigned_to | UUID | ุงููุนูู ูู |
| team_id | UUID | ุงููุฑูู |
| contractor_id | UUID | ุงูููุงูู (ุงุฎุชูุงุฑู) |
| scheduled_start | TIMESTAMP | ุงูุจุฏุก ุงููุฌุฏูู |
| scheduled_end | TIMESTAMP | ุงูุงูุชูุงุก ุงููุฌุฏูู |
| actual_start | TIMESTAMP | ุงูุจุฏุก ุงููุนูู |
| actual_end | TIMESTAMP | ุงูุงูุชูุงุก ุงููุนูู |
| estimated_cost | DECIMAL | ุงูุชูููุฉ ุงูููุฏุฑุฉ |
| actual_cost | DECIMAL | ุงูุชูููุฉ ุงููุนููุฉ |
| approved_by | UUID | ุงูููุงูู |
| approved_at | TIMESTAMP | ุชุงุฑูุฎ ุงูููุงููุฉ |
| closed_by | UUID | ุงููุบูู |
| closed_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅุบูุงู |
| notes | TEXT | ููุงุญุธุงุช |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุนูููุงุช ุงูุงุณุชุจุฏุงู: `component_replacements`

> **ุงูุบุฑุถ:** ุชูุซูู ุนูููุงุช ุงุณุชุจุฏุงู ุงูููููุงุช (ุนุฏุงุฏุ ูุงุทุนุ ุฎุชู) ูุฏู ุงูุนููุงุก

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| work_order_id | UUID | ุฃูุฑ ุงูุนูู (FK) |
| customer_id | UUID | ุงูุนููู (FK) |
| technician_id | UUID | ุงูููู ุงููููุฐ (FK) |
| **ููุน ุงููููู** | | |
| component_type | ENUM | ููุน ุงููููู (meter, breaker, seal) |
| **ุงููููู ุงููุฏูู** | | |
| old_serial_number | VARCHAR(100) | ุงูุฑูู ุงูุชุณูุณูู ูููุฏูู |
| old_model | VARCHAR(100) | ููุฏูู ุงููุฏูู |
| old_condition | ENUM | ุญุงูุฉ ุงููุฏูู (damaged, malfunction, upgrade) |
| old_damage_reason | TEXT | ุณุจุจ ุงูุชูู |
| **ุงููููู ุงูุฌุฏูุฏ** | | |
| new_serial_number | VARCHAR(100) | ุงูุฑูู ุงูุชุณูุณูู ููุฌุฏูุฏ |
| new_model | VARCHAR(100) | ููุฏูู ุงูุฌุฏูุฏ |
| **ุงูุถูุงู** | | |
| warranty_status | ENUM | ุญุงูุฉ ุงูุถูุงู (under_warranty, out_of_warranty) |
| warranty_end_date | DATE | ุชุงุฑูุฎ ุงูุชูุงุก ุงูุถูุงู |
| **ุงูุชูููุฉ** | | |
| is_billable | BOOLEAN | ูู ูุชู ููุชุฑุชูุ |
| component_cost | DECIMAL(15,2) | ุชูููุฉ ุงููููู |
| labor_cost | DECIMAL(15,2) | ุชูููุฉ ุงูุนูู |
| total_cost | DECIMAL(15,2) | ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ |
| invoice_id | UUID | ุงููุงุชูุฑุฉ (ุฅุฐุง ุนูู ุญุณุงุจ ุงูุนููู) |
| **ุงูุชูููุช** | | |
| replacement_date | DATE | ุชุงุฑูุฎ ุงูุงุณุชุจุฏุงู |
| replacement_time | TIME | ููุช ุงูุงุณุชุจุฏุงู |
| notes | TEXT | ููุงุญุธุงุช |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### Trigger: ุฅูุดุงุก ุทูุจ ุตูุงูุฉ ุชููุงุฆู ูู ุฅูุฐุงุฑ ุงูุนุฏุงุฏ ุงูุฐูู

```sql
-- ุนูุฏ ูุตูู ุฅูุฐุงุฑ ูู ุงูุนุฏุงุฏ ุงูุฐูู (ูุซู: ุนุทูุ ุชูุงุนุจ) ูุชู ุฅูุดุงุก ุทูุจ ุตูุงูุฉ ุชููุงุฆูุงู
CREATE OR REPLACE FUNCTION create_maintenance_request_from_alert()
RETURNS TRIGGER AS $$
DECLARE
    v_customer_id UUID;
    v_asset_id UUID;
BEGIN
    -- ููุท ููุฅูุฐุงุฑุงุช ุงูุชู ุชุชุทูุจ ุตูุงูุฉ
    IF NEW.alert_type IN ('meter_malfunction', 'meter_offline', 'tamper_detected', 'communication_failure') THEN
        
        -- ุฌูุจ ุจูุงูุงุช ุงูุนููู ูุงูุฃุตู
        SELECT c.id, m.asset_id INTO v_customer_id, v_asset_id
        FROM meters m
        JOIN customers c ON c.meter_id = m.id
        WHERE m.id = NEW.meter_id;
        
        -- ุฅูุดุงุก ุทูุจ ุตูุงูุฉ ุชููุงุฆู
        INSERT INTO maintenance_requests (
            id, business_id, request_number, asset_id, station_id,
            request_type, priority, title, description,
            reported_by, reported_at, status, source
        ) VALUES (
            gen_random_uuid(),
            NEW.business_id,
            'MR-AUTO-' || TO_CHAR(NOW(), 'YYYYMMDD-HH24MISS'),
            v_asset_id,
            NEW.station_id,
            'malfunction',
            CASE 
                WHEN NEW.alert_type = 'tamper_detected' THEN 'critical'
                WHEN NEW.alert_type = 'meter_offline' THEN 'high'
                ELSE 'medium'
            END,
            'ุทูุจ ุตูุงูุฉ ุชููุงุฆู - ' || NEW.alert_type,
            NEW.description,
            NULL, -- ุงููุธุงู ูู ุงููุจูุบ
            NOW(),
            'new',
            'smart_meter_alert' -- ูุตุฏุฑ ุงูุทูุจ
        );
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_auto_maintenance_from_alert
AFTER INSERT ON alerts
FOR EACH ROW
EXECUTE FUNCTION create_maintenance_request_from_alert();
```

### Trigger: ูุญุต ุงูุถูุงู ูุฅูุดุงุก ูุงุชูุฑุฉ ุชููุงุฆูุฉ

```sql
-- ุนูุฏ ุฅููุงู ุนูููุฉ ุงุณุชุจุฏุงู: ูุญุต ุงูุถูุงู ูุฅูุดุงุก ูุงุชูุฑุฉ ุฅุฐุง ูุฒู
CREATE OR REPLACE FUNCTION process_replacement_billing()
RETURNS TRIGGER AS $$
DECLARE
    v_warranty_end DATE;
    v_invoice_id UUID;
BEGIN
    -- ูุญุต ุงูุถูุงู
    SELECT warranty_end_date INTO v_warranty_end
    FROM component_history
    WHERE customer_id = NEW.customer_id
    AND serial_number = NEW.old_serial_number
    AND action_type = 'installed'
    ORDER BY action_date DESC
    LIMIT 1;
    
    -- ุชุญุฏูุฏ ุญุงูุฉ ุงูุถูุงู
    IF v_warranty_end IS NOT NULL AND v_warranty_end >= CURRENT_DATE THEN
        -- ุชุญุช ุงูุถูุงู - ูุง ูุงุชูุฑุฉ
        UPDATE component_replacements SET
            warranty_status = 'under_warranty',
            is_billable = false
        WHERE id = NEW.id;
    ELSE
        -- ุฎุงุฑุฌ ุงูุถูุงู - ุฅูุดุงุก ูุงุชูุฑุฉ
        v_invoice_id := gen_random_uuid();
        
        INSERT INTO invoices (
            id, customer_id, invoice_number, invoice_type,
            invoice_date, due_date, total_amount, status, notes
        ) VALUES (
            v_invoice_id,
            NEW.customer_id,
            'INV-RPL-' || TO_CHAR(NOW(), 'YYYYMMDD-HH24MISS'),
            'replacement', -- ููุน ูุงุชูุฑุฉ ุงุณุชุจุฏุงู
            CURRENT_DATE,
            CURRENT_DATE + INTERVAL '30 days',
            NEW.total_cost,
            'pending',
            'ูุงุชูุฑุฉ ุงุณุชุจุฏุงู ' || NEW.component_type || ' - ุฑูู: ' || NEW.new_serial_number
        );
        
        UPDATE component_replacements SET
            warranty_status = 'out_of_warranty',
            is_billable = true,
            invoice_id = v_invoice_id
        WHERE id = NEW.id;
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_replacement_billing
AFTER INSERT ON component_replacements
FOR EACH ROW
EXECUTE FUNCTION process_replacement_billing();
```

### Trigger: ุชุญุฏูุซ ุญุงูุฉ ุงููููู ุงููุฏูู ุฅูู "ุชุงูู"

```sql
-- ุนูุฏ ุงูุงุณุชุจุฏุงู: ุชุญุฏูุซ ุญุงูุฉ ุงููููู ุงููุฏูู ุฅูู "ุชุงูู/ุจุงูุชุธุงุฑ ุงููุญุต"
CREATE OR REPLACE FUNCTION update_old_component_status()
RETURNS TRIGGER AS $$
BEGIN
    -- ุชุญุฏูุซ ุญุงูุฉ ุงูุนุฏุงุฏ ุงููุฏูู ูู ุฌุฏูู ุชุชุจุน ุงูุนุฏุงุฏุงุช
    IF NEW.component_type = 'meter' THEN
        UPDATE meter_status_tracking SET
            current_status = 'damaged_pending_inspection',
            current_location_type = 'warehouse',
            current_location_id = NULL, -- ุณูุชู ุชุญุฏูุซู ุนูุฏ ุงูุฅุฑุฌุงุน
            notes = 'ุชู ุงูุงุณุชุจุฏุงู - ุณุจุจ: ' || COALESCE(NEW.old_damage_reason, 'ุบูุฑ ูุญุฏุฏ')
        WHERE serial_number = NEW.old_serial_number;
    END IF;
    
    -- ุชุณุฌูู ูู ุชุงุฑูุฎ ุงูููููุงุช
    INSERT INTO component_history (
        id, customer_id, component_type, serial_number,
        action_type, action_date, reason, work_order_id, replacement_id, technician_id
    ) VALUES (
        gen_random_uuid(),
        NEW.customer_id,
        NEW.component_type,
        NEW.old_serial_number,
        'removed',
        NEW.replacement_date,
        NEW.old_damage_reason,
        NEW.work_order_id,
        NEW.id,
        NEW.technician_id
    );
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_update_old_component
AFTER INSERT ON component_replacements
FOR EACH ROW
EXECUTE FUNCTION update_old_component_status();
```

---

## 3.5 ูุนุงูุฌ ุงุณุชุจุฏุงู ุงูุนุฏุงุฏ ุงูุชุงูู (Damaged Meter Replacement Wizard)

> **ุงูุบุฑุถ:** ุชูุฌูู ุงูููุธู ุนุจุฑ ุฎุทูุงุช ุงุณุชุจุฏุงู ุงูุนุฏุงุฏ ุงูุชุงูู ูุน ุชูุฏูุฑ ุงูุงุณุชููุงู ูุชุญุฏูุฏ ุงูุชูููุฉ

### 3.5.1 ุฎุทูุงุช ุงููุนุงูุฌ (Wizard Steps)

```
ุงูุฎุทูุฉ 1: ุชุญุฏูุฏ ุงูุนููู ูุงูุนุฏุงุฏ ุงูุชุงูู
         - ุงุฎุชูุงุฑ ุงูุนููู ุฃู ุงูุจุญุซ ุจุฑูู ุงูุนุฏุงุฏ
         - ุนุฑุถ ุจูุงูุงุช ุงูุนููู ูุงูุนุฏุงุฏ ุงูุญุงูู
         โ
ุงูุฎุทูุฉ 2: ุชูุฏูุฑ ุงูุงุณุชููุงู ุงูููููุฏ
         - ุงููุธุงู ูุญุณุจ ูุชูุณุท ุขุฎุฑ 3 ููุงุชูุฑ ุชููุงุฆูุงู
         - ุงูููุธู ูุญุฏุฏ ุงููุชุฑุฉ ุงูููููุฏุฉ (ุนุฏุฏ ุงูุฃูุงู)
         - ุฅูุดุงุก ูุงุชูุฑุฉ ุชูุฏูุฑูุฉ
         โ
ุงูุฎุทูุฉ 3: ุชุญุฏูุฏ ุชูููุฉ ุงูุงุณุชุจุฏุงู
         - ุชุญููู ุงูุชูููุฉ ูุงููุฉ (100%)
         - ุชุญููู 50% ูู ุงูุชูููุฉ
         - ุงุณุชุจุฏุงู ูุฌุงูู (ุชุญุช ุงูุถูุงู/ุณูุงุณุฉ ุงูุดุฑูุฉ)
         โ
ุงูุฎุทูุฉ 4: ุฅูุดุงุก ุฃูุฑ ุงูุนูู
         - ุฅูุดุงุก ูุงุชูุฑุฉ ุจุงููุจูุบ ุงููุญุฏุฏ
         - ุฅูุดุงุก ุฃูุฑ ุนูู ููููู
         - ุชุญุฏูุฏ ุงูููุงุฏ ุงููุทููุจุฉ
         โ
ุงูุฎุทูุฉ 5: ุงูุชุฃููุฏ ูุงูุฅุฑุณุงู
         - ูุฑุงุฌุนุฉ ุฌููุน ุงูุจูุงูุงุช
         - ุชุฃููุฏ ูุฅุฑุณุงู ููููู
```

### 3.5.2 ุฌุฏูู ุทูุจุงุช ุงุณุชุจุฏุงู ุงูุนุฏุงุฏ ุงูุชุงูู: `damaged_meter_replacements`

```sql
CREATE TABLE damaged_meter_replacements (
    id UUID PRIMARY KEY,
    business_id UUID REFERENCES businesses(id),
    
    -- ุจูุงูุงุช ุงูุนููู ูุงูุนุฏุงุฏ
    customer_id UUID REFERENCES customers(id),
    old_meter_serial VARCHAR(100),
    new_meter_serial VARCHAR(100),
    
    -- ุชูุฏูุฑ ุงูุงุณุชููุงู
    avg_daily_consumption DECIMAL(10,2), -- ูุชูุณุท ุงูุงุณุชููุงู ุงููููู
    missing_days INT, -- ุนุฏุฏ ุฃูุงู ุงููุชุฑุฉ ุงูููููุฏุฉ
    estimated_consumption DECIMAL(10,2), -- ุงูุงุณุชููุงู ุงูููุฏุฑ
    estimated_invoice_id UUID, -- ูุงุชูุฑุฉ ุงูุงุณุชููุงู ุงูุชูุฏูุฑู
    
    -- ุชูููุฉ ุงูุงุณุชุจุฏุงู
    meter_cost DECIMAL(15,2), -- ุชูููุฉ ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ
    cost_option VARCHAR(50), -- full, half, free
    charged_amount DECIMAL(15,2), -- ุงููุจูุบ ุงููุญูู ุนูู ุงูุนููู
    cost_reason VARCHAR(200), -- ุณุจุจ ุงูุฎูุงุฑ (ุถูุงูุ ุณูุงุณุฉุ ุฎุทุฃ ุนููู)
    replacement_invoice_id UUID, -- ูุงุชูุฑุฉ ุงูุงุณุชุจุฏุงู
    
    -- ุฃูุฑ ุงูุนูู
    work_order_id UUID REFERENCES work_orders(id),
    
    -- ุงูุญุงูุฉ
    status VARCHAR(50) DEFAULT 'draft',
    -- draft, pending_payment, ready_for_installation, in_progress, completed, cancelled
    
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### 3.5.3 ุฏุงูุฉ ุญุณุงุจ ูุชูุณุท ุงูุงุณุชููุงู

```sql
CREATE OR REPLACE FUNCTION calculate_avg_consumption(p_customer_id UUID)
RETURNS DECIMAL(10,2) AS $$
DECLARE
    v_avg DECIMAL(10,2);
BEGIN
    -- ุญุณุงุจ ูุชูุณุท ุขุฎุฑ 3 ููุงุชูุฑ
    SELECT AVG(consumption_kwh) INTO v_avg
    FROM (
        SELECT consumption_kwh
        FROM invoices
        WHERE customer_id = p_customer_id
          AND invoice_type = 'consumption'
          AND status IN ('paid', 'posted')
        ORDER BY billing_period_end DESC
        LIMIT 3
    ) last_invoices;
    
    RETURN COALESCE(v_avg, 0);
END;
$$ LANGUAGE plpgsql;
```

### 3.5.4 ุฏุงูุฉ ุฅูุดุงุก ูุงุชูุฑุฉ ุชูุฏูุฑูุฉ

```sql
CREATE OR REPLACE FUNCTION create_estimated_invoice(
    p_customer_id UUID,
    p_missing_days INT,
    p_created_by UUID
) RETURNS UUID AS $$
DECLARE
    v_invoice_id UUID;
    v_avg_monthly DECIMAL(10,2);
    v_daily_avg DECIMAL(10,2);
    v_estimated_kwh DECIMAL(10,2);
    v_tariff_rate DECIMAL(10,4);
    v_amount DECIMAL(15,2);
BEGIN
    -- ุญุณุงุจ ุงููุชูุณุท ุงูุดูุฑู
    v_avg_monthly := calculate_avg_consumption(p_customer_id);
    v_daily_avg := v_avg_monthly / 30;
    v_estimated_kwh := v_daily_avg * p_missing_days;
    
    -- ุฌูุจ ุณุนุฑ ุงูุชุนุฑูุฉ
    SELECT rate_per_kwh INTO v_tariff_rate
    FROM customers c
    JOIN tariffs t ON c.tariff_id = t.id
    WHERE c.id = p_customer_id;
    
    v_amount := v_estimated_kwh * v_tariff_rate;
    
    -- ุฅูุดุงุก ุงููุงุชูุฑุฉ ุงูุชูุฏูุฑูุฉ
    INSERT INTO invoices (
        id, customer_id, invoice_type, consumption_kwh,
        total_amount, status, notes, created_by
    ) VALUES (
        gen_random_uuid(), p_customer_id, 'estimated',
        v_estimated_kwh, v_amount, 'draft',
        'ูุงุชูุฑุฉ ุชูุฏูุฑูุฉ ูููุชุฑุฉ ุงูููููุฏุฉ (' || p_missing_days || ' ููู)',
        p_created_by
    ) RETURNING id INTO v_invoice_id;
    
    RETURN v_invoice_id;
END;
$$ LANGUAGE plpgsql;
```

### 3.5.5 ุฎูุงุฑุงุช ุชูููุฉ ุงูุงุณุชุจุฏุงู

| ุงูุฎูุงุฑ | ุงููุณุจุฉ | ุงูุดุฑูุท |
|--------|--------|--------|
| **ุชุญููู ูุงูู** | 100% | ุชูู ุจุณุจุจ ุงูุนููู (ุณูุก ุงุณุชุฎุฏุงูุ ุชุฎุฑูุจ) |
| **ุชุญููู ูุตูู** | 50% | ุชูู ุทุจูุนู ุฎุงุฑุฌ ุงูุถูุงู |
| **ูุฌุงูู** | 0% | ุชุญุช ุงูุถูุงู ุฃู ุนูุจ ุตูุงุนู |

### 3.5.6 APIs ูุนุงูุฌ ุงูุงุณุชุจุฏุงู

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| POST | /api/v1/replacement-wizard/start | ุจุฏุก ูุนุงูุฌ ุงุณุชุจุฏุงู ุฌุฏูุฏ |
| GET | /api/v1/replacement-wizard/:id/estimate | ุญุณุงุจ ุชูุฏูุฑ ุงูุงุณุชููุงู |
| POST | /api/v1/replacement-wizard/:id/estimated-invoice | ุฅูุดุงุก ูุงุชูุฑุฉ ุชูุฏูุฑูุฉ |
| PUT | /api/v1/replacement-wizard/:id/cost-option | ุชุญุฏูุฏ ุฎูุงุฑ ุงูุชูููุฉ |
| POST | /api/v1/replacement-wizard/:id/create-work-order | ุฅูุดุงุก ุฃูุฑ ุงูุนูู |
| POST | /api/v1/replacement-wizard/:id/confirm | ุชุฃููุฏ ูุฅุฑุณุงู |

---

# 4๏ธโฃ ุฅุฏุงุฑุฉ ุงูููููู ูุงูููุงูููู (ุงููููุฉ 21)

## ๐ฏ ุงูุบุฑุถ

ุฅุฏุงุฑุฉ ุงูููููู ุงูุฏุงุฎูููู ูุงูููุงูููู ุงูุฎุงุฑุฌููู ูุชูููู ุฃุฏุงุฆูู.

## ๐ ุงูุฌุฏุงูู

### ุฌุฏูู ุงูููููู: `technicians`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| employee_id | UUID | ุงูููุธู (FK - ูุธุงู HR) |
| technician_code | VARCHAR(20) | ููุฏ ุงูููู |
| name | VARCHAR(255) | ุงูุงุณู |
| phone | VARCHAR(20) | ุงููุงุชู |
| email | VARCHAR(255) | ุงูุจุฑูุฏ |
| specializations | JSON | ุงูุชุฎุตุตุงุช |
| certifications | JSON | ุงูุดูุงุฏุงุช |
| skills_level | ENUM | ูุณุชูู ุงูููุงุฑุฉ (junior, mid, senior, expert) |
| hourly_rate | DECIMAL | ุณุนุฑ ุงูุณุงุนุฉ |
| is_internal | BOOLEAN | ุฏุงุฎูู/ุฎุงุฑุฌู |
| contractor_id | UUID | ุงูููุงูู (ุฅุฐุง ุฎุงุฑุฌู) |
| rating | DECIMAL(3,2) | ุงูุชูููู |
| total_jobs | INT | ุฅุฌูุงูู ุงูููุงู |
| completed_jobs | INT | ุงูููุงู ุงูููุชููุฉ |
| is_available | BOOLEAN | ูุชุงุญ |
| notes | TEXT | ููุงุญุธุงุช |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุงูููุงูููู: `contractors`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| contractor_code | VARCHAR(20) | ููุฏ ุงูููุงูู |
| name | VARCHAR(255) | ุงูุงุณู |
| contact_person | VARCHAR(255) | ุฌูุฉ ุงูุงุชุตุงู |
| phone | VARCHAR(20) | ุงููุงุชู |
| email | VARCHAR(255) | ุงูุจุฑูุฏ |
| address | TEXT | ุงูุนููุงู |
| specializations | JSON | ุงูุชุฎุตุตุงุช |
| tax_number | VARCHAR(50) | ุงูุฑูู ุงูุถุฑูุจู |
| bank_account | VARCHAR(50) | ุงูุญุณุงุจ ุงูุจููู |
| rating | DECIMAL(3,2) | ุงูุชูููู |
| status | ENUM | ุงูุญุงูุฉ (active, inactive, blacklisted) |
| notes | TEXT | ููุงุญุธุงุช |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุนููุฏ ุงูุตูุงูุฉ: `maintenance_contracts`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| contract_number | VARCHAR(20) | ุฑูู ุงูุนูุฏ |
| contractor_id | UUID | ุงูููุงูู |
| title | VARCHAR(255) | ุนููุงู ุงูุนูุฏ |
| description | TEXT | ุงููุตู |
| contract_type | ENUM | ููุน ุงูุนูุฏ (annual, project, on_call) |
| start_date | DATE | ุชุงุฑูุฎ ุงูุจุฏุก |
| end_date | DATE | ุชุงุฑูุฎ ุงูุงูุชูุงุก |
| value | DECIMAL | ูููุฉ ุงูุนูุฏ |
| payment_terms | TEXT | ุดุฑูุท ุงูุฏูุน |
| scope | TEXT | ูุทุงู ุงูุนูู |
| sla | JSON | ุงุชูุงููุฉ ูุณุชูู ุงูุฎุฏูุฉ |
| status | ENUM | ุงูุญุงูุฉ (draft, active, expired, terminated) |
| attachments | JSON | ุงููุฑููุงุช |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุชูููู ุงูุฃุฏุงุก: `technician_performance`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| technician_id | UUID | ุงูููู |
| period_start | DATE | ุจุฏุงูุฉ ุงููุชุฑุฉ |
| period_end | DATE | ููุงูุฉ ุงููุชุฑุฉ |
| total_jobs | INT | ุฅุฌูุงูู ุงูููุงู |
| completed_on_time | INT | ุงูููุชููุฉ ูู ุงูููุช |
| completed_late | INT | ุงููุชุฃุฎุฑุฉ |
| rework_count | INT | ุฅุนุงุฏุฉ ุงูุนูู |
| customer_complaints | INT | ุดูุงูู ุงูุนููุงุก |
| quality_score | DECIMAL(3,2) | ุฏุฑุฌุฉ ุงูุฌูุฏุฉ |
| efficiency_score | DECIMAL(3,2) | ุฏุฑุฌุฉ ุงูููุงุกุฉ |
| overall_score | DECIMAL(3,2) | ุงูุฏุฑุฌุฉ ุงูุฅุฌูุงููุฉ |
| notes | TEXT | ููุงุญุธุงุช |
| evaluated_by | UUID | ุงูููููู |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

---

# 5๏ธโฃ ุฅุฏุงุฑุฉ ูุทุน ุงูุบูุงุฑ (ุงููููุฉ 22)

## ๐ฏ ุงูุบุฑุถ

ุฅุฏุงุฑุฉ ูุฎุฒูู ูุทุน ุงูุบูุงุฑ ูุงูููุงุฏ ุงููุณุชุฎุฏูุฉ ูู ุงูุตูุงูุฉ.

## ๐ ุงูุฌุฏุงูู

### ุฌุฏูู ูุทุน ุงูุบูุงุฑ: `spare_parts`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| part_code | VARCHAR(50) | ููุฏ ุงููุทุนุฉ |
| name | VARCHAR(255) | ุงูุงุณู |
| description | TEXT | ุงููุตู |
| category_id | UUID | ุงูุชุตููู |
| unit | VARCHAR(20) | ุงููุญุฏุฉ |
| manufacturer | VARCHAR(255) | ุงูุดุฑูุฉ ุงููุตูุนุฉ |
| model_compatibility | JSON | ุงูุชูุงูู ูุน ุงูููุฏููุงุช |
| asset_categories | JSON | ุชุตูููุงุช ุงูุฃุตูู ุงููุชูุงููุฉ |
| min_stock | DECIMAL | ุงูุญุฏ ุงูุฃุฏูู |
| max_stock | DECIMAL | ุงูุญุฏ ุงูุฃูุตู |
| reorder_point | DECIMAL | ููุทุฉ ุฅุนุงุฏุฉ ุงูุทูุจ |
| current_stock | DECIMAL | ุงููุฎุฒูู ุงูุญุงูู |
| unit_cost | DECIMAL | ุชูููุฉ ุงููุญุฏุฉ |
| location | VARCHAR(255) | ูููุน ุงูุชุฎุฒูู |
| is_critical | BOOLEAN | ูุทุนุฉ ุญุฑุฌุฉ |
| lead_time_days | INT | ููุช ุงูุชูุฑูุฏ (ุฃูุงู) |
| notes | TEXT | ููุงุญุธุงุช |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุญุฑูุงุช ูุทุน ุงูุบูุงุฑ: `spare_parts_movements`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| part_id | UUID | ุงููุทุนุฉ |
| movement_type | ENUM | ููุน ุงูุญุฑูุฉ (receipt, issue, return, adjustment) |
| movement_date | TIMESTAMP | ุชุงุฑูุฎ ุงูุญุฑูุฉ |
| quantity | DECIMAL | ุงููููุฉ |
| unit_cost | DECIMAL | ุชูููุฉ ุงููุญุฏุฉ |
| total_cost | DECIMAL | ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ |
| reference_type | VARCHAR(50) | ููุน ุงููุฑุฌุน (work_order, maintenance_record, purchase) |
| reference_id | UUID | ูุนุฑู ุงููุฑุฌุน |
| from_location | VARCHAR(255) | ูู ูููุน |
| to_location | VARCHAR(255) | ุฅูู ูููุน |
| notes | TEXT | ููุงุญุธุงุช |
| created_by | UUID | ุงูููุดุฆ |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

---

# 6๏ธโฃ ุงูุชูุงุฑูุฑ ูุงูุชุญูููุงุช (ุงููููุฉ 23)

## ๐ ุงูุชูุงุฑูุฑ ุงููุชุงุญุฉ

### ุชูุงุฑูุฑ ุงูุฃุตูู:
- ุณุฌู ุงูุฃุตูู ุงูุดุงูู
- ุชูุฑูุฑ ุงูุฅููุงู ุงูุฏูุฑู
- ุชูุฑูุฑ ุงููููุฉ ุงูุฏูุชุฑูุฉ
- ุชูุฑูุฑ ุงูุฌุฑุฏ
- ุชูุฑูุฑ ุงูุฃุตูู ุญุณุจ ุงููููุน/ุงูุชุตููู
- ุชูุฑูุฑ ุงูุฃุตูู ุงููุณุชุจุนุฏุฉ

### ุชูุงุฑูุฑ ุงูุตูุงูุฉ:
- ุชูุฑูุฑ ุงูุตูุงูุฉ ุงูููุงุฆูุฉ
- ุชูุฑูุฑ ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ
- ุชูุฑูุฑ ุฃูุงูุฑ ุงูุนูู
- ุชูุฑูุฑ ุงูุฃุนุทุงู ุงููุชูุฑุฑุฉ
- ุชูุฑูุฑ ููุช ุงูุชููู (Downtime)

### ุชูุงุฑูุฑ ุงูุฃุฏุงุก:
- ุชูุฑูุฑ ุฃุฏุงุก ุงูููููู
- ุชูุฑูุฑ ุฃุฏุงุก ุงูููุงูููู
- ุชูุฑูุฑ ููุงุกุฉ ุงูุตูุงูุฉ (MTBF, MTTR)
- ุชูุฑูุฑ ุงูุงูุชุฒุงู ุจุงูุฌุฏุงูู

### ุชูุงุฑูุฑ ุงูุชูุงููู:
- ุชูุฑูุฑ ุชูุงููู ุงูุตูุงูุฉ
- ุชูุฑูุฑ ุชูุงููู ูุทุน ุงูุบูุงุฑ
- ุชูุฑูุฑ ููุงุฑูุฉ ุงูุชูุงููู ุงููุนููุฉ ุจุงูููุฏุฑุฉ
- ุชูุฑูุฑ ุชูููุฉ ุงูุตูุงูุฉ ููู ุฃุตู

### ุชูุงุฑูุฑ ุงูุชูุจุคุงุช:
- ุชููุน ุงูุฃุนุทุงู
- ุชููุน ุงุญุชูุงุฌุงุช ูุทุน ุงูุบูุงุฑ
- ุชููุน ุชูุงููู ุงูุตูุงูุฉ ุงููุณุชูุจููุฉ

---

## ๐ฐ ุงูุฑุจุท ุงููุญุงุณุจู

### ุงูุญุณุงุจุงุช ุงููุฑุชุจุทุฉ ูู ุดุฌุฑุฉ ุงูุญุณุงุจุงุช:

| ุงูุญุณุงุจ | ุงูุฑูุฒ | ุงูุงุณุชุฎุฏุงู |
|--------|-------|-----------|
| ุงูุฃุตูู ุงูุซุงุจุชุฉ | 14XX | ุชุณุฌูู ุงูุฃุตูู |
| ูุฌูุน ุงูุฅููุงู | 1490 | ุฅููุงู ุงูุฃุตูู |
| ูุตุฑูู ุงูุฅููุงู | 5600 | ูููุฏ ุงูุฅููุงู ุงูุฏูุฑูุฉ |
| ูุตุฑููุงุช ุงูุตูุงูุฉ | 5300 | ุชูุงููู ุงูุตูุงูุฉ |
| ูุฎุฒูู ูุทุน ุงูุบูุงุฑ | 1320 | ูุทุน ุงูุบูุงุฑ |
| ุฃุฑุจุงุญ/ุฎุณุงุฆุฑ ุจูุน ุงูุฃุตูู | 4900/5900 | ุงุณุชุจุนุงุฏ ุงูุฃุตูู |

### ุงููููุฏ ุงูุชููุงุฆูุฉ:

**1. ุดุฑุงุก ุฃุตู:**
```
ูู ุญู/ ุงูุฃุตูู ุงูุซุงุจุชุฉ (14XX)
    ุฅูู ุญู/ ุงูููุฑุฏูู/ุงูุจูู
```

**2. ููุฏ ุงูุฅููุงู ุงูุดูุฑู:**
```
ูู ุญู/ ูุตุฑูู ุงูุฅููุงู (5600)
    ุฅูู ุญู/ ูุฌูุน ุงูุฅููุงู (1490)
```

**3. ุตุฑู ูุทุน ุบูุงุฑ ููุตูุงูุฉ:**
```
ูู ุญู/ ูุตุฑููุงุช ุงูุตูุงูุฉ (5300)
    ุฅูู ุญู/ ูุฎุฒูู ูุทุน ุงูุบูุงุฑ (1320)
```

**4. ุจูุน ุฃุตู:**
```
ูู ุญู/ ุงูุจูู/ุงูููุฏ
ูู ุญู/ ูุฌูุน ุงูุฅููุงู
ูู ุญู/ ุฎุณุงุฆุฑ ุจูุน ุฃุตูู (ุฅู ูุฌุฏุช)
    ุฅูู ุญู/ ุงูุฃุตูู ุงูุซุงุจุชุฉ
    ุฅูู ุญู/ ุฃุฑุจุงุญ ุจูุน ุฃุตูู (ุฅู ูุฌุฏุช)
```

---

## ๐ฑ ุงูุดุงุดุงุช ูุงููุงุฌูุงุช

### 1. ููุญุฉ ุชุญูู ุงูุฃุตูู ูุงูุตูุงูุฉ:
- ูุธุฑุฉ ุนุงูุฉ ุนูู ุงูุฃุตูู
- ุญุงูุฉ ุงูุตูุงูุฉ
- ุงูุชูุจููุงุช ูุงูุชุฐููุฑุงุช
- ูุคุดุฑุงุช ุงูุฃุฏุงุก

### 2. ุฅุฏุงุฑุฉ ุงูุฃุตูู:
- ูุงุฆูุฉ ุงูุฃุตูู
- ุชูุงุตูู ุงูุฃุตู
- ุณุฌู ุงูุฅููุงู
- ุญุฑูุงุช ุงูุฃุตู
- ุงูุฌุฑุฏ

### 3. ุฅุฏุงุฑุฉ ุงูุตูุงูุฉ:
- ุฌุฏุงูู ุงูุตูุงูุฉ ุงูููุงุฆูุฉ
- ุทูุจุงุช ุงูุตูุงูุฉ
- ุฃูุงูุฑ ุงูุนูู
- ุณุฌูุงุช ุงูุตูุงูุฉ

### 4. ุฅุฏุงุฑุฉ ุงูููููู:
- ูุงุฆูุฉ ุงูููููู
- ุงูููุงูููู
- ุงูุนููุฏ
- ุชูููู ุงูุฃุฏุงุก

### 5. ุฅุฏุงุฑุฉ ูุทุน ุงูุบูุงุฑ:
- ูุงุฆูุฉ ุงููุทุน
- ุงููุฎุฒูู
- ุงูุญุฑูุงุช
- ุทูุจุงุช ุงูุชูุฑูุฏ

### 6. ุงูุชูุงุฑูุฑ:
- ุชูุงุฑูุฑ ุงูุฃุตูู
- ุชูุงุฑูุฑ ุงูุตูุงูุฉ
- ุชูุงุฑูุฑ ุงูุชูุงููู
- ุงูุชุญูููุงุช

---

## ๐ APIs

### ุงูุฃุตูู:
```
GET    /api/v1/assets                    - ูุงุฆูุฉ ุงูุฃุตูู
POST   /api/v1/assets                    - ุฅูุดุงุก ุฃุตู
GET    /api/v1/assets/:id                - ุชูุงุตูู ุงูุฃุตู
PUT    /api/v1/assets/:id                - ุชุนุฏูู ุงูุฃุตู
DELETE /api/v1/assets/:id                - ุญุฐู ุงูุฃุตู
GET    /api/v1/assets/:id/depreciation   - ุณุฌู ุงูุฅููุงู
POST   /api/v1/assets/:id/dispose        - ุงุณุชุจุนุงุฏ ุงูุฃุตู
POST   /api/v1/depreciation/run          - ุชุดุบูู ุงูุฅููุงู ุงูุฏูุฑู
```

### ุงูุตูุงูุฉ:
```
GET    /api/v1/maintenance/schedules     - ุฌุฏุงูู ุงูุตูุงูุฉ
POST   /api/v1/maintenance/schedules     - ุฅูุดุงุก ุฌุฏูู
GET    /api/v1/maintenance/requests      - ุทูุจุงุช ุงูุตูุงูุฉ
POST   /api/v1/maintenance/requests      - ุฅูุดุงุก ุทูุจ
GET    /api/v1/work-orders               - ุฃูุงูุฑ ุงูุนูู
POST   /api/v1/work-orders               - ุฅูุดุงุก ุฃูุฑ ุนูู
POST   /api/v1/work-orders/:id/complete  - ุฅููุงู ุฃูุฑ ุงูุนูู
```

### ุงูููููู:
```
GET    /api/v1/technicians               - ูุงุฆูุฉ ุงูููููู
POST   /api/v1/technicians               - ุฅูุดุงุก ููู
GET    /api/v1/contractors               - ูุงุฆูุฉ ุงูููุงูููู
GET    /api/v1/maintenance-contracts     - ุงูุนููุฏ
```

### ูุทุน ุงูุบูุงุฑ:
```
GET    /api/v1/spare-parts               - ูุงุฆูุฉ ุงููุทุน
POST   /api/v1/spare-parts               - ุฅูุดุงุก ูุทุนุฉ
POST   /api/v1/spare-parts/:id/issue     - ุตุฑู ูุทุนุฉ
POST   /api/v1/spare-parts/:id/receive   - ุงุณุชูุงู ูุทุนุฉ
```

---

## โฑ๏ธ ุงูุฌุฏูู ุงูุฒููู

| ุงููููุฉ | ุงููุฏุฉ | ุงูููุงุฑุฏ |
|--------|-------|---------|
| ุฅุฏุงุฑุฉ ุงูุฃุตูู (ุงููููุฉ 18) | 3.75 ุฃุณุงุจูุน | 3 ูุทูุฑูู |
| ุงูุตูุงูุฉ ุงูููุงุฆูุฉ (ุงููููุฉ 19) | 3.75 ุฃุณุงุจูุน | 3 ูุทูุฑูู |
| ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ (ุงููููุฉ 20) | 3.75 ุฃุณุงุจูุน | 3 ูุทูุฑูู |
| ุงูููููู ูุงูููุงูููู (ุงููููุฉ 21) | 3.75 ุฃุณุงุจูุน | 3 ูุทูุฑูู |
| ูุทุน ุงูุบูุงุฑ (ุงููููุฉ 22) | 2.5 ุฃุณุงุจูุน | 2 ูุทูุฑูู |
| ุงูุชูุงุฑูุฑ ูุงูุชุญูููุงุช (ุงููููุฉ 23) | 2.5 ุฃุณุงุจูุน | 2 ูุทูุฑูู |
| **ุงูุฅุฌูุงูู** | **~20 ุฃุณุจูุน** | **700 ุณุงุนุฉ** |

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุฑุจุท ูุน ููู 03:** ูู ุฃุตู ููู (ูููุฏุ ููุญ ุดูุณูุ ููุจู) ูุฌุจ ุฃู ูููู ูู ุณุฌู ูู ูุฐุง ุงููุธุงู ููุฅููุงู ูุงูุตูุงูุฉ
2. **ุงูุฅููุงู ุงูุชููุงุฆู:** ููุญุณุจ ุดูุฑูุงู ููููุดุฆ ูููุฏ ูุญุงุณุจูุฉ ุชููุงุฆูุฉ
3. **ุงูุชูุจููุงุช:** ุชูุจููุงุช ุชููุงุฆูุฉ ููุตูุงูุฉ ุงูุฏูุฑูุฉ ูุงูุฎูุงุถ ุงููุฎุฒูู
4. **ุงูุชูุงูู ูุน ุงูุนูููุงุช ุงูููุฏุงููุฉ:** ููุงู ุงูุตูุงูุฉ ุชููุดุฃ ูู ูุธุงู ุงูุนูููุงุช ุงูููุฏุงููุฉ
5. **ุชุชุจุน ุงูุชูุงููู:** ูู ุนูููุฉ ุตูุงูุฉ ุชูุณุฌู ุชูุงููููุง ููุชุญููู


---

## 13. ุฅุฏุงุฑุฉ ุงูุทุจุงููู ูุชุฎุทูุท ุงูุดุจูุฉ (Distribution Boxes & Network Planning)

> **ุงูุบุฑุถ:** ุฅุฏุงุฑุฉ ุตูุงุฏูู ุงูุชูุฒูุน (ุงูุทุจุงููู) ูุชุฎุทูุท ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ ููุชุฑุญูู ุฅูู IoT.

### 13.1 ุฌุฏูู ุงูุทุจุงููู/ุตูุงุฏูู ุงูุชูุฒูุน (distribution_boxes)

```sql
CREATE TABLE distribution_boxes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID REFERENCES stations(id),
    
    -- ุงูุชุนุฑูู
    box_code VARCHAR(20) UNIQUE NOT NULL,
    box_name VARCHAR(100),
    box_type VARCHAR(30) NOT NULL,  -- 'traditional', 'fiber', 'smart'
    
    -- ุงููููุน
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    address TEXT,
    
    -- ุงูุณุนุฉ
    max_connections INT DEFAULT 20,
    current_connections INT DEFAULT 0,
    
    -- ุงูุญุงูุฉ
    status VARCHAR(20) DEFAULT 'active',  -- 'active', 'planned', 'decommissioned'
    installation_date DATE,
    decommission_date DATE,
    
    -- ููุชุฑุญูู
    replaces_box_id UUID REFERENCES distribution_boxes(id),
    replaced_by_box_id UUID REFERENCES distribution_boxes(id),
    
    -- ุงูุชูููุฉ
    installation_cost DECIMAL(15, 2),
    
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_distribution_boxes_station ON distribution_boxes(station_id);
CREATE INDEX idx_distribution_boxes_type ON distribution_boxes(box_type);
CREATE INDEX idx_distribution_boxes_status ON distribution_boxes(status);
```

### 13.2 ุฌุฏูู ุฎุทุท ุงูุชุฑุญูู (migration_plans)

```sql
CREATE TABLE migration_plans (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID REFERENCES stations(id),
    
    -- ุงูุชุนุฑูู
    plan_code VARCHAR(20) UNIQUE NOT NULL,
    plan_name VARCHAR(200),
    description TEXT,
    
    -- ุงูุทุจุงููู
    new_box_id UUID REFERENCES distribution_boxes(id),
    old_box_id UUID REFERENCES distribution_boxes(id),
    
    -- ุณูุงุณุฉ ุงูุชูููุฉ
    cost_policy VARCHAR(30) NOT NULL,  -- 'free', 'meter_only', 'full_cost', 'partial'
    cost_percentage DECIMAL(5, 2) DEFAULT 100,
    
    -- ุงูุฅุญุตุงุฆูุงุช
    total_customers INT DEFAULT 0,
    total_wire_old DECIMAL(10, 2) DEFAULT 0,
    total_wire_new DECIMAL(10, 2) DEFAULT 0,
    total_wire_saved DECIMAL(10, 2) DEFAULT 0,
    total_cost DECIMAL(15, 2) DEFAULT 0,
    
    -- ุงูุญุงูุฉ
    status VARCHAR(20) DEFAULT 'draft',  -- 'draft', 'approved', 'in_progress', 'completed'
    planned_start_date DATE,
    planned_end_date DATE,
    actual_start_date DATE,
    actual_end_date DATE,
    
    -- ุงูููุงููุงุช
    created_by UUID REFERENCES users(id),
    approved_by UUID REFERENCES users(id),
    approved_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### 13.3 ุฌุฏูู ุชูุงุตูู ุฎุทุฉ ุงูุชุฑุญูู (migration_plan_items)

```sql
CREATE TABLE migration_plan_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    plan_id UUID REFERENCES migration_plans(id),
    customer_id UUID NOT NULL,
    
    -- ุงูููุงุณุงุช
    old_wire_length DECIMAL(6, 2),
    new_wire_length DECIMAL(6, 2),
    wire_saved DECIMAL(6, 2),
    
    -- ุงูุชูููุฉ
    meter_cost DECIMAL(15, 2),
    wire_cost DECIMAL(15, 2),
    installation_cost DECIMAL(15, 2),
    total_cost DECIMAL(15, 2),
    customer_share DECIMAL(15, 2),
    
    -- ุงูุญุงูุฉ
    status VARCHAR(20) DEFAULT 'pending',  -- 'pending', 'invoiced', 'paid', 'work_order_created', 'migrated'
    
    -- ุงูุฑุจุท
    invoice_id UUID,
    work_order_id UUID,
    
    -- ููุนุฏุงุฏุงุช ุงููุฑุชุฌุนุฉ (ุตูุฏูู ุงูุฏุนู)
    old_meter_serial VARCHAR(50),
    old_meter_returned BOOLEAN DEFAULT false,
    returned_to_fund BOOLEAN DEFAULT false,
    return_date DATE,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_migration_items_plan ON migration_plan_items(plan_id);
CREATE INDEX idx_migration_items_customer ON migration_plan_items(customer_id);
CREATE INDEX idx_migration_items_status ON migration_plan_items(status);
```

### 13.4 ุดุงุดุฉ ุฅุฏุงุฑุฉ ุงูุทุจุงููู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ฆ ุฅุฏุงุฑุฉ ุงูุทุจุงููู                              [+ ุฅุถุงูุฉ ุทุจููู ุฌุฏูุฏ]โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                     โ
โ  ุงูููุงุชุฑ: [ุงููุญุทุฉ โผ] [ุงูููุน โผ] [ุงูุญุงูุฉ โผ]           [๐ ุจุญุซ]       โ
โ                                                                     โ
โ  โโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโ โ
โ  โ ุงูููุฏ  โ ุงูุงุณู    โ ุงูููุน    โ ุงููุดุชุฑูููโ ุงูุญุงูุฉ   โ ุฅุฌุฑุงุกุงุช  โ โ
โ  โโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโค โ
โ  โ TB-001 โ ุทุจููู 1  โ ุชูููุฏู   โ 15/20    โ ๐ข ูุดุท  โ [๐๏ธ][โ๏ธ] โ โ
โ  โ TB-002 โ ุทุจููู 2  โ ุชูููุฏู   โ 18/20    โ ๐ข ูุดุท  โ [๐๏ธ][โ๏ธ] โ โ
โ  โ FB-001 โ ููุจุฑ 1   โ ููุจุฑ     โ 8/30     โ ๐ข ูุดุท  โ [๐๏ธ][โ๏ธ] โ โ
โ  โโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโโโโ โ
โ                                                                     โ
โ  ุงูุฅุญุตุงุฆูุงุช:                                                        โ
โ  ุทุจุงููู ุชูููุฏูุฉ: 25 | ุทุจุงููู ููุจุฑ: 8 | ุฅุฌูุงูู ุงููุดุชุฑููู: 450        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 13.5 ุดุงุดุฉ ุชุฎุทูุท ุงูุดุจูุฉ ุงูุฐููุฉ (Smart Grid Planner)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ง ุฃุฏุงุฉ ุชุฎุทูุท ุงูุดุจูุฉ ุงูุฐููุฉ                    [ุญูุธ] [ุชุตุฏูุฑ ุงูุฎุทุฉ] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ         ุงูุฎุฑูุทุฉ                  โ  โ   ุชูุงุตูู ุงูุฎุทุฉ          โ โ
โ  โ                                  โ  โ                          โ โ
โ  โ   ๐ ๐    ๐ฆ ูุฏูู               โ  โ  ุฎุทุฉ: [ุงุณู ุงูุฎุทุฉ      ]  โ โ
โ  โ  ๐  โฒ    โฑ  ๐                  โ  โ                          โ โ
โ  โ      โฒ  โฑ                        โ  โ  ุงูุทุจููู ุงููุฏูู: TB-001  โ โ
โ  โ       โณ ----โ ๐ฆ ุฌุฏูุฏ (ููุจุฑ)    โ  โ  ุงูุทุจููู ุงูุฌุฏูุฏ: FB-002  โ โ
โ  โ      โฑ  โฒ       โ                โ  โ                          โ โ
โ  โ  ๐ โฑ    โฒ ๐   โ ุณุญุจ ูุฅููุงุช    โ  โ  ุงููุดุชุฑููู: 12          โ โ
โ  โ                                  โ  โ                          โ โ
โ  โ  [+ ุฅุถุงูุฉ ุทุจููู ุฌุฏูุฏ]           โ  โ  ุชูููุฑ ุงูุฃุณูุงู: 340 ูุชุฑ โ โ
โ  โ                                  โ  โ                          โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ:      โ โ
โ                                        โ  850,000 ุฑูุงู            โ โ
โ  ุงูุฃุฏูุงุช:                              โ                          โ โ
โ  [๐ฆ ุฅุถุงูุฉ ุทุจููู] [๐ ููุงุณ ุงููุณุงูุฉ]   โ  ุณูุงุณุฉ ุงูุชูููุฉ:          โ โ
โ  [๐ ุฑุจุท ูุดุชุฑู] [โ๏ธ ูู ุงูุฑุจุท]         โ  โ ูุฌุงูู                  โ โ
โ                                        โ  โ ุงูุนุฏุงุฏ ููุท            โ โ
โ                                        โ  โ ุงูุชูููุฉ ุงููุงููุฉ       โ โ
โ                                        โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                     โ
โ  [ุฅูุดุงุก ุงูุฎุทุฉ] [ุงูููุงููุฉ ุนูู ุงูุฎุทุฉ] [ุฅูุดุงุก ุฃูุงูุฑ ุงูุนูู]            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 13.6 ุดุงุดุฉ ุฅุฏุงุฑุฉ ุฎุทุท ุงูุชุฑุญูู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ ุฎุทุท ุงูุชุฑุญูู                                  [+ ุฅูุดุงุก ุฎุทุฉ ุฌุฏูุฏุฉ]โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                     โ
โ  โโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโ โ
โ  โ ุงูููุฏ  โ ุงูุงุณู        โ ุงููุดุชุฑูููโ ุงูุชูููุฑ  โ ุงูุญุงูุฉ   โุฅุฌุฑุงุกุงุชโ โ
โ  โโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโค โ
โ  โ MIG-01 โ ุชุฑุญูู ููุทูุฉ ุฃโ 45       โ 1,200 ู  โ ๐ก ููุฏ   โ[๐๏ธ][โถ๏ธ]โ โ
โ  โ MIG-02 โ ุชุฑุญูู ููุทูุฉ ุจโ 32       โ 850 ู    โ ๐ข ููุชูู โ[๐๏ธ]   โ โ
โ  โ MIG-03 โ ุชุฑุญูู ููุทูุฉ ุฌโ 28       โ 720 ู    โ โช ูุณูุฏุฉ โ[๐๏ธ][โ๏ธ]โ โ
โ  โโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโ โ
โ                                                                     โ
โ  ุงูุฅุญุตุงุฆูุงุช ุงูุฅุฌูุงููุฉ:                                              โ
โ  ุฎุทุท ููุชููุฉ: 5 | ููุฏ ุงูุชูููุฐ: 2 | ูุณูุฏุงุช: 3                         โ
โ  ุฅุฌูุงูู ุงููุฑุญูููู: 450 | ุฅุฌูุงูู ุงูุชูููุฑ: 7,300 ูุชุฑ                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 13.7 APIs ุฅุฏุงุฑุฉ ุงูุทุจุงููู ูุงูุชุฑุญูู

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| **ุงูุทุจุงููู** |
| GET | `/api/v1/distribution-boxes` | ูุงุฆูุฉ ุงูุทุจุงููู |
| POST | `/api/v1/distribution-boxes` | ุฅุถุงูุฉ ุทุจููู ุฌุฏูุฏ |
| GET | `/api/v1/distribution-boxes/:id` | ุชูุงุตูู ุทุจููู |
| PUT | `/api/v1/distribution-boxes/:id` | ุชุญุฏูุซ ุทุจููู |
| GET | `/api/v1/distribution-boxes/:id/customers` | ุงููุดุชุฑููู ุงููุฑุชุจุทูู |
| **ุฎุทุท ุงูุชุฑุญูู** |
| GET | `/api/v1/migration-plans` | ูุงุฆูุฉ ุฎุทุท ุงูุชุฑุญูู |
| POST | `/api/v1/migration-plans` | ุฅูุดุงุก ุฎุทุฉ ุฌุฏูุฏุฉ |
| GET | `/api/v1/migration-plans/:id` | ุชูุงุตูู ุฎุทุฉ |
| PUT | `/api/v1/migration-plans/:id` | ุชุญุฏูุซ ุฎุทุฉ |
| POST | `/api/v1/migration-plans/:id/add-customer` | ุฅุถุงูุฉ ูุดุชุฑู ููุฎุทุฉ |
| DELETE | `/api/v1/migration-plans/:id/remove-customer/:customer_id` | ุฅุฒุงูุฉ ูุดุชุฑู |
| POST | `/api/v1/migration-plans/:id/calculate` | ุญุณุงุจ ุงูุชูุงููู ูุงูุชูููุฑ |
| POST | `/api/v1/migration-plans/:id/approve` | ุงูููุงููุฉ ุนูู ุงูุฎุทุฉ |
| POST | `/api/v1/migration-plans/:id/generate-invoices` | ุฅูุดุงุก ููุงุชูุฑ ุงูุชุฑุญูู |
| POST | `/api/v1/migration-plans/:id/generate-work-orders` | ุฅูุดุงุก ุฃูุงูุฑ ุงูุนูู |
| **ุงูุญุณุงุจุงุช** |
| GET | `/api/v1/geo/distance` | ุญุณุงุจ ุงููุณุงูุฉ ุจูู ููุทุชูู |
| POST | `/api/v1/migration/calculate-wire-savings` | ุญุณุงุจ ุชูููุฑ ุงูุฃุณูุงู |



---

# 13. ุฑุจุท ุงูุฃุตูู ุจุงููุดุงุฑูุน (Asset-Project Integration) - ููู 19

> **ุงูุบุฑุถ:** ุฑุจุท ุงูุฃุตูู ุงููุฑูุจุฉ ุฃู ุงูููุฒุงูุฉ ุจุงููุดุงุฑูุน ูุญุฒู ุงูุนูู ูุชุชุจุน ุดุงูู

## 13.1 ุฅุถุงูุฉ ุญููู ุงููุดุฑูุน ูุฌุฏูู ุงูุฃุตูู

```sql
-- ุฅุถุงูุฉ ุญููู ุงููุดุฑูุน ูุฌุฏูู ุงูุฃุตูู
ALTER TABLE assets ADD COLUMN project_id UUID REFERENCES projects(id);
ALTER TABLE assets ADD COLUMN work_package_id UUID REFERENCES work_packages(id);
ALTER TABLE assets ADD COLUMN installation_work_order_id UUID;

CREATE INDEX idx_assets_project ON assets(project_id);
CREATE INDEX idx_assets_work_package ON assets(work_package_id);
```

## 13.2 ุฌุฏูู ุญุฑูุงุช ุงูุฃุตูู ูู ุงููุดุงุฑูุน (project_asset_movements)

```sql
CREATE TABLE project_asset_movements (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    project_id UUID NOT NULL REFERENCES projects(id),
    work_package_id UUID REFERENCES work_packages(id),
    asset_id UUID NOT NULL REFERENCES assets(id),
    
    -- ููุน ุงูุญุฑูุฉ
    movement_type VARCHAR(20) NOT NULL,
    -- 'installed': ุชู ุชุฑููุจู
    -- 'removed': ุชู ุฅุฒุงูุชู
    -- 'upgraded': ุชู ุชุฑููุชู
    -- 'relocated': ุชู ูููู
    
    -- ุงูุชูุงุตูู
    old_location TEXT,
    new_location TEXT,
    old_status VARCHAR(30),
    new_status VARCHAR(30),
    
    -- ุงูุชูุซูู
    performed_by UUID REFERENCES users(id),
    performed_at TIMESTAMP DEFAULT NOW(),
    photos JSONB,
    notes TEXT,
    
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_project_asset_movements_project ON project_asset_movements(project_id);
CREATE INDEX idx_project_asset_movements_asset ON project_asset_movements(asset_id);
```

## 13.3 ุดุงุดุฉ ุฃุตูู ุงููุดุฑูุน

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ฆ ุฃุตูู ุงููุดุฑูุน: ุชุฑุญูู ุญู ุงูุณูุงู ุฅูู IoT                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  โโ ููุฎุต ุงูุฃุตูู โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ ุฃุตูู ูุฑูุจุฉ: 53 | ุฃุตูู ููุฒุงูุฉ: 45 | ุฃุตูู ููุฑูุงุฉ: 3                     โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                             โ
โ  โโ ุงูุฃุตูู ุงููุฑูุจุฉ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ ุงูููุน        โ ุงูุฑูู ุงูุชุณูุณูู โ ุงููููุน      โ ุญุฒูุฉ ุงูุนูู โ ุงูุชุงุฑูุฎ    โ โ
โ  โ ุนุฏุงุฏ IoT     โ MTR-IOT-001    โ ุดุงุฑุน X #12  โ ุญุฒูุฉ 2     โ 2025-01-15 โ โ
โ  โ ุนุฏุงุฏ IoT     โ MTR-IOT-002    โ ุดุงุฑุน X #14  โ ุญุฒูุฉ 2     โ 2025-01-15 โ โ
โ  โ ุทุจููู ููุจุฑ   โ FB-003         โ ุชูุงุทุน Y     โ ุญุฒูุฉ 1     โ 2025-01-10 โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                             โ
โ  โโ ุงูุฃุตูู ุงูููุฒุงูุฉ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ ุงูููุน        โ ุงูุฑูู ุงูุชุณูุณูู โ ุงูุญุงูุฉ      โ ุญุฒูุฉ ุงูุนูู โ ุงูุชุงุฑูุฎ    โ โ
โ  โ ุนุฏุงุฏ ุชูููุฏู  โ MTR-OLD-101    โ ุตุงูุญ ููุจูุน  โ ุญุฒูุฉ 2     โ 2025-01-15 โ โ
โ  โ ุนุฏุงุฏ ุชูููุฏู  โ MTR-OLD-102    โ ุชุงูู        โ ุญุฒูุฉ 2     โ 2025-01-15 โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                             โ
โ  [ุชุตุฏูุฑ ุงูุชูุฑูุฑ]                                                           โ
โ                                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 13.4 APIs ุฑุจุท ุงูุฃุตูู ุจุงููุดุงุฑูุน

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| GET | `/api/v1/projects/:id/assets` | ุฃุตูู ูุดุฑูุน ูุนูู |
| GET | `/api/v1/projects/:id/assets/installed` | ุงูุฃุตูู ุงููุฑูุจุฉ |
| GET | `/api/v1/projects/:id/assets/removed` | ุงูุฃุตูู ุงูููุฒุงูุฉ |
| POST | `/api/v1/projects/:id/assets/movement` | ุชุณุฌูู ุญุฑูุฉ ุฃุตู |
| GET | `/api/v1/assets/:id/project-history` | ุชุงุฑูุฎ ุงูุฃุตู ูู ุงููุดุงุฑูุน |
| GET | `/api/v1/work-packages/:id/assets` | ุฃุตูู ุญุฒูุฉ ุนูู |


---

## ุงูุชูุงูู ูุน ูุธุงู ุงูุชุฎุทูุท ูุงููุดุงุฑูุน (10)

> **ููุชูุงุตูู ุงููุงููุฉ ุนู ุฑุจุท ุงูุฃุตูู ุจุงููุดุงุฑูุนุ ุฑุงุฌุน:** [ูุธุงู ุงูุชุฎุทูุท ูุงููุดุงุฑูุน (10)](./10_ูุธุงู_ุงูุชุฎุทูุท_ูุงููุดุงุฑูุน.md)

### ุงูุญููู ุงููุฑุชุจุทุฉ ูู ุฌุฏูู ุงูุฃุตูู

| ุงูุญูู | ุงููุตู |
|-------|-------|
| `project_id` | ุงููุดุฑูุน ุงูุฐู ุชู ุชุฑููุจ ุงูุฃุตู ุถููู |
| `installation_work_package_id` | ุญุฒูุฉ ุงูุนูู ุงูุชู ุชู ุงูุชุฑููุจ ูููุง |

---

# 12. ุฑุณููุฉ ุงูุฃุตูู ูู ุงููุดุงุฑูุน (Asset Capitalization from Projects)

> **ุงูุบุฑุถ:** ุงุณุชูุงู ุงูุฃุตูู ุงูููุดุฃุฉ ูู ุงููุดุงุฑูุน ูุฅุฏุฑุงุฌูุง ูู ุณุฌู ุงูุฃุตูู ูุน ุฌุฏุงูู ุงูุฅููุงู

## 12.1 ูุตุงุฏุฑ ุงูุฃุตูู

| ุงููุตุฏุฑ | ุงููุตู | ุงูููุฏ ุงููุญุงุณุจู |
|--------|-------|----------------|
| **ุดุฑุงุก ูุจุงุดุฑ** | ุดุฑุงุก ุฃุตู ุฌุงูุฒ | ูุฏูู: ุฃุตูู ุซุงุจุชุฉุ ุฏุงุฆู: ููุฏ/ุฏุงุฆููู |
| **ูุดุฑูุน ุฑุฃุณูุงูู** | ุฅูุดุงุก ุฃุตู ูู ูุดุฑูุน | ูุฏูู: ุฃุตูู ุซุงุจุชุฉุ ุฏุงุฆู: ูุดุงุฑูุน ุชุญุช ุงูุชูููุฐ |
| **ุชุจุฑุน/ูุจุฉ** | ุฃุตู ูุณุชูู ููุจุฉ | ูุฏูู: ุฃุตูู ุซุงุจุชุฉุ ุฏุงุฆู: ุฅูุฑุงุฏุงุช ุฃุฎุฑู |
| **ุชุญููู ุฏุงุฎูู** | ุชุญููู ูู ูุฑุน ุขุฎุฑ | ูุฏูู: ุฃุตูู ุซุงุจุชุฉุ ุฏุงุฆู: ุญุณุงุจ ุฌุงุฑู ุงููุฑูุน |

## 12.2 ุฌุฏูู ูุตุงุฏุฑ ุงูุฃุตูู (asset_sources)

```sql
CREATE TABLE asset_sources (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    asset_id UUID REFERENCES assets(id) NOT NULL,
    
    -- ููุน ุงููุตุฏุฑ
    source_type VARCHAR(30) NOT NULL,
    -- 'purchase': ุดุฑุงุก ูุจุงุดุฑ
    -- 'project': ูุดุฑูุน ุฑุฃุณูุงูู
    -- 'donation': ุชุจุฑุน/ูุจุฉ
    -- 'transfer': ุชุญููู ุฏุงุฎูู
    -- 'upgrade': ุชุฑููุฉ ุฃุตู ูุงุฆู
    
    -- ุงููุฑุฌุน
    reference_type VARCHAR(30),
    reference_id UUID,
    reference_number VARCHAR(50),
    
    -- ูููุดุงุฑูุน
    project_id UUID REFERENCES projects(id),
    project_closure_id UUID,
    project_asset_id UUID,
    
    -- ูููุดุชุฑูุงุช
    purchase_order_id UUID,
    supplier_id UUID,
    invoice_number VARCHAR(50),
    
    -- ุงูุชูููุฉ
    acquisition_cost DECIMAL(15, 2) NOT NULL,
    additional_costs DECIMAL(15, 2) DEFAULT 0, -- ุชูุงููู ุงูุชุฑููุจุ ุงููููุ ุฅูุฎ
    total_cost DECIMAL(15, 2),
    
    -- ุงูุชูุงุฑูุฎ
    acquisition_date DATE NOT NULL,
    capitalization_date DATE,
    
    -- ุงูููุฏ ุงููุญุงุณุจู
    journal_entry_id UUID,
    
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Trigger ูุญุณุงุจ ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ
CREATE OR REPLACE FUNCTION calculate_total_asset_cost()
RETURNS TRIGGER AS $$
BEGIN
    NEW.total_cost := NEW.acquisition_cost + COALESCE(NEW.additional_costs, 0);
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_calculate_asset_cost
BEFORE INSERT OR UPDATE ON asset_sources
FOR EACH ROW
EXECUTE FUNCTION calculate_total_asset_cost();
```

## 12.3 ุดุงุดุฉ ุงุณุชูุงู ุฃุตู ูู ูุดุฑูุน

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐๏ธ ุงุณุชูุงู ุฃุตู ูู ูุดุฑูุน                                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                                 โ
โ  โโ ูุนูููุงุช ุงููุดุฑูุน โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ ุงููุดุฑูุน: PRJ-2025-001 - ูุดุฑูุน ุชูุฏูุฏ ุดุจูุฉ ุงูููุจุฑ                           โ  โ
โ  โ ุชุงุฑูุฎ ุงูุฅุบูุงู: 15/06/2025                                                 โ  โ
โ  โ ุฅุฌูุงูู ุงูุชูููุฉ: 485,000 ุฑูุงู                                              โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ  โโ ุงูุฃุตูู ุงููุณุชููุฉ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ                                                                           โ  โ
โ  โ โ ุดุจูุฉ ููุจุฑ - ุงูููุทูุฉ ุฃ                                                  โ  โ
โ  โ    ุงูููุฏ: AST-2025-0156                                                   โ  โ
โ  โ    ุงููุฆุฉ: ุดุจูุงุช ูุฎุทูุท                                                     โ  โ
โ  โ    ุงูุชูููุฉ: 200,000 ุฑูุงู                                                  โ  โ
โ  โ    ุงูุนูุฑ ุงูุงูุชุฑุงุถู: 15 ุณูุฉ                                                โ  โ
โ  โ    ุงูุฅููุงู ุงูุณููู: 13,333 ุฑูุงู                                            โ  โ
โ  โ                                                                           โ  โ
โ  โ โ ุดุจูุฉ ููุจุฑ - ุงูููุทูุฉ ุจ                                                  โ  โ
โ  โ    ุงูููุฏ: AST-2025-0157                                                   โ  โ
โ  โ    ุงููุฆุฉ: ุดุจูุงุช ูุฎุทูุท                                                     โ  โ
โ  โ    ุงูุชูููุฉ: 180,000 ุฑูุงู                                                  โ  โ
โ  โ    ุงูุนูุฑ ุงูุงูุชุฑุงุถู: 15 ุณูุฉ                                                โ  โ
โ  โ    ุงูุฅููุงู ุงูุณููู: 12,000 ุฑูุงู                                            โ  โ
โ  โ                                                                           โ  โ
โ  โ โ ูุญุทุฉ ุชูุฒูุน ุฑุฆูุณูุฉ                                                      โ  โ
โ  โ    ุงูููุฏ: AST-2025-0158                                                   โ  โ
โ  โ    ุงููุฆุฉ: ูุญุทุงุช ููุจุงูู                                                    โ  โ
โ  โ    ุงูุชูููุฉ: 80,000 ุฑูุงู                                                   โ  โ
โ  โ    ุงูุนูุฑ ุงูุงูุชุฑุงุถู: 20 ุณูุฉ                                                โ  โ
โ  โ    ุงูุฅููุงู ุงูุณููู: 4,000 ุฑูุงู                                             โ  โ
โ  โ                                                                           โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ  โโ ููุฎุต ุงูุฑุณููุฉ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ ุนุฏุฏ ุงูุฃุตูู: 4                                                             โ  โ
โ  โ ุฅุฌูุงูู ุงูุชูููุฉ: 485,000 ุฑูุงู                                              โ  โ
โ  โ ุฅุฌูุงูู ุงูุฅููุงู ุงูุณููู: 34,333 ุฑูุงู                                        โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ  [ุนุฑุถ ุงูููุฏ ุงููุญุงุณุจู]  [ุทุจุงุนุฉ ุชูุฑูุฑ ุงูุฑุณููุฉ]                                   โ
โ                                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 12.4 ุชูุฑูุฑ ุงูุฃุตูู ุงููุฑุณููุฉ ูู ุงููุดุงุฑูุน

```sql
CREATE VIEW v_project_capitalized_assets AS
SELECT 
    p.project_number,
    p.project_name,
    pc.closure_date,
    a.asset_code,
    a.asset_name,
    ac.category_name,
    asrc.acquisition_cost,
    asrc.additional_costs,
    asrc.total_cost,
    a.useful_life_years,
    a.annual_depreciation,
    a.accumulated_depreciation,
    a.net_book_value
FROM assets a
JOIN asset_sources asrc ON asrc.asset_id = a.id
JOIN projects p ON p.id = asrc.project_id
JOIN project_closures pc ON pc.id = asrc.project_closure_id
LEFT JOIN asset_categories ac ON ac.id = a.category_id
WHERE asrc.source_type = 'project'
ORDER BY pc.closure_date DESC, a.asset_code;
```

## 12.5 APIs ุฑุณููุฉ ุงูุฃุตูู

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| GET | `/api/v1/assets/from-projects` | ุงูุฃุตูู ุงููุฑุณููุฉ ูู ุงููุดุงุฑูุน |
| GET | `/api/v1/assets/:id/source` | ูุตุฏุฑ ุงูุฃุตู |
| GET | `/api/v1/projects/:id/assets` | ุฃุตูู ุงููุดุฑูุน |
| POST | `/api/v1/assets/capitalize` | ุฑุณููุฉ ุฃุตู ูุฏููุงู |

---

# 13. ุฏูุฑุฉ ุญูุงุฉ ุงูุฃุตูู ุงูุฏููุงููููุฉ (Dynamic Asset Lifecycle)

> **ุงูุบุฑุถ:** ุชุญููู ุงูุฃุตู ูู ููุฏ ูุญุงุณุจู ุฌุงูุฏ ุฅูู ูุงุฆู ุญู ุฏููุงูููู ูุชุทูุฑ ูุน ุงูุฒูู

## 13.1 ุงููุจุฏุฃ ุงูุฃุณุงุณู

```
ุงููุดุฑูุน โ ุฅุบูุงู ุงููุดุฑูุน โ ุฃุตู ุฏููุงูููู โ ุตูุงูุฉ โ ุชุฌุฏูุฏ โ ุงุณุชุจุฏุงู
                           โ
                    (ูุงุฆู ุญู ูุชุทูุฑ)
```

## 13.2 ุฌุฏูู ููููุงุช ุงูุฃุตู ุงูุนุงู (asset_components)

```sql
CREATE TABLE asset_components (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    asset_id UUID REFERENCES assets(id) NOT NULL,
    
    -- ูุนูููุงุช ุงููููู
    component_name VARCHAR(200) NOT NULL,
    component_type VARCHAR(50) NOT NULL,
    -- 'panel': ููุญ ุดูุณู
    -- 'inverter': ุฅููุฑุชุฑ
    -- 'transformer': ูุญูู
    -- 'cable': ูุงุจู
    -- 'meter': ุนุฏุงุฏ
    -- 'breaker': ูุงุทุน
    -- 'other': ุฃุฎุฑู
    
    -- ุงูุชุนุฑูู
    serial_number VARCHAR(100),
    model VARCHAR(100),
    manufacturer VARCHAR(100),
    
    -- ุงููููุงุช
    quantity INTEGER DEFAULT 1,
    unit VARCHAR(20) DEFAULT 'unit',
    
    -- ุงูุชูููุฉ
    unit_cost DECIMAL(15, 2),
    total_cost DECIMAL(15, 2),
    
    -- ุงููุตุฏุฑ
    source_type VARCHAR(30),
    -- 'project': ูู ูุดุฑูุน
    -- 'purchase': ุดุฑุงุก ูุจุงุดุฑ
    -- 'replacement': ุงุณุชุจุฏุงู
    -- 'addition': ุฅุถุงูุฉ ุฑุฃุณูุงููุฉ
    source_id UUID,
    source_date DATE,
    
    -- ุงูุญุงูุฉ
    status VARCHAR(20) DEFAULT 'active',
    -- 'active': ูุดุท
    -- 'replaced': ูุณุชุจุฏู
    -- 'disposed': ูุณุชุจุนุฏ
    -- 'damaged': ุชุงูู
    
    -- ุงูุงุณุชุจุฏุงู
    replaced_by_id UUID REFERENCES asset_components(id),
    replaced_at TIMESTAMP,
    replacement_reason TEXT,
    
    -- ุงูุถูุงู
    warranty_start_date DATE,
    warranty_end_date DATE,
    warranty_provider VARCHAR(200),
    
    -- ุงููููุน ุฏุงุฎู ุงูุฃุตู
    location_in_asset VARCHAR(200),
    
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ููุฑุณ ููุจุญุซ ุงูุณุฑูุน
CREATE INDEX idx_asset_components_asset ON asset_components(asset_id);
CREATE INDEX idx_asset_components_serial ON asset_components(serial_number);
CREATE INDEX idx_asset_components_status ON asset_components(status);
```

## 13.3 ุฌุฏูู ุงูุฅุถุงูุงุช ุงูุฑุฃุณูุงููุฉ (capital_additions)

```sql
CREATE TABLE capital_additions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    asset_id UUID REFERENCES assets(id) NOT NULL,
    
    -- ุฑูู ุงูุฅุถุงูุฉ
    addition_number VARCHAR(20) UNIQUE NOT NULL,
    
    -- ุงููุตู
    description TEXT NOT NULL,
    addition_type VARCHAR(30) NOT NULL,
    -- 'expansion': ุชูุณุนุฉ
    -- 'upgrade': ุชุฑููุฉ
    -- 'improvement': ุชุญุณูู
    -- 'renovation': ุชุฌุฏูุฏ
    
    -- ุงููุตุฏุฑ
    source_type VARCHAR(30),
    -- 'project': ูู ูุดุฑูุน
    -- 'purchase': ุดุฑุงุก ูุจุงุดุฑ
    project_id UUID REFERENCES projects(id),
    project_closure_id UUID,
    
    -- ุงูุชูููุฉ
    addition_cost DECIMAL(15, 2) NOT NULL,
    
    -- ุงูุชูุงุฑูุฎ
    addition_date DATE NOT NULL,
    capitalization_date DATE,
    
    -- ุชุฃุซูุฑ ุนูู ุงูุฅููุงู
    extends_useful_life BOOLEAN DEFAULT FALSE,
    additional_years INTEGER DEFAULT 0,
    
    -- ุงูููู ูุจู ูุจุนุฏ
    asset_value_before DECIMAL(15, 2),
    asset_value_after DECIMAL(15, 2),
    
    -- ุงูููุฏ ุงููุญุงุณุจู
    journal_entry_id UUID,
    
    -- ุงูููุงููุงุช
    prepared_by UUID REFERENCES users(id),
    approved_by UUID REFERENCES users(id),
    approved_at TIMESTAMP,
    
    -- ุงูุญุงูุฉ
    status VARCHAR(20) DEFAULT 'pending',
    -- 'pending': ุจุงูุชุธุงุฑ ุงูููุงููุฉ
    -- 'approved': ููุงูู ุนููู
    -- 'capitalized': ุชู ุงูุฑุณููุฉ
    
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Trigger ูุชุญุฏูุซ ูููุฉ ุงูุฃุตู
CREATE OR REPLACE FUNCTION update_asset_value_on_addition()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.status = 'capitalized' AND OLD.status = 'approved' THEN
        -- ุชุญุฏูุซ ูููุฉ ุงูุฃุตู
        UPDATE assets 
        SET 
            acquisition_cost = acquisition_cost + NEW.addition_cost,
            useful_life_years = CASE 
                WHEN NEW.extends_useful_life THEN useful_life_years + NEW.additional_years 
                ELSE useful_life_years 
            END,
            updated_at = NOW()
        WHERE id = NEW.asset_id;
        
        -- ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุฅููุงู ุงูุณููู
        PERFORM recalculate_depreciation(NEW.asset_id);
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_capital_addition
AFTER UPDATE ON capital_additions
FOR EACH ROW
EXECUTE FUNCTION update_asset_value_on_addition();
```

## 13.4 ุฌุฏูู ุณุฌู ุงูุฃุตู ุงูุชุงุฑูุฎู (asset_history)

```sql
CREATE TABLE asset_history (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    asset_id UUID REFERENCES assets(id) NOT NULL,
    
    -- ููุน ุงูุญุฏุซ
    event_type VARCHAR(30) NOT NULL,
    -- 'created': ุฅูุดุงุก
    -- 'capitalized': ุฑุณููุฉ
    -- 'maintenance': ุตูุงูุฉ
    -- 'repair': ุฅุตูุงุญ
    -- 'replacement': ุงุณุชุจุฏุงู ูููู
    -- 'addition': ุฅุถุงูุฉ ุฑุฃุณูุงููุฉ
    -- 'revaluation': ุฅุนุงุฏุฉ ุชูููู
    -- 'impairment': ุงุถูุญูุงู
    -- 'disposal': ุงุณุชุจุนุงุฏ
    -- 'transfer': ููู
    
    -- ุชุงุฑูุฎ ุงูุญุฏุซ
    event_date TIMESTAMP NOT NULL DEFAULT NOW(),
    
    -- ุงููุตู
    event_description TEXT NOT NULL,
    
    -- ุงููุฑุฌุน
    reference_type VARCHAR(30),
    reference_id UUID,
    reference_number VARCHAR(50),
    
    -- ุงูุชุฃุซูุฑ ุงููุงูู
    cost_impact DECIMAL(15, 2) DEFAULT 0,
    value_before DECIMAL(15, 2),
    value_after DECIMAL(15, 2),
    
    -- ุงููููู ุงููุชุฃุซุฑ (ุฅู ูุฌุฏ)
    component_id UUID REFERENCES asset_components(id),
    
    -- ุงููุณุชุฎุฏู
    performed_by UUID REFERENCES users(id),
    
    -- ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ
    metadata JSONB,
    
    created_at TIMESTAMP DEFAULT NOW()
);

-- ููุฑุณ ููุจุญุซ ุงูุณุฑูุน
CREATE INDEX idx_asset_history_asset ON asset_history(asset_id);
CREATE INDEX idx_asset_history_date ON asset_history(event_date);
CREATE INDEX idx_asset_history_type ON asset_history(event_type);
```

## 13.5 View: ุงูููู ุงูุชุงุฑูุฎู ุงูุดุงูู ููุฃุตู

```sql
CREATE VIEW v_asset_complete_profile AS
SELECT 
    a.id AS asset_id,
    a.asset_code,
    a.asset_name,
    ac.category_name,
    
    -- ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ
    a.acquisition_date,
    a.commissioning_date,
    a.acquisition_cost AS original_cost,
    
    -- ุงูุฅุถุงูุงุช ุงูุฑุฃุณูุงููุฉ
    COALESCE(ca.total_additions, 0) AS capital_additions,
    COALESCE(ca.additions_count, 0) AS additions_count,
    
    -- ุงููููุฉ ุงูุญุงููุฉ
    a.acquisition_cost + COALESCE(ca.total_additions, 0) AS current_gross_value,
    a.accumulated_depreciation,
    a.acquisition_cost + COALESCE(ca.total_additions, 0) - a.accumulated_depreciation AS net_book_value,
    
    -- ุงูุฅููุงู
    a.useful_life_years,
    a.depreciation_method,
    a.annual_depreciation,
    
    -- ุชูุงููู ุงูุตูุงูุฉ
    COALESCE(m.total_maintenance_cost, 0) AS total_maintenance_cost,
    COALESCE(m.maintenance_count, 0) AS maintenance_count,
    
    -- ุชูุงููู ุงูุงุณุชุจุฏุงู
    COALESCE(r.total_replacement_cost, 0) AS total_replacement_cost,
    COALESCE(r.replacement_count, 0) AS replacement_count,
    
    -- TCO (ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ ููููููุฉ)
    a.acquisition_cost + COALESCE(ca.total_additions, 0) + 
    COALESCE(m.total_maintenance_cost, 0) + COALESCE(r.total_replacement_cost, 0) AS total_cost_of_ownership,
    
    -- ุงูููููุงุช
    COALESCE(comp.active_components, 0) AS active_components_count,
    
    -- ุงูุญุงูุฉ
    a.status,
    a.condition_rating
    
FROM assets a
LEFT JOIN asset_categories ac ON ac.id = a.category_id
LEFT JOIN (
    SELECT asset_id, SUM(addition_cost) AS total_additions, COUNT(*) AS additions_count
    FROM capital_additions WHERE status = 'capitalized'
    GROUP BY asset_id
) ca ON ca.asset_id = a.id
LEFT JOIN (
    SELECT asset_id, SUM(total_cost) AS total_maintenance_cost, COUNT(*) AS maintenance_count
    FROM maintenance_orders WHERE status = 'completed'
    GROUP BY asset_id
) m ON m.asset_id = a.id
LEFT JOIN (
    SELECT asset_id, SUM(component_cost) AS total_replacement_cost, COUNT(*) AS replacement_count
    FROM component_replacements
    GROUP BY asset_id
) r ON r.asset_id = a.id
LEFT JOIN (
    SELECT asset_id, COUNT(*) AS active_components
    FROM asset_components WHERE status = 'active'
    GROUP BY asset_id
) comp ON comp.asset_id = a.id;
```

## 13.6 ุดุงุดุฉ ุงูููู ุงูุชุงุฑูุฎู ููุฃุตู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ ุงูููู ุงูุชุงุฑูุฎู ุงูุดุงูู ููุฃุตู                                                 โ
โ FA-2025-001 - ูุญุทุฉ ุงูุทุงูุฉ ุงูุดูุณูุฉ - ูููุน X                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                                 โ
โ  โโ 1๏ธโฃ ูุนูููุงุช ุงูุฃุตู โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ ุงูููุฏ: FA-2025-001                                                       โ  โ
โ  โ ุงูุงุณู: ูุญุทุฉ ุงูุทุงูุฉ ุงูุดูุณูุฉ - ูููุน X                                     โ  โ
โ  โ ุงููุฆุฉ: ุฃุตูู ุซุงุจุชุฉ - ูุญุทุงุช                                               โ  โ
โ  โ ุชุงุฑูุฎ ุงูุงูุชูุงุก: 15/12/2025                                               โ  โ
โ  โ ุชุงุฑูุฎ ุงูุชุดุบูู: 30/03/2026                                                โ  โ
โ  โ ุงูุญุงูุฉ: ูุดุท                                                              โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ  โโ 2๏ธโฃ ุงูููู ุงููุงููุฉ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ ุงูุชูููุฉ ุงูุฃุตููุฉ: ............... 5,000,000 ุฑูุงู                          โ  โ
โ  โ ุงูุฅุถุงูุงุช ุงูุฑุฃุณูุงููุฉ: ........... 1,500,000 ุฑูุงู                          โ  โ
โ  โ ุงููููุฉ ุงูุฅุฌูุงููุฉ: .............. 6,500,000 ุฑูุงู                          โ  โ
โ  โ ุงูุฅููุงู ุงููุชุฑุงูู: .............. (260,000) ุฑูุงู                          โ  โ
โ  โ ุงููููุฉ ุงูุฏูุชุฑูุฉ: ............... 6,240,000 ุฑูุงู                          โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ  โโ 3๏ธโฃ ุงูููููุงุช ุงููุดุทุฉ (2,013 ูููู) โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ โข 1,500 ร ููุญ ุดูุณู (SN-001 ุฅูู SN-1500)                                 โ  โ
โ  โ โข 500 ร ููุญ ุดูุณู ุฅุถุงูู (SN-1501 ุฅูู SN-2000)                            โ  โ
โ  โ โข 10 ร ุฅููุฑุชุฑ (9 ุฃุตูู + 1 ุจุฏูู)                                         โ  โ
โ  โ โข 3 ร ุทุจููู ุชูุฒูุน                                                        โ  โ
โ  โ [ุนุฑุถ ุงูุชูุงุตูู]                                                           โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ  โโ 4๏ธโฃ ุณุฌู ุงูุฃุญุฏุงุซ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ ๐ 30/03/2026 โ ุฑุณููุฉ    โ ุฅูุดุงุก ุงูุฃุตู ูู ุงููุดุฑูุน PRJ-001              โ  โ
โ  โ ๐ 15/01/2026 โ ุตูุงูุฉ    โ ุชูุธูู ุฃููุงุญ ุฑุจุน ุณููู - 30,000 ุฑูุงู          โ  โ
โ  โ ๐ 20/05/2026 โ ุงุณุชุจุฏุงู  โ ุงุณุชุจุฏุงู ุฅููุฑุชุฑ INV-005 - 105,000 ุฑูุงู       โ  โ
โ  โ ๐ 15/06/2026 โ ุฅุถุงูุฉ    โ ุชูุณุนุฉ 500 ููุญ - 1,000,000 ุฑูุงู              โ  โ
โ  โ ๐ 01/12/2026 โ ุฅุถุงูุฉ    โ ุชุฑููุฉ ุงููุธุงู - 500,000 ุฑูุงู                 โ  โ
โ  โ [ุนุฑุถ ุงูุณุฌู ุงููุงูู]                                                       โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ  โโ 5๏ธโฃ ุชุญููู TCO (ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ ููููููุฉ) โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ ุงูุชูููุฉ ุงูุฑุฃุณูุงููุฉ: ............ 6,500,000 ุฑูุงู                          โ  โ
โ  โ ุชูุงููู ุงูุตูุงูุฉ: ................ 230,000 ุฑูุงู                            โ  โ
โ  โ ุชูุงููู ุงูุงุณุชุจุฏุงู: .............. 105,000 ุฑูุงู                            โ  โ
โ  โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                         โ  โ
โ  โ ุฅุฌูุงูู TCO: .................... 6,835,000 ุฑูุงู                          โ  โ
โ  โ ูุชูุณุท ุงูุชูููุฉ ุงูุณูููุฉ: ......... 6,835,000 ุฑูุงู                          โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ  [ุทุจุงุนุฉ ุงูุชูุฑูุฑ]  [ุชุตุฏูุฑ Excel]  [ุนุฑุถ ูุฎุทุท ุงูุฅููุงู]                            โ
โ                                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 13.7 ุฑุจุท ุงูุตูุงูุฉ ุจุงูุฃุตูู

### ุชุญุฏูุซ ุฌุฏูู ุฃูุงูุฑ ุงูุนูู

```sql
-- ุฅุถุงูุฉ ุญููู ุฑุจุท ุงูุฃุตู ูู ุฌุฏูู ุฃูุงูุฑ ุงูุนูู
ALTER TABLE work_orders ADD COLUMN IF NOT EXISTS asset_id UUID REFERENCES assets(id);
ALTER TABLE work_orders ADD COLUMN IF NOT EXISTS component_id UUID REFERENCES asset_components(id);

-- ููุฑุณ ููุจุญุซ
CREATE INDEX IF NOT EXISTS idx_work_orders_asset ON work_orders(asset_id);
```

### Trigger: ุชุณุฌูู ุงูุตูุงูุฉ ูู ุณุฌู ุงูุฃุตู

```sql
CREATE OR REPLACE FUNCTION log_maintenance_to_asset_history()
RETURNS TRIGGER AS $$
BEGIN
    -- ุนูุฏ ุฅููุงู ุฃูุฑ ุนูู ูุฑุชุจุท ุจุฃุตู
    IF NEW.status = 'completed' AND NEW.asset_id IS NOT NULL THEN
        INSERT INTO asset_history (
            asset_id,
            event_type,
            event_date,
            event_description,
            reference_type,
            reference_id,
            reference_number,
            cost_impact,
            component_id,
            performed_by
        ) VALUES (
            NEW.asset_id,
            CASE 
                WHEN NEW.operation_type = 'maintenance' THEN 'maintenance'
                WHEN NEW.operation_type = 'repair' THEN 'repair'
                ELSE 'maintenance'
            END,
            NOW(),
            NEW.description,
            'work_order',
            NEW.id,
            NEW.work_order_number,
            NEW.total_cost,
            NEW.component_id,
            NEW.completed_by
        );
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_log_maintenance_history
AFTER UPDATE ON work_orders
FOR EACH ROW
WHEN (NEW.status = 'completed' AND NEW.asset_id IS NOT NULL)
EXECUTE FUNCTION log_maintenance_to_asset_history();
```

## 13.8 APIs ุฏูุฑุฉ ุญูุงุฉ ุงูุฃุตูู

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| GET | `/api/v1/assets/:id/profile` | ุงูููู ุงูุดุงูู ููุฃุตู |
| GET | `/api/v1/assets/:id/components` | ููููุงุช ุงูุฃุตู |
| POST | `/api/v1/assets/:id/components` | ุฅุถุงูุฉ ูููู |
| PUT | `/api/v1/assets/:id/components/:compId` | ุชุญุฏูุซ ูููู |
| POST | `/api/v1/assets/:id/components/:compId/replace` | ุงุณุชุจุฏุงู ูููู |
| GET | `/api/v1/assets/:id/history` | ุณุฌู ุงูุฃุตู ุงูุชุงุฑูุฎู |
| GET | `/api/v1/assets/:id/additions` | ุงูุฅุถุงูุงุช ุงูุฑุฃุณูุงููุฉ |
| POST | `/api/v1/assets/:id/additions` | ุฅุถุงูุฉ ุฑุฃุณูุงููุฉ ุฌุฏูุฏุฉ |
| POST | `/api/v1/assets/:id/additions/:addId/approve` | ุงูููุงููุฉ ุนูู ุงูุฅุถุงูุฉ |
| GET | `/api/v1/assets/:id/tco` | ุชุญููู TCO |
| GET | `/api/v1/assets/:id/depreciation-schedule` | ุฌุฏูู ุงูุฅููุงู |

---

# 14. ุฅุฏุฎุงู ูุชุณุฌูู ุงูุฃุตูู ุงููุงุฆูุฉ (Existing Assets Registration)

> **ุงูุบุฑุถ:** ุชูููุฑ ุฃุฏูุงุช ูุฑูุฉ ูุฅุฌุฑุงุก ุฌุฑุฏ ุดุงูู ูุฌููุน ุฃุตูู ุงูุดุฑูุฉ ุงูุญุงููุฉ ูุฅุฏุฎุงููุง ูู ุงููุธุงู

## 14.1 ููุงุฐุฌ ุชุนุฑูู ุงูุฃุตูู (Asset Definition Templates)

### ุฌุฏูู ููุงูุจ ุงูุฃุตูู

```sql
CREATE TABLE asset_templates (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- ูุนูููุงุช ุงููุงูุจ
    template_name VARCHAR(100) NOT NULL,
    template_code VARCHAR(20) UNIQUE NOT NULL,
    category_id UUID REFERENCES asset_categories(id),
    description TEXT,
    
    -- ุงูุญููู ุงููุฎุตุตุฉ (JSON Schema)
    custom_fields JSONB NOT NULL DEFAULT '[]',
    -- ูุซุงู:
    -- [
    --   {"name": "manufacturer", "label": "ุงูุดุฑูุฉ ุงููุตูุนุฉ", "type": "text", "required": true},
    --   {"name": "model", "label": "ุงูููุฏูู", "type": "text", "required": true},
    --   {"name": "capacity_kva", "label": "ุงููุฏุฑุฉ (KVA)", "type": "number", "required": false},
    --   {"name": "operating_hours", "label": "ุณุงุนุงุช ุงูุชุดุบูู", "type": "number", "required": false}
    -- ]
    
    -- ุงูุฅุนุฏุงุฏุงุช
    requires_location BOOLEAN DEFAULT TRUE,
    requires_serial_number BOOLEAN DEFAULT FALSE,
    default_useful_life INTEGER,
    default_depreciation_method VARCHAR(20) DEFAULT 'straight_line',
    
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ุงูุจูุงูุงุช ุงูุฃูููุฉ ููููุงูุจ
INSERT INTO asset_templates (template_code, template_name, custom_fields, default_useful_life) VALUES
('GEN', 'ูููุฏ ููุฑุจุงุฆู', '[
    {"name": "manufacturer", "label": "ุงูุดุฑูุฉ ุงููุตูุนุฉ", "type": "text", "required": true},
    {"name": "model", "label": "ุงูููุฏูู", "type": "text", "required": true},
    {"name": "capacity_kva", "label": "ุงููุฏุฑุฉ (KVA)", "type": "number", "required": true},
    {"name": "operating_hours", "label": "ุณุงุนุงุช ุงูุชุดุบูู", "type": "number", "required": false},
    {"name": "last_maintenance_date", "label": "ุชุงุฑูุฎ ุขุฎุฑ ุตูุงูุฉ", "type": "date", "required": false}
]', 15),

('DP', 'ุทุจููู ุชุฌููุน', '[
    {"name": "dp_type", "label": "ุงูููุน", "type": "select", "options": ["ููุจุฑ", "ุญุฏูุฏ"], "required": true},
    {"name": "capacity", "label": "ุงูุณุนุฉ (ุนุฏุฏ ุงูุนุฏุงุฏุงุช)", "type": "number", "required": true},
    {"name": "installation_date", "label": "ุชุงุฑูุฎ ุงูุชุฑููุจ", "type": "date", "required": false}
]', 20),

('TRANS', 'ูุญูู ููุฑุจุงุฆู', '[
    {"name": "manufacturer", "label": "ุงูุดุฑูุฉ ุงููุตูุนุฉ", "type": "text", "required": true},
    {"name": "capacity_kva", "label": "ุงููุฏุฑุฉ (KVA)", "type": "number", "required": true},
    {"name": "voltage_primary", "label": "ุงูุฌูุฏ ุงูุงุจุชุฏุงุฆู", "type": "number", "required": true},
    {"name": "voltage_secondary", "label": "ุงูุฌูุฏ ุงูุซุงููู", "type": "number", "required": true}
]', 25),

('SOLAR', 'ูุญุทุฉ ุทุงูุฉ ุดูุณูุฉ', '[
    {"name": "panels_count", "label": "ุนุฏุฏ ุงูุฃููุงุญ", "type": "number", "required": true},
    {"name": "panel_wattage", "label": "ูุฏุฑุฉ ุงูููุญ (ูุงุท)", "type": "number", "required": true},
    {"name": "inverters_count", "label": "ุนุฏุฏ ุงูุฅููุฑุชุฑุงุช", "type": "number", "required": true},
    {"name": "total_capacity_kw", "label": "ุงููุฏุฑุฉ ุงูุฅุฌูุงููุฉ (ูููููุงุท)", "type": "number", "required": true}
]', 25),

('VEHICLE', 'ูุฑูุจุฉ', '[
    {"name": "vehicle_type", "label": "ููุน ุงููุฑูุจุฉ", "type": "select", "options": ["ุณูุงุฑุฉ", "ุดุงุญูุฉ", "ุฏุฑุงุฌุฉ ูุงุฑูุฉ"], "required": true},
    {"name": "manufacturer", "label": "ุงูุดุฑูุฉ ุงููุตูุนุฉ", "type": "text", "required": true},
    {"name": "model", "label": "ุงูููุฏูู", "type": "text", "required": true},
    {"name": "year", "label": "ุณูุฉ ุงูุตูุน", "type": "number", "required": true},
    {"name": "plate_number", "label": "ุฑูู ุงูููุญุฉ", "type": "text", "required": true},
    {"name": "odometer", "label": "ุนุฏุงุฏ ุงููุณุงูุฉ", "type": "number", "required": false}
]', 10);
```

## 14.2 ุดุงุดุฉ ุงูุฅุฏุฎุงู ุงููุฏูู ููุฃุตูู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ ุฅุฏุฎุงู ุฃุตู ุฌุฏูุฏ                                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                                 โ
โ  ุงูุฎุทูุฉ 1: ุงุฎุชูุงุฑ ููุน ุงูุฃุตู                                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ ููุน ุงูุฃุตู: [ูููุฏ ููุฑุจุงุฆู โผ]                                              โ  โ
โ  โ                                                                           โ  โ
โ  โ ุงูุฃููุงุน ุงููุชุงุญุฉ:                                                         โ  โ
โ  โ โข ูููุฏ ููุฑุจุงุฆู (GEN)                                                     โ  โ
โ  โ โข ุทุจููู ุชุฌููุน (DP)                                                       โ  โ
โ  โ โข ูุญูู ููุฑุจุงุฆู (TRANS)                                                   โ  โ
โ  โ โข ูุญุทุฉ ุทุงูุฉ ุดูุณูุฉ (SOLAR)                                                โ  โ
โ  โ โข ูุฑูุจุฉ (VEHICLE)                                                        โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ  ุงูุฎุทูุฉ 2: ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ                                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ ุงุณู ุงูุฃุตู: [ูููุฏ ูุญุทุฉ ุงูุญุฏูุฏุฉ ุงูุฑุฆูุณู________________]                   โ  โ
โ  โ ุงูุฑูู ุงูุชุณูุณูู: [GEN-2020-001_________________________]                  โ  โ
โ  โ ุงููููุน (GPS): [15.5432, 48.5234] [๐ ุชุญุฏูุฏ ุนูู ุงูุฎุฑูุทุฉ]                 โ  โ
โ  โ ุชุงุฑูุฎ ุงูุงูุชูุงุก: [15/01/2020]                                             โ  โ
โ  โ ุงูุชูููุฉ ุงูุฏูุชุฑูุฉ: [500,000] ุฑูุงู                                         โ  โ
โ  โ ุงูุนูุฑ ุงูุฅูุชุงุฌู: [15] ุณูุฉ                                                 โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ  ุงูุฎุทูุฉ 3: ุงูุญููู ุงููุฎุตุตุฉ (ุญุณุจ ููุน ุงูุฃุตู)                                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ ุงูุดุฑูุฉ ุงููุตูุนุฉ: [Cummins____________________________]                    โ  โ
โ  โ ุงูููุฏูู: [C500________________________________]                          โ  โ
โ  โ ุงููุฏุฑุฉ (KVA): [500]                                                      โ  โ
โ  โ ุณุงุนุงุช ุงูุชุดุบูู: [15,000]                                                  โ  โ
โ  โ ุชุงุฑูุฎ ุขุฎุฑ ุตูุงูุฉ: [01/11/2025]                                            โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ  ุงูุฎุทูุฉ 4: ุงูุฅููุงู ุงููุชุฑุงูู (ููุฃุตูู ุงููุงุฆูุฉ)                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ โ ูุฐุง ุฃุตู ูุงุฆู (ุชู ุงูุชูุงุคู ูุจู ุชุดุบูู ุงููุธุงู)                            โ  โ
โ  โ                                                                           โ  โ
โ  โ ุณููุงุช ุงูุงุณุชุฎุฏุงู ุงูุณุงุจูุฉ: [5] ุณููุงุช                                       โ  โ
โ  โ ุงูุฅููุงู ุงููุชุฑุงูู: [166,667] ุฑูุงู (ูุญุณูุจ ุชููุงุฆูุงู)                        โ  โ
โ  โ ุงููููุฉ ุงูุฏูุชุฑูุฉ ุงูุญุงููุฉ: [333,333] ุฑูุงู                                  โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ  [ุญูุธ ุงูุฃุตู]  [ุญูุธ ูุฅุถุงูุฉ ุขุฎุฑ]  [ุฅูุบุงุก]                                        โ
โ                                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 14.3 ุฃุฏุงุฉ ุงูุงุณุชูุฑุงุฏ ุงููุฌูุน (Bulk Import Tool)

### ุฌุฏูู ุฏูุนุงุช ุงูุงุณุชูุฑุงุฏ

```sql
CREATE TABLE asset_import_batches (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- ูุนูููุงุช ุงูุฏูุนุฉ
    batch_number VARCHAR(20) UNIQUE NOT NULL,
    template_id UUID REFERENCES asset_templates(id),
    description TEXT,
    
    -- ุงูููู ุงููุฑููุน
    file_name VARCHAR(255),
    file_path VARCHAR(500),
    
    -- ุงูุฅุญุตุงุฆูุงุช
    total_rows INTEGER DEFAULT 0,
    valid_rows INTEGER DEFAULT 0,
    error_rows INTEGER DEFAULT 0,
    imported_rows INTEGER DEFAULT 0,
    
    -- ุงูุญุงูุฉ
    status VARCHAR(20) DEFAULT 'pending',
    -- 'pending': ุจุงูุชุธุงุฑ ุงููุนุงูุฌุฉ
    -- 'validating': ุฌุงุฑู ุงูุชุญูู
    -- 'validated': ุชู ุงูุชุญูู
    -- 'importing': ุฌุงุฑู ุงูุงุณุชูุฑุงุฏ
    -- 'completed': ููุชูู
    -- 'failed': ูุดู
    
    -- ุงูุฃุฎุทุงุก
    validation_errors JSONB,
    
    -- ุงููุณุชุฎุฏู
    uploaded_by UUID REFERENCES users(id),
    approved_by UUID REFERENCES users(id),
    
    -- ุงูุชูุงุฑูุฎ
    uploaded_at TIMESTAMP DEFAULT NOW(),
    validated_at TIMESTAMP,
    imported_at TIMESTAMP,
    
    -- ุงูููุฏ ุงููุญุงุณุจู
    journal_entry_id UUID
);

-- ุฌุฏูู ุชูุงุตูู ุงูุงุณุชูุฑุงุฏ
CREATE TABLE asset_import_details (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    batch_id UUID REFERENCES asset_import_batches(id) ON DELETE CASCADE,
    
    row_number INTEGER NOT NULL,
    row_data JSONB NOT NULL,
    
    -- ูุชูุฌุฉ ุงูุชุญูู
    is_valid BOOLEAN DEFAULT FALSE,
    validation_errors JSONB,
    
    -- ุงูุฃุตู ุงูููุดุฃ
    asset_id UUID REFERENCES assets(id),
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

### ุดุงุดุฉ ุงูุงุณุชูุฑุงุฏ ุงููุฌูุน

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ฅ ุงุณุชูุฑุงุฏ ุงูุฃุตูู ุงููุฌูุน                                                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                                 โ
โ  ุงูุฎุทูุฉ 1: ุงุฎุชูุงุฑ ููุน ุงูุฃุตู ูุชูุฒูู ุงููููุฐุฌ                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ ููุน ุงูุฃุตู: [ุทุจููู ุชุฌููุน โผ]                                               โ  โ
โ  โ                                                                           โ  โ
โ  โ [๐ฅ ุชูุฒูู ูููุฐุฌ Excel]                                                   โ  โ
โ  โ                                                                           โ  โ
โ  โ ุงูุญููู ูู ุงููููุฐุฌ:                                                       โ  โ
โ  โ โข ุงูุฑูุฒ (ูุทููุจ)                                                          โ  โ
โ  โ โข ุงูุงุณู (ูุทููุจ)                                                          โ  โ
โ  โ โข ุฎุท ุงูุนุฑุถ (ูุทููุจ)                                                       โ  โ
โ  โ โข ุฎุท ุงูุทูู (ูุทููุจ)                                                       โ  โ
โ  โ โข ุชุงุฑูุฎ ุงูุงูุชูุงุก (ูุทููุจ)                                                 โ  โ
โ  โ โข ุงูุชูููุฉ (ูุทููุจ)                                                        โ  โ
โ  โ โข ุงูููุน (ููุจุฑ/ุญุฏูุฏ)                                                      โ  โ
โ  โ โข ุงูุณุนุฉ                                                                  โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ  ุงูุฎุทูุฉ 2: ุฑูุน ุงูููู                                                           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ [๐ ุงุฎุชูุงุฑ ููู Excel]                                                    โ  โ
โ  โ                                                                           โ  โ
โ  โ ุงูููู: ุทุจุงุจููู_ุงูุญุฏูุฏุฉ.xlsx                                              โ  โ
โ  โ ุงูุญุฌู: 125 KB                                                            โ  โ
โ  โ ุนุฏุฏ ุงูุตููู: 350                                                          โ  โ
โ  โ                                                                           โ  โ
โ  โ [๐ ุงูุชุญูู ูู ุงูุจูุงูุงุช]                                                  โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ  ุงูุฎุทูุฉ 3: ูุชุงุฆุฌ ุงูุชุญูู                                                        โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ โ ุตููู ุตุญูุญุฉ: 345                                                       โ  โ
โ  โ โ ุตููู ุจูุง ุฃุฎุทุงุก: 5                                                     โ  โ
โ  โ                                                                           โ  โ
โ  โ ุงูุฃุฎุทุงุก:                                                                 โ  โ
โ  โ โข ุตู 23: ุงูุฑูุฒ ููุฑุฑ (DP-045)                                            โ  โ
โ  โ โข ุตู 56: ุงูุชูููุฉ ุบูุฑ ุตุญูุญุฉ                                              โ  โ
โ  โ โข ุตู 112: ุฅุญุฏุงุซูุงุช GPS ุบูุฑ ุตุญูุญุฉ                                        โ  โ
โ  โ โข ุตู 200: ุชุงุฑูุฎ ุงูุงูุชูุงุก ูุณุชูุจูู                                        โ  โ
โ  โ โข ุตู 289: ุญูู ูุทููุจ ูุงุฑุบ (ุงูุงุณู)                                        โ  โ
โ  โ                                                                           โ  โ
โ  โ [๐ฅ ุชูุฒูู ุชูุฑูุฑ ุงูุฃุฎุทุงุก]                                                 โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ  ุงูุฎุทูุฉ 4: ุงูุงุณุชูุฑุงุฏ                                                           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ โ ุงุณุชูุฑุงุฏ ุงูุตููู ุงูุตุญูุญุฉ ููุท (345 ุตู)                                   โ  โ
โ  โ โ ุชุฌุงูู ุงูุฃุฎุทุงุก ูุงุณุชูุฑุงุฏ ุงููู                                           โ  โ
โ  โ                                                                           โ  โ
โ  โ โ ุฅูุดุงุก ููุฏ ุงูุงูุชุชุงุญ ุงููุญุงุณุจู ุชููุงุฆูุงู                                  โ  โ
โ  โ                                                                           โ  โ
โ  โ [โ ุจุฏุก ุงูุงุณุชูุฑุงุฏ]                                                       โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 14.4 APIs ุฅุฏุฎุงู ุงูุฃุตูู ุงููุงุฆูุฉ

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| GET | `/api/v1/asset-templates` | ูุงุฆูุฉ ููุงูุจ ุงูุฃุตูู |
| GET | `/api/v1/asset-templates/:id` | ุชูุงุตูู ูุงูุจ |
| POST | `/api/v1/assets/manual-entry` | ุฅุฏุฎุงู ุฃุตู ูุฏููุงู |
| GET | `/api/v1/asset-import/template/:templateId` | ุชูุฒูู ูููุฐุฌ Excel |
| POST | `/api/v1/asset-import/upload` | ุฑูุน ููู ุงูุงุณุชูุฑุงุฏ |
| POST | `/api/v1/asset-import/:batchId/validate` | ุงูุชุญูู ูู ุงูุจูุงูุงุช |
| GET | `/api/v1/asset-import/:batchId/errors` | ุชูุฑูุฑ ุงูุฃุฎุทุงุก |
| POST | `/api/v1/asset-import/:batchId/import` | ุจุฏุก ุงูุงุณุชูุฑุงุฏ |
| GET | `/api/v1/asset-import/:batchId/status` | ุญุงูุฉ ุงูุงุณุชูุฑุงุฏ |

---

## 15. ุฑุจุท ุงูุฃุตูู ุจุงูุชูุฃู ุงูุฑููู ููุดุจูุฉ

> **ุงูุบุฑุถ:** ุฑุจุท ุณุฌูุงุช ุงูุฃุตูู ุงููุญุงุณุจูุฉ ุจุงูุชูุซูู ุงูุฑููู ููุดุจูุฉ ูู ูุธุงู ุงููุฑุงูุจุฉ ูุงูุชุญูู (05)

### 15.1 ุงููุจุฏุฃ

```
ุงูุฃุตูู ูู ูุฐุง ุงููุธุงู (03) = ุงูุณุฌู ุงููุญุงุณุจู ูุงูุตูุงูุฉ
ุงูุชูุฃู ุงูุฑููู ูู (05) = ุงูุชูุซูู ุงูุฌุบุฑุงูู ูุงูุชููู

ุงูุฑุจุท ูุชู ุนุจุฑ:
โโ asset_id ูู ุฌุฏุงูู network_nodes
โโ asset_id ูู ุฌุฏุงูู network_segments
โโ network_asset_id ูู ุฌุฏุงูู ุงูุฃุตูู ุงููุฌูุนุฉ
```

### 15.2 ุฌุฏูู ุฑุจุท ุงูุฃุตูู ุจุนูุงุตุฑ ุงูุดุจูุฉ (asset_network_links)

```sql
CREATE TABLE asset_network_links (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    asset_id UUID NOT NULL,  -- ูู ุฌุฏูู ุงูุฃุตูู ูู ูุฐุง ุงููุธุงู
    
    -- ููุน ุงูุนูุตุฑ ุงููุฑุชุจุท
    network_element_type VARCHAR(30) NOT NULL,  -- 'node', 'segment', 'network_asset'
    network_element_id UUID NOT NULL,
    
    -- ููุน ุงูุฑุจุท
    link_type VARCHAR(30) DEFAULT 'primary',  -- 'primary', 'component', 'related'
    
    -- ุงูุชุชุจุน
    linked_at TIMESTAMP DEFAULT NOW(),
    linked_by UUID REFERENCES users(id),
    
    UNIQUE(asset_id, network_element_type, network_element_id)
);
```

### 15.3 View: ุงูุฃุตูู ูุน ุจูุงูุงุช ุงูุดุจูุฉ

```sql
CREATE OR REPLACE VIEW v_assets_with_network_data AS
SELECT 
    a.*,
    anl.network_element_type,
    anl.network_element_id,
    CASE anl.network_element_type
        WHEN 'node' THEN (SELECT node_code FROM network_nodes WHERE id = anl.network_element_id)
        WHEN 'segment' THEN (SELECT segment_code FROM network_segments WHERE id = anl.network_element_id)
        WHEN 'network_asset' THEN (SELECT asset_code FROM network_assets WHERE id = anl.network_element_id)
    END as network_element_code,
    CASE anl.network_element_type
        WHEN 'node' THEN (SELECT latitude FROM network_nodes WHERE id = anl.network_element_id)
    END as latitude,
    CASE anl.network_element_type
        WHEN 'node' THEN (SELECT longitude FROM network_nodes WHERE id = anl.network_element_id)
    END as longitude
FROM assets a
LEFT JOIN asset_network_links anl ON anl.asset_id = a.id;
```

### 15.4 APIs ุฑุจุท ุงูุฃุตูู ุจุงูุดุจูุฉ

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| POST | `/api/v1/assets/:id/link-network` | ุฑุจุท ุฃุตู ุจุนูุตุฑ ุดุจูุฉ |
| DELETE | `/api/v1/assets/:id/unlink-network/:elementId` | ูู ุฑุจุท ุฃุตู |
| GET | `/api/v1/assets/:id/network-elements` | ุนูุงุตุฑ ุงูุดุจูุฉ ุงููุฑุชุจุทุฉ ุจุฃุตู |
| GET | `/api/v1/network/elements/:id/asset` | ุงูุฃุตู ุงููุฑุชุจุท ุจุนูุตุฑ ุดุจูุฉ |

---

> **ุงูุธุฑ ุฃูุถุงู:** 
> - `05_ูุธุงู_ุงููุฑุงูุจุฉ_ูุงูุชุญูู.md` - ุงููุณู 8 ู 9 ููุชูุฃู ุงูุฑููู ุงููุงูู

---

# 16๏ธโฃ ุงูุชูุงูู ูุน ุบุฑูุฉ ุงูุชุญูู ุงููุฑูุฒูุฉ

> **ุงูุบุฑุถ:** ุชูููุฑ ุฑูุงุจุท ุณุฑูุนุฉ ูู ุบุฑูุฉ ุงูุชุญูู ููููู ุงูุชุงุฑูุฎู ููุฃุตูู

## 16.1 API ุงูุฑูุงุจุท ุงูุณุฑูุนุฉ ูู ุบุฑูุฉ ุงูุชุญูู

```sql
-- View: ุจูุงูุงุช ุงูุฃุตู ููุนุฑุถ ูู ุบุฑูุฉ ุงูุชุญูู
CREATE OR REPLACE VIEW v_asset_control_center_data AS
SELECT 
    a.id,
    a.asset_type,
    a.asset_name,
    a.serial_number,
    a.status,
    a.location_coordinates,
    
    -- ุขุฎุฑ ุตูุงูุฉ
    (SELECT MAX(maintenance_date) FROM maintenance_records WHERE asset_id = a.id) as last_maintenance,
    
    -- ุงูุชูููุฉ ุงููุชุฑุงููุฉ
    (SELECT COALESCE(SUM(total_cost), 0) FROM maintenance_records WHERE asset_id = a.id) as total_maintenance_cost,
    
    -- ุงูุฅููุงู ุงููุชุฑุงูู
    a.accumulated_depreciation,
    
    -- ุงููููุฉ ุงูุฏูุชุฑูุฉ
    a.book_value,
    
    -- ุนุฏุฏ ุงูุฃุนุทุงู
    (SELECT COUNT(*) FROM maintenance_records WHERE asset_id = a.id AND maintenance_type = 'corrective') as fault_count
FROM assets a;
```

## 16.2 APIs ููุชูุงูู ูุน ุบุฑูุฉ ุงูุชุญูู

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| GET | `/api/v1/assets/:id/control-center-summary` | ููุฎุต ุงูุฃุตู ูุบุฑูุฉ ุงูุชุญูู |
| GET | `/api/v1/assets/:id/quick-history` | ุขุฎุฑ 10 ุฃุญุฏุงุซ ููุฃุตู |
| GET | `/api/v1/assets/by-location/:lat/:lng` | ุงูุฃุตูู ุญุณุจ ุงููููุน |
| GET | `/api/v1/assets/network-node/:nodeId` | ุฃุตูู ุนูุฏุฉ ุงูุดุจูุฉ |

---

> **ุงูุธุฑ ุฃูุถุงู:** `05_ูุธุงู_ุงููุฑุงูุจุฉ_ูุงูุชุญูู.md` - ุบุฑูุฉ ุงูุชุญูู ุงููุฑูุฒูุฉ

---

## 18. ุณููุงุฑูู ุงุณุชุจุฏุงู ุดุงุดุฉ ุงูุนุฑุถ STS ุงูุชุงููุฉ

### 18.1 ุงููุจุฏุฃ ุงูุฃุณุงุณู

> **ุงุณุชุจุฏุงู ุงูุดุงุดุฉ ุงูุชุงููุฉ ุจุดูู ูููุตู ุนู ุจุงูู ุงูููููุงุช**

ุนูุฏ ุชูู ุดุงุดุฉ ุงูุนุฑุถ (CIU) ูุฏู ุงูุนูููุ ูููู ุงุณุชุจุฏุงููุง ุจุดูู ูุณุชูู ุฏูู ุงูุญุงุฌุฉ ูุงุณุชุจุฏุงู ุงูุนุฏุงุฏ ุฃู ุงููุงุทุน ุฃู ุงูุฎุชู.

### 18.2 ุฃููุงุน ุฃุนุทุงู ุดุงุดุฉ ุงูุนุฑุถ

| ููุน ุงูุนุทู | ุงููุตู | ุงูุฅุฌุฑุงุก |
|-----------|-------|---------|
| ุดุงุดุฉ ูุง ุชุนูู | ุงูุดุงุดุฉ ูุง ุชุนุฑุถ ุฃู ุดูุก | ุงุณุชุจุฏุงู ูุงูู |
| ุดุงุดุฉ ููุณูุฑุฉ | ูุณุฑ ููุฒูุงุฆู | ุงุณุชุจุฏุงู ูุงูู |
| ุฃุฒุฑุงุฑ ูุง ุชุนูู | ุงูุฃุฒุฑุงุฑ ูุง ุชุณุชุฌูุจ | ุงุณุชุจุฏุงู ูุงูู |
| ุนุฑุถ ุฎุงุทุฆ | ุฃุฑูุงู ุบูุฑ ุตุญูุญุฉ | ูุญุต + ุงุณุชุจุฏุงู |
| ููุฏุงู ุงูุงุชุตุงู | ูุง ุชุชุตู ุจุงูุนุฏุงุฏ | ุฅุนุงุฏุฉ ุฑุจุท ุฃู ุงุณุชุจุฏุงู |

### 18.3 ุณูุฑ ุนูู ุงุณุชุจุฏุงู ุงูุดุงุดุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ุณูุฑ ุนูู ุงุณุชุจุฏุงู ุดุงุดุฉ STS ุชุงููุฉ                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  1. ุดููู ุงูุนููู                                                             โ
โ     โ                                                                       โ
โ  2. ุฅูุดุงุก ุฃูุฑ ุนูู ุตูุงูุฉ (ููุน: ุงุณุชุจุฏุงู ุดุงุดุฉ CIU)                             โ
โ     โ                                                                       โ
โ  3. ุตุฑู ุดุงุดุฉ ุฌุฏูุฏุฉ ููููู (ูุณุญ ุงูุฑูู ุงูุชุณูุณูู)                               โ
โ     โ                                                                       โ
โ  4. ุฒูุงุฑุฉ ุงูููู ูููููุน                                                      โ
โ     โ                                                                       โ
โ  5. ูุณุญ ุงูุดุงุดุฉ ุงูุชุงููุฉ (ุงุณุชูุงู ูู ุงูุนููู)                                   โ
โ     โ                                                                       โ
โ  6. ุชุฑููุจ ุงูุดุงุดุฉ ุงูุฌุฏูุฏุฉ ูุฑุจุทูุง ุจุงูุนุฏุงุฏ                                     โ
โ     โ                                                                       โ
โ  7. ูุณุญ ุงูุดุงุดุฉ ุงูุฌุฏูุฏุฉ (ุชุฃููุฏ ุงูุชุณููู)                                      โ
โ     โ                                                                       โ
โ  8. ุชูููุน ุงูุนููู ุนูู ุงูุงุณุชูุงู                                               โ
โ     โ                                                                       โ
โ  9. ุชุญุฏูุซ ุงูุณุฌูุงุช:                                                          โ
โ     โข ุงูุดุงุดุฉ ุงููุฏููุฉ โ ุญุงูุฉ "ูุฑุชุฌุน/ุชุงูู"                                    โ
โ     โข ุงูุดุงุดุฉ ุงูุฌุฏูุฏุฉ โ ุญุงูุฉ "ูุฑูุจ ูุฏู ุงูุนููู"                               โ
โ     โข ุงูุนุฏุงุฏ ูุงูุฎุชู ูุงููุงุทุน โ ุจุฏูู ุชุบููุฑ                                    โ
โ                                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 18.4 ุฌุฏูู ุงุณุชุจุฏุงู ุงูุดุงุดุงุช (ciu_replacements)

```sql
CREATE TABLE ciu_replacements (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    work_order_id UUID NOT NULL REFERENCES work_orders(id),
    customer_id UUID NOT NULL REFERENCES customers(id),
    technician_id UUID NOT NULL REFERENCES users(id),
    
    -- ุงูุดุงุดุฉ ุงููุฏููุฉ (ุงูุชุงููุฉ)
    old_ciu_serial VARCHAR(100) NOT NULL,
    old_ciu_condition ENUM('broken', 'faulty', 'damaged', 'lost') NOT NULL,
    old_ciu_photo_url TEXT,
    old_ciu_received BOOLEAN DEFAULT false,
    
    -- ุงูุดุงุดุฉ ุงูุฌุฏูุฏุฉ
    new_ciu_serial VARCHAR(100) NOT NULL,
    new_ciu_installed BOOLEAN DEFAULT false,
    new_ciu_activated BOOLEAN DEFAULT false,
    new_ciu_photo_url TEXT,
    
    -- ุงูุนุฏุงุฏ ุงููุฑุชุจุท (ูุง ูุชุบูุฑ)
    meter_serial VARCHAR(100) NOT NULL,
    
    -- ุงููููุน
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    
    -- ุงูุชูููุน
    customer_signature_url TEXT,
    
    -- ุงูุญุงูุฉ
    replacement_status ENUM('pending', 'in_progress', 'completed', 'cancelled') DEFAULT 'pending',
    completed_at TIMESTAMP,
    
    fault_description TEXT,
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_ciu_replacement_customer ON ciu_replacements(customer_id);
CREATE INDEX idx_ciu_replacement_status ON ciu_replacements(replacement_status);
```

### 18.5 ุดุงุดุฉ ุงุณุชุจุฏุงู ุงูุดุงุดุฉ ูู ุชุทุจูู ุงูููู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ๐ฑ ุชุทุจูู ุงูููู - ุงุณุชุจุฏุงู ุดุงุดุฉ STS ุชุงููุฉ                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  ุฃูุฑ ุงูุนูู: WO-2024-1023                                                   โ
โ  ุงูุนููู: ุณุนูุฏ ุนูู ูุญูุฏ                                                     โ
โ  ููุน ุงูุนูููุฉ: ุงุณุชุจุฏุงู ุดุงุดุฉ ุนุฑุถ STS                                         โ
โ  ุณุจุจ ุงูุดููู: ุงูุดุงุดุฉ ูุง ุชุนูู                                                โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         ุงููุนุฏุงุช ุงูุญุงููุฉ ููุนููู                              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โข ุงูุนุฏุงุฏ: STS-2024-00089 (ูู ูุชุบูุฑ)                                       โ
โ  โข ุงูุฎุชู: SEAL-2024-05621 (ูู ูุชุบูุฑ)                                       โ
โ  โข ุงููุงุทุน: BRK-2024-03456 (ูู ูุชุบูุฑ)                                       โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                            ุงุณุชุจุฏุงู ุงูุดุงุดุฉ                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงูุดุงุดุฉ ุงูุชุงููุฉ (ุงุณุชูุงู ูู ุงูุนููู):                                   โ   โ
โ  โ [๐ท ูุณุญ] โ CIU-2024-00089 โ                                         โ   โ
โ  โ ุญุงูุฉ ุงูุดุงุดุฉ: [ููุณูุฑุฉ โผ]                                              โ   โ
โ  โ ๐ธ [ุงูุชูุงุท ุตูุฑุฉ ุงูุดุงุดุฉ ุงูุชุงููุฉ] โ                                    โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ                              โฌ๏ธ                                             โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงูุดุงุดุฉ ุงูุฌุฏูุฏุฉ (ุชุณููู ููุนููู):                                       โ   โ
โ  โ ุงููุตุฑููุฉ: CIU-2024-00256                                            โ   โ
โ  โ [๐ท ูุณุญ ููุชุฃููุฏ] โ CIU-2024-00256 โ ูุทุงุจู                           โ   โ
โ  โ โ๏ธ ุชู ุชุฑููุจ ุงูุดุงุดุฉ ูุฑุจุทูุง ุจุงูุนุฏุงุฏ                                    โ   โ
โ  โ โ๏ธ ุชู ุชูุนูู ุงูุดุงุดุฉ ูุชุนูู ุจุดูู ุตุญูุญ                                   โ   โ
โ  โ ๐ธ [ุงูุชูุงุท ุตูุฑุฉ ุงูุดุงุดุฉ ุงูุฌุฏูุฏุฉ] โ                                    โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  ๐ ุงููููุน: 15.3694ยฐ N, 44.1910ยฐ E โ                                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  ููุงุญุธุงุช: [ุชู ุงูุงุณุชุจุฏุงู ุจูุฌุงุญุ ุงูุดุงุดุฉ ุงูุฌุฏูุฏุฉ ุชุนูู_______]                โ
โ                                                                             โ
โ  ุชูููุน ุงูุนููู: [โ๏ธ ุงูุชูููุน ุงูุฅููุชุฑููู] โ                                  โ
โ                                                                             โ
โ                        [โ ุชุฃููุฏ ุฅุชูุงู ุงูุงุณุชุจุฏุงู]                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 18.6 Trigger ูุชุญุฏูุซ ุญุงูุฉ ุงูุดุงุดุงุช ุนูุฏ ุงูุงุณุชุจุฏุงู

```sql
CREATE OR REPLACE FUNCTION update_ciu_on_replacement()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.replacement_status = 'completed' THEN
        -- ุชุญุฏูุซ ุงูุดุงุดุฉ ุงููุฏููุฉ
        UPDATE ciu_tracking
        SET current_status = CASE 
                WHEN NEW.old_ciu_condition = 'lost' THEN 'returned'
                ELSE 'faulty'
            END,
            installed_customer_id = NULL,
            installed_meter_id = NULL,
            updated_at = NOW()
        WHERE serial_number = NEW.old_ciu_serial;
        
        -- ุชุญุฏูุซ ุงูุดุงุดุฉ ุงูุฌุฏูุฏุฉ
        UPDATE ciu_tracking
        SET current_status = 'installed',
            installed_customer_id = NEW.customer_id,
            paired_meter_serial = NEW.meter_serial,
            installed_date = NOW(),
            updated_at = NOW()
        WHERE serial_number = NEW.new_ciu_serial;
        
        -- ุชุณุฌูู ูู ุงูุณุฌู ุงูุชุงุฑูุฎู
        -- ุงูุดุงุดุฉ ุงููุฏููุฉ
        INSERT INTO serialized_item_history (
            station_id, item_type, serial_number,
            from_status, to_status,
            from_location_type, from_location_id,
            to_location_type,
            reference_type, reference_id, performed_by,
            latitude, longitude, notes
        ) VALUES (
            NEW.station_id, 'ciu', NEW.old_ciu_serial,
            'installed', 'faulty',
            'customer', NEW.customer_id,
            'warehouse',
            'ciu_replacement', NEW.id, NEW.technician_id,
            NEW.latitude, NEW.longitude,
            'ุงุณุชุจุฏุงู ุจุณุจุจ: ' || NEW.old_ciu_condition
        );
        
        -- ุงูุดุงุดุฉ ุงูุฌุฏูุฏุฉ
        INSERT INTO serialized_item_history (
            station_id, item_type, serial_number,
            from_status, to_status,
            from_location_type, from_location_id,
            to_location_type, to_location_id,
            reference_type, reference_id, performed_by,
            latitude, longitude
        ) VALUES (
            NEW.station_id, 'ciu', NEW.new_ciu_serial,
            'in_technician_custody', 'installed',
            'technician', NEW.technician_id,
            'customer', NEW.customer_id,
            'ciu_replacement', NEW.id, NEW.technician_id,
            NEW.latitude, NEW.longitude
        );
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_ciu_replacement
AFTER UPDATE ON ciu_replacements
FOR EACH ROW
WHEN (NEW.replacement_status = 'completed' AND OLD.replacement_status != 'completed')
EXECUTE FUNCTION update_ciu_on_replacement();
```

### 18.7 View: ุณุฌู ุงุณุชุจุฏุงูุงุช ุงูุดุงุดุงุช

```sql
CREATE OR REPLACE VIEW v_ciu_replacement_history AS
SELECT 
    cr.id,
    cr.work_order_id,
    c.name AS customer_name,
    c.account_number,
    cr.meter_serial,
    cr.old_ciu_serial,
    cr.old_ciu_condition,
    cr.new_ciu_serial,
    u.full_name AS technician_name,
    cr.fault_description,
    cr.replacement_status,
    cr.completed_at,
    cr.created_at
FROM ciu_replacements cr
JOIN customers c ON c.id = cr.customer_id
JOIN users u ON u.id = cr.technician_id
ORDER BY cr.created_at DESC;
```

### 18.8 APIs ุงุณุชุจุฏุงู ุงูุดุงุดุงุช

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| POST | /api/v1/ciu/replacements | ุฅูุดุงุก ุทูุจ ุงุณุชุจุฏุงู ุดุงุดุฉ |
| GET | /api/v1/ciu/replacements/:id | ุชูุงุตูู ุทูุจ ุงูุงุณุชุจุฏุงู |
| PUT | /api/v1/ciu/replacements/:id/complete | ุฅุชูุงู ุงูุงุณุชุจุฏุงู |
| GET | /api/v1/customers/:id/ciu-history | ุณุฌู ุดุงุดุงุช ุงูุนููู |
| GET | /api/v1/ciu/faulty | ุงูุดุงุดุงุช ุงูุชุงููุฉ ุงููุฑุชุฌุนุฉ |


---

## 19. ูุนุงูุฌ ุงุณุชุจุฏุงู ุงูุนุฏุงุฏ ุงูุชุงูู ูุน ููุชุฑุฉ ุงูุงุณุชููุงู ุงูุชูุฏูุฑู

### 19.1 ุงููุจุฏุฃ ุงูุฃุณุงุณู

> **ูุง ููุฌุฏ ุงุณุชููุงู ููููุฏ - ูู ูููููุงุท ููุญุณุจ ูููููุชุฑ**

ุนูุฏ ุงุณุชุจุฏุงู ุนุฏุงุฏ ุชุงููุ ูุฌุจ ุญุณุงุจ ุงูุงุณุชููุงู ุบูุฑ ุงููุณุฌู ุฎูุงู ูุชุฑุฉ ุงูุนุทู ูุฅุถุงูุชู ููุงุชูุฑุฉ ูุณุชุญูุฉ ุนูู ุงูุนููู ูุจู ุฅุชูุงู ุนูููุฉ ุงูุงุณุชุจุฏุงู.

### 19.2 ูุนุงุฏูุฉ ุงูุงุณุชููุงู ุงูุชูุฏูุฑู

```
ุงูุงุณุชููุงู ุงูุชูุฏูุฑู = ูุชูุณุท ุงูุงุณุชููุงู ุงููููู ร ุนุฏุฏ ุฃูุงู ุงูุนุทู

ุญูุซ:
- ูุชูุณุท ุงูุงุณุชููุงู ุงููููู = ูุฌููุน ุงุณุชููุงู ุขุฎุฑ 3 ุฃุดูุฑ รท 90 ููู
- ุนุฏุฏ ุฃูุงู ุงูุนุทู = ุชุงุฑูุฎ ุงูููู - ุชุงุฑูุฎ ุขุฎุฑ ูุฑุงุกุฉ ุตุญูุญุฉ
```

### 19.3 ุฌุฏูู ุงุณุชุจุฏุงู ุงูุนุฏุงุฏุงุช ุงูุชุงููุฉ (faulty_meter_replacements)

```sql
CREATE TABLE faulty_meter_replacements (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    work_order_id UUID NOT NULL REFERENCES work_orders(id),
    customer_id UUID NOT NULL REFERENCES customers(id),
    technician_id UUID REFERENCES users(id),
    
    -- ุงูุนุฏุงุฏ ุงูุชุงูู
    old_meter_serial VARCHAR(100) NOT NULL,
    old_meter_last_reading DECIMAL(15,3),
    old_meter_last_reading_date DATE,
    fault_type VARCHAR(100),
    fault_description TEXT,
    
    -- ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ
    new_meter_serial VARCHAR(100),
    new_meter_opening_reading DECIMAL(15,3) DEFAULT 0,
    
    -- ุญุณุงุจ ุงูุงุณุชููุงู ุงูุชูุฏูุฑู
    avg_daily_consumption DECIMAL(15,3),           -- ูุชูุณุท ุงูุงุณุชููุงู ุงููููู
    fault_days INTEGER,                            -- ุนุฏุฏ ุฃูุงู ุงูุนุทู
    estimated_consumption DECIMAL(15,3),           -- ุงูุงุณุชููุงู ุงูุชูุฏูุฑู (kWh)
    estimated_consumption_amount DECIMAL(15,2),    -- ูููุฉ ุงูุงุณุชููุงู ุงูุชูุฏูุฑู (ุฑูุงู)
    estimation_approved BOOLEAN DEFAULT false,
    estimation_approved_by UUID REFERENCES users(id),
    estimation_approved_at TIMESTAMP,
    
    -- ุชูููุฉ ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ
    new_meter_cost_type ENUM('full', 'half', 'free') DEFAULT 'full',
    new_meter_cost DECIMAL(15,2) DEFAULT 0,
    
    -- ุงูููุงุชูุฑ ุงููุฑุชุจุทุฉ
    estimated_consumption_invoice_id UUID REFERENCES invoices(id),
    new_meter_invoice_id UUID REFERENCES invoices(id),
    
    -- ุงูุญุงูุฉ
    replacement_status ENUM(
        'pending_estimation',      -- ุจุงูุชุธุงุฑ ุญุณุงุจ ุงูุชูุฏูุฑ
        'estimation_pending_approval', -- ุงูุชูุฏูุฑ ุจุงูุชุธุงุฑ ุงูููุงููุฉ
        'pending_invoicing',       -- ุจุงูุชุธุงุฑ ุฅูุดุงุก ุงูููุงุชูุฑ
        'invoices_created',        -- ุชู ุฅูุดุงุก ุงูููุงุชูุฑ
        'pending_replacement',     -- ุจุงูุชุธุงุฑ ุงูุงุณุชุจุฏุงู ุงููุนูู
        'completed',               -- ููุชูู
        'cancelled'                -- ููุบู
    ) DEFAULT 'pending_estimation',
    
    completed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_faulty_replacement_customer ON faulty_meter_replacements(customer_id);
CREATE INDEX idx_faulty_replacement_status ON faulty_meter_replacements(replacement_status);
```

### 19.4 Function: ุญุณุงุจ ุงูุงุณุชููุงู ุงูุชูุฏูุฑู

```sql
CREATE OR REPLACE FUNCTION calculate_estimated_consumption(
    p_customer_id UUID,
    p_last_reading_date DATE
) RETURNS TABLE (
    avg_daily_consumption DECIMAL(15,3),
    fault_days INTEGER,
    estimated_consumption DECIMAL(15,3),
    estimated_amount DECIMAL(15,2),
    calculation_details JSONB
) AS $$
DECLARE
    v_total_consumption DECIMAL(15,3);
    v_days_count INTEGER;
    v_avg_daily DECIMAL(15,3);
    v_fault_days INTEGER;
    v_estimated_kwh DECIMAL(15,3);
    v_tariff_rate DECIMAL(10,4);
    v_estimated_amount DECIMAL(15,2);
    v_details JSONB;
BEGIN
    -- ุญุณุงุจ ูุฌููุน ุงูุงุณุชููุงู ูุขุฎุฑ 3 ุฃุดูุฑ
    SELECT 
        COALESCE(SUM(consumption_kwh), 0),
        COUNT(*) * 30  -- ุชูุฑูุจ ุนุฏุฏ ุงูุฃูุงู
    INTO v_total_consumption, v_days_count
    FROM invoices
    WHERE customer_id = p_customer_id
      AND invoice_type = 'consumption'
      AND billing_period_end >= (CURRENT_DATE - INTERVAL '3 months')
      AND status != 'cancelled';
    
    -- ุญุณุงุจ ูุชูุณุท ุงูุงุณุชููุงู ุงููููู
    IF v_days_count > 0 THEN
        v_avg_daily := v_total_consumption / v_days_count;
    ELSE
        -- ุฅุฐุง ูู ุชูุฌุฏ ููุงุชูุฑุ ูุณุชุฎุฏู ูุชูุณุท ุงูุชุฑุงุถู
        v_avg_daily := 10; -- 10 kWh ููููุงู ูุงูุชุฑุงุถู
    END IF;
    
    -- ุญุณุงุจ ุนุฏุฏ ุฃูุงู ุงูุนุทู
    v_fault_days := CURRENT_DATE - p_last_reading_date;
    
    -- ุญุณุงุจ ุงูุงุณุชููุงู ุงูุชูุฏูุฑู
    v_estimated_kwh := v_avg_daily * v_fault_days;
    
    -- ุฌูุจ ุณุนุฑ ุงูุชุนุฑูุฉ ุงูุญุงูู
    SELECT rate_per_kwh INTO v_tariff_rate
    FROM tariff_rates
    WHERE is_active = true
    ORDER BY effective_from DESC
    LIMIT 1;
    
    IF v_tariff_rate IS NULL THEN
        v_tariff_rate := 0.10; -- ุณุนุฑ ุงูุชุฑุงุถู
    END IF;
    
    -- ุญุณุงุจ ุงููุจูุบ
    v_estimated_amount := v_estimated_kwh * v_tariff_rate;
    
    -- ุชูุงุตูู ุงูุญุณุงุจ
    v_details := jsonb_build_object(
        'total_consumption_3_months', v_total_consumption,
        'days_count', v_days_count,
        'avg_daily_consumption', v_avg_daily,
        'fault_days', v_fault_days,
        'estimated_kwh', v_estimated_kwh,
        'tariff_rate', v_tariff_rate,
        'estimated_amount', v_estimated_amount,
        'calculation_date', CURRENT_DATE,
        'last_reading_date', p_last_reading_date
    );
    
    RETURN QUERY SELECT 
        v_avg_daily,
        v_fault_days,
        v_estimated_kwh,
        v_estimated_amount,
        v_details;
END;
$$ LANGUAGE plpgsql;
```

### 19.5 ุดุงุดุฉ ูุนุงูุฌ ุงุณุชุจุฏุงู ุงูุนุฏุงุฏ ุงูุชุงูู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      ูุนุงูุฌ ุงุณุชุจุฏุงู ุงูุนุฏุงุฏ ุงูุชุงูู                             โ
โ                         ุงูุฎุทูุฉ 1 ูู 4: ุญุณุงุจ ุงูุงุณุชููุงู ุงูุชูุฏูุฑู               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  ุฃูุฑ ุงูุนูู: WO-2024-1089                                                   โ
โ  ุงูุนููู: ุฎุงูุฏ ุฃุญูุฏ ูุญูุฏ          ุฑูู ุงูุญุณุงุจ: 101-2024-0056                 โ
โ  ุงูุนุฏุงุฏ ุงูุชุงูู: MTR-2023-00456                                             โ
โ  ููุน ุงูุนุทู: ุชููู ุนู ุงูุนูู                                                  โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         ุจูุงูุงุช ุงูุนุฏุงุฏ ุงูุชุงูู                                โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  ุขุฎุฑ ูุฑุงุกุฉ ุตุญูุญุฉ: 15,234.5 kWh                                             โ
โ  ุชุงุฑูุฎ ุขุฎุฑ ูุฑุงุกุฉ: 2024-10-15                                               โ
โ  ุชุงุฑูุฎ ุงูููู: 2024-12-16                                                   โ
โ  ุนุฏุฏ ุฃูุงู ุงูุนุทู: 62 ููู                                                    โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                    ๐ก ุญุณุงุจ ุงูุงุณุชููุงู ุงูุชูุฏูุฑู (ุชููุงุฆู)                       โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงุณุชููุงู ุขุฎุฑ 3 ุฃุดูุฑ:                                                  โ   โ
โ  โ   โข ุฃูุชูุจุฑ 2024: 450 kWh                                            โ   โ
โ  โ   โข ุณุจุชูุจุฑ 2024: 420 kWh                                            โ   โ
โ  โ   โข ุฃุบุณุทุณ 2024: 480 kWh                                             โ   โ
โ  โ   โข ุงููุฌููุน: 1,350 kWh                                              โ   โ
โ  โ                                                                      โ   โ
โ  โ ูุชูุณุท ุงูุงุณุชููุงู ุงููููู: 1,350 รท 90 = 15 kWh/ููู                     โ   โ
โ  โ                                                                      โ   โ
โ  โ ุงูุงุณุชููุงู ุงูุชูุฏูุฑู: 15 ร 62 = 930 kWh                               โ   โ
โ  โ                                                                      โ   โ
โ  โ ุณุนุฑ ุงูุชุนุฑูุฉ: 0.12 ุฑูุงู/kWh                                          โ   โ
โ  โ                                                                      โ   โ
โ  โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ ูููุฉ ุงูุงุณุชููุงู ุงูุชูุฏูุฑู: 930 ร 0.12 = 111.60 ุฑูุงู                   โ   โ
โ  โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โ๏ธ ุฃูุงูู ุนูู ูุฐุง ุงูุชูุฏูุฑ                                                  โ
โ  โ ุชุนุฏูู ุงูุชูุฏูุฑ ูุฏููุงู: [_______] kWh                                     โ
โ                                                                             โ
โ            [โ ุฅูุบุงุก]            [โก๏ธ ุงูุชุงูู: ุชูููุฉ ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ]           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 19.6 ุดุงุดุฉ ุชูููุฉ ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ (ุงูุฎุทูุฉ 2)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      ูุนุงูุฌ ุงุณุชุจุฏุงู ุงูุนุฏุงุฏ ุงูุชุงูู                             โ
โ                         ุงูุฎุทูุฉ 2 ูู 4: ุชูููุฉ ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         ุชุญุฏูุฏ ุชูููุฉ ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ                           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ ุงููุฎุตุต: MTR-2024-00789                                      โ
โ  ููุน ุงูุนุฏุงุฏ: ุชูููุฏู ุฃุญุงุฏู ุงูุทูุฑ                                            โ
โ  ุณุนุฑ ุงูุนุฏุงุฏ ุงููุงูู: 25,000 ุฑูุงู                                            โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุณุจุจ ุงูุนุทู: [ุนุทู ููู ุทุจูุนู โผ]                                         โ   โ
โ  โ                                                                      โ   โ
โ  โ ุฎูุงุฑุงุช ุงูุชูููุฉ:                                                      โ   โ
โ  โ                                                                      โ   โ
โ  โ โ ุชูููุฉ ูุงููุฉ (25,000 ุฑูุงู)                                         โ   โ
โ  โ   โโ ุงูุนููู ูุณุคูู ุนู ุงูุนุทู (ุณูุก ุงุณุชุฎุฏุงู/ุชูุงุนุจ)                       โ   โ
โ  โ                                                                      โ   โ
โ  โ โ ูุตู ุงูุชูููุฉ (12,500 ุฑูุงู)                                         โ   โ
โ  โ   โโ ุงูุนุทู ูุดุชุฑู ุฃู ุงูุชูุงุก ุงูุนูุฑ ุงูุงูุชุฑุงุถู                           โ   โ
โ  โ                                                                      โ   โ
โ  โ โ ูุฌุงูุงู (0 ุฑูุงู)                                                    โ   โ
โ  โ   โโ ุนุทู ูุตูุนู ุฃู ุฎุทุฃ ูู ุงูุดุฑูุฉ                                      โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  ููุงุญุธุงุช: [ุงูุชูุงุก ุงูุนูุฑ ุงูุงูุชุฑุงุถู ููุนุฏุงุฏ ุจุนุฏ 10 ุณููุงุช_______]             โ
โ                                                                             โ
โ         [โฌ๏ธ ุงูุณุงุจู]            [โก๏ธ ุงูุชุงูู: ูุฑุงุฌุนุฉ ุงูููุงุชูุฑ]                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 19.7 ุดุงุดุฉ ูุฑุงุฌุนุฉ ูุฅูุดุงุก ุงูููุงุชูุฑ (ุงูุฎุทูุฉ 3)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      ูุนุงูุฌ ุงุณุชุจุฏุงู ุงูุนุฏุงุฏ ุงูุชุงูู                             โ
โ                         ุงูุฎุทูุฉ 3 ูู 4: ูุฑุงุฌุนุฉ ูุฅูุดุงุก ุงูููุงุชูุฑ                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         ููุฎุต ุงูููุงุชูุฑ ุงููุทููุจ ุฅูุดุงุคูุง                       โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงููุงุชูุฑุฉ #1: ุงุณุชููุงู ุชูุฏูุฑู                                          โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงููุตู: ุงุณุชููุงู ุชูุฏูุฑู ููุชุฑุฉ ุนุทู ุงูุนุฏุงุฏ (62 ููู)                      โ   โ
โ  โ ุงููููุฉ: 930 kWh                                                      โ   โ
โ  โ ุงูุณุนุฑ: 0.12 ุฑูุงู/kWh                                                 โ   โ
โ  โ ุงููุจูุบ: 111.60 ุฑูุงู                                                  โ   โ
โ  โ ุงูุญุงูุฉ: โณ ุจุงูุชุธุงุฑ ุงูุฅูุดุงุก                                            โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงููุงุชูุฑุฉ #2: ุชูููุฉ ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ                                      โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงููุตู: ุชูููุฉ ุงุณุชุจุฏุงู ุงูุนุฏุงุฏ (50% ูู ุงูุณุนุฑ)                           โ   โ
โ  โ ููุน ุงูุนุฏุงุฏ: ุชูููุฏู ุฃุญุงุฏู ุงูุทูุฑ                                       โ   โ
โ  โ ุงููุจูุบ: 12,500 ุฑูุงู                                                  โ   โ
โ  โ ุงูุญุงูุฉ: โณ ุจุงูุชุธุงุฑ ุงูุฅูุดุงุก                                            โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุฅุฌูุงูู ุงููุณุชุญูุงุช ุงูุฌุฏูุฏุฉ: 12,611.60 ุฑูุงู                             โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โ๏ธ ุณูุชู ุฅุถุงูุฉ ูุฐู ุงูููุงุชูุฑ ุฅูู ุญุณุงุจ ูุฏููููุฉ ุงูุนููู ููุฑุงู                  โ
โ                                                                             โ
โ         [โฌ๏ธ ุงูุณุงุจู]            [โ ุฅูุดุงุก ุงูููุงุชูุฑ ูุงููุชุงุจุนุฉ]               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 19.8 Trigger: ุฅูุดุงุก ููุงุชูุฑ ุงูุงุณุชุจุฏุงู

```sql
CREATE OR REPLACE FUNCTION create_replacement_invoices()
RETURNS TRIGGER AS $$
DECLARE
    v_estimation_invoice_id UUID;
    v_meter_invoice_id UUID;
BEGIN
    -- ุฅูุดุงุก ูุงุชูุฑุฉ ุงูุงุณุชููุงู ุงูุชูุฏูุฑู
    IF NEW.estimated_consumption_amount > 0 AND NEW.estimation_approved = true THEN
        INSERT INTO invoices (
            station_id,
            customer_id,
            invoice_type,
            invoice_number,
            total_amount,
            status,
            due_date,
            notes,
            reference_type,
            reference_id
        ) VALUES (
            NEW.station_id,
            NEW.customer_id,
            'estimated_consumption',
            'INV-EST-' || NEW.work_order_id,
            NEW.estimated_consumption_amount,
            'pending',
            CURRENT_DATE + INTERVAL '30 days',
            'ุงุณุชููุงู ุชูุฏูุฑู ููุชุฑุฉ ุนุทู ุงูุนุฏุงุฏ (' || NEW.fault_days || ' ููู) - ' || NEW.estimated_consumption || ' kWh',
            'faulty_meter_replacement',
            NEW.id
        ) RETURNING id INTO v_estimation_invoice_id;
        
        -- ุฅุถุงูุฉ ุจูุฏ ุงููุงุชูุฑุฉ
        INSERT INTO invoice_items (invoice_id, description, quantity, unit_price, amount)
        VALUES (
            v_estimation_invoice_id,
            'ุงุณุชููุงู ุชูุฏูุฑู',
            NEW.estimated_consumption,
            NEW.estimated_consumption_amount / NEW.estimated_consumption,
            NEW.estimated_consumption_amount
        );
        
        NEW.estimated_consumption_invoice_id := v_estimation_invoice_id;
    END IF;
    
    -- ุฅูุดุงุก ูุงุชูุฑุฉ ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ (ุฅุฐุง ูุงูุช ุงูุชูููุฉ > 0)
    IF NEW.new_meter_cost > 0 THEN
        INSERT INTO invoices (
            station_id,
            customer_id,
            invoice_type,
            invoice_number,
            total_amount,
            status,
            due_date,
            notes,
            reference_type,
            reference_id
        ) VALUES (
            NEW.station_id,
            NEW.customer_id,
            'meter_replacement',
            'INV-MTR-' || NEW.work_order_id,
            NEW.new_meter_cost,
            'pending',
            CURRENT_DATE + INTERVAL '30 days',
            'ุชูููุฉ ุงุณุชุจุฏุงู ุงูุนุฏุงุฏ (' || 
                CASE NEW.new_meter_cost_type 
                    WHEN 'full' THEN 'ูุงููุฉ'
                    WHEN 'half' THEN '50%'
                    ELSE 'ูุฌุงููุฉ'
                END || ') - ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ: ' || NEW.new_meter_serial,
            'faulty_meter_replacement',
            NEW.id
        ) RETURNING id INTO v_meter_invoice_id;
        
        -- ุฅุถุงูุฉ ุจูุฏ ุงููุงุชูุฑุฉ
        INSERT INTO invoice_items (invoice_id, description, quantity, unit_price, amount)
        VALUES (
            v_meter_invoice_id,
            'ุชูููุฉ ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ',
            1,
            NEW.new_meter_cost,
            NEW.new_meter_cost
        );
        
        NEW.new_meter_invoice_id := v_meter_invoice_id;
    END IF;
    
    -- ุชุญุฏูุซ ุงูุญุงูุฉ
    NEW.replacement_status := 'invoices_created';
    NEW.updated_at := NOW();
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_create_replacement_invoices
BEFORE UPDATE ON faulty_meter_replacements
FOR EACH ROW
WHEN (NEW.replacement_status = 'pending_invoicing' AND OLD.replacement_status != 'pending_invoicing')
EXECUTE FUNCTION create_replacement_invoices();
```

### 19.9 ุดุฑุท ุฅุชูุงู ุงูุงุณุชุจุฏุงู

```sql
CREATE OR REPLACE FUNCTION validate_replacement_completion()
RETURNS TRIGGER AS $$
BEGIN
    -- ุงูุชุญูู ูู ุฅูุดุงุก ุงูููุงุชูุฑ ูุจู ุงูุฅุชูุงู
    IF NEW.replacement_status = 'completed' THEN
        -- ุงูุชุญูู ูู ูุงุชูุฑุฉ ุงูุงุณุชููุงู ุงูุชูุฏูุฑู
        IF NEW.estimated_consumption_amount > 0 AND NEW.estimated_consumption_invoice_id IS NULL THEN
            RAISE EXCEPTION 'ูุง ูููู ุฅุชูุงู ุงูุงุณุชุจุฏุงู: ูุงุชูุฑุฉ ุงูุงุณุชููุงู ุงูุชูุฏูุฑู ุบูุฑ ููุฌูุฏุฉ';
        END IF;
        
        -- ุงูุชุญูู ูู ูุงุชูุฑุฉ ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ
        IF NEW.new_meter_cost > 0 AND NEW.new_meter_invoice_id IS NULL THEN
            RAISE EXCEPTION 'ูุง ูููู ุฅุชูุงู ุงูุงุณุชุจุฏุงู: ูุงุชูุฑุฉ ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ ุบูุฑ ููุฌูุฏุฉ';
        END IF;
        
        -- ุงูุชุญูู ูู ุชุนููู ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ
        IF NEW.new_meter_serial IS NULL THEN
            RAISE EXCEPTION 'ูุง ูููู ุฅุชูุงู ุงูุงุณุชุจุฏุงู: ูู ูุชู ุชุญุฏูุฏ ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ';
        END IF;
        
        NEW.completed_at := NOW();
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_validate_replacement_completion
BEFORE UPDATE ON faulty_meter_replacements
FOR EACH ROW
WHEN (NEW.replacement_status = 'completed')
EXECUTE FUNCTION validate_replacement_completion();
```

### 19.10 View: ููุฎุต ุงุณุชุจุฏุงูุงุช ุงูุนุฏุงุฏุงุช ุงูุชุงููุฉ

```sql
CREATE OR REPLACE VIEW v_faulty_meter_replacements_summary AS
SELECT 
    fmr.id,
    fmr.work_order_id,
    c.name AS customer_name,
    c.account_number,
    fmr.old_meter_serial,
    fmr.new_meter_serial,
    fmr.fault_type,
    fmr.fault_days,
    fmr.estimated_consumption,
    fmr.estimated_consumption_amount,
    fmr.new_meter_cost_type,
    fmr.new_meter_cost,
    (COALESCE(fmr.estimated_consumption_amount, 0) + COALESCE(fmr.new_meter_cost, 0)) AS total_invoiced,
    fmr.replacement_status,
    CASE 
        WHEN fmr.estimated_consumption_invoice_id IS NOT NULL THEN 'โ'
        ELSE 'โ'
    END AS estimation_invoice_created,
    CASE 
        WHEN fmr.new_meter_invoice_id IS NOT NULL OR fmr.new_meter_cost = 0 THEN 'โ'
        ELSE 'โ'
    END AS meter_invoice_created,
    fmr.created_at,
    fmr.completed_at
FROM faulty_meter_replacements fmr
JOIN customers c ON c.id = fmr.customer_id
ORDER BY fmr.created_at DESC;
```

### 19.11 APIs ูุนุงูุฌ ุงุณุชุจุฏุงู ุงูุนุฏุงุฏ ุงูุชุงูู

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| POST | /api/v1/meters/replacements | ุจุฏุก ุนูููุฉ ุงุณุชุจุฏุงู |
| GET | /api/v1/meters/replacements/:id | ุชูุงุตูู ุนูููุฉ ุงูุงุณุชุจุฏุงู |
| GET | /api/v1/meters/replacements/:id/estimate | ุญุณุงุจ ุงูุงุณุชููุงู ุงูุชูุฏูุฑู |
| PUT | /api/v1/meters/replacements/:id/approve-estimate | ุงูููุงููุฉ ุนูู ุงูุชูุฏูุฑ |
| PUT | /api/v1/meters/replacements/:id/set-cost | ุชุญุฏูุฏ ุชูููุฉ ุงูุนุฏุงุฏ |
| POST | /api/v1/meters/replacements/:id/create-invoices | ุฅูุดุงุก ุงูููุงุชูุฑ |
| PUT | /api/v1/meters/replacements/:id/complete | ุฅุชูุงู ุงูุงุณุชุจุฏุงู |


---

## 23. ุฃุตูู ุงูุจููุฉ ุงูุชุญุชูุฉ ูุดุจูุฉ ุงูุงุชุตุงูุงุช (Network Infrastructure Assets)

### 23.1 ูุธุฑุฉ ุนุงูุฉ

> **ุงูุบุฑุถ:** ุชุณุฌูู ูุฅุฏุงุฑุฉ ุฃุตูู ุดุจูุฉ ุงูุงุชุตุงูุงุช ุงููุงุณูููุฉ ุงูุฎุงุตุฉ ูุฃุตูู ุซุงุจุชุฉุ ูุน ุฑุณููุฉ ุงูุชูุงููู ูุชุชุจุน ุงูุฅููุงู.

### 23.2 ุฌุฏูู ุฃุตูู ุงูุดุจูุฉ (network_assets)

```sql
CREATE TABLE network_assets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- ูุนูููุงุช ุงูุฃุตู
    asset_code VARCHAR(50) UNIQUE NOT NULL,
    asset_name VARCHAR(200) NOT NULL,
    asset_type ENUM(
        'access_point',           -- ููุทุฉ ูุตูู
        'repeater',               -- ููุฑุฑ
        'backhaul_antenna',       -- ููุงุฆู Backhaul
        'sector_antenna',         -- ููุงุฆู ูุทุงุนู
        'network_switch',         -- ุณููุชุด
        'network_cabinet',        -- ุฎุฒุงูุฉ ุดุจูุฉ
        'ups_outdoor',            -- UPS ุฎุงุฑุฌู
        'fiber_link',             -- ูุตูุฉ ูุงูุจุฑ
        'network_infrastructure'  -- ุจููุฉ ุชุญุชูุฉ ูุชูุงููุฉ
    ) NOT NULL,
    
    -- ูุนูููุงุช ุงูุฌูุงุฒ
    serial_number VARCHAR(100),
    mac_address VARCHAR(17),
    model VARCHAR(100),
    manufacturer VARCHAR(100),
    
    -- ุงููููุน
    location_name VARCHAR(200),
    location_description TEXT,
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    altitude DECIMAL(6, 2),
    
    -- ุงูุฑุจุท ุจููุทุฉ ุงููุตูู
    access_point_id UUID REFERENCES access_points(id),
    
    -- ุงููุนูููุงุช ุงููุงููุฉ
    acquisition_date DATE NOT NULL,
    acquisition_cost DECIMAL(15, 2) NOT NULL,
    installation_cost DECIMAL(15, 2) DEFAULT 0,
    total_capitalized_cost DECIMAL(15, 2),  -- ุงูุชูููุฉ ุงููุฑุณููุฉ
    
    -- ุงูุฅููุงู
    useful_life_years INT DEFAULT 5,
    depreciation_method ENUM('straight_line', 'declining_balance') DEFAULT 'straight_line',
    salvage_value DECIMAL(15, 2) DEFAULT 0,
    accumulated_depreciation DECIMAL(15, 2) DEFAULT 0,
    current_book_value DECIMAL(15, 2),
    
    -- ุงูุถูุงู
    warranty_start_date DATE,
    warranty_end_date DATE,
    warranty_provider VARCHAR(200),
    
    -- ุงูุญุงูุฉ
    status ENUM(
        'operational',    -- ุชุนูู
        'maintenance',    -- ูู ุงูุตูุงูุฉ
        'offline',        -- ูุนุทูุฉ
        'disposed'        -- ูุณุชุจุนุฏุฉ
    ) DEFAULT 'operational',
    
    -- ุงูุชุฑููุจ
    installed_by UUID REFERENCES users(id),
    installation_date DATE,
    installation_notes TEXT,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ุญุณุงุจ ุงูุชูููุฉ ุงููุฑุณููุฉ ุชููุงุฆูุงู
CREATE OR REPLACE FUNCTION calculate_network_asset_cost()
RETURNS TRIGGER AS $$
BEGIN
    NEW.total_capitalized_cost := COALESCE(NEW.acquisition_cost, 0) + COALESCE(NEW.installation_cost, 0);
    NEW.current_book_value := NEW.total_capitalized_cost - COALESCE(NEW.accumulated_depreciation, 0);
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_network_asset_cost
BEFORE INSERT OR UPDATE ON network_assets
FOR EACH ROW
EXECUTE FUNCTION calculate_network_asset_cost();

CREATE INDEX idx_network_assets_station ON network_assets(station_id);
CREATE INDEX idx_network_assets_type ON network_assets(asset_type);
CREATE INDEX idx_network_assets_status ON network_assets(status);
```

### 23.3 ุฌุฏูู ุฑุณููุฉ ูุดุงุฑูุน ุงูุดุจูุฉ (network_project_capitalization)

```sql
CREATE TABLE network_project_capitalization (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- ูุนูููุงุช ุงููุดุฑูุน
    project_name VARCHAR(200) NOT NULL,
    project_description TEXT,
    coverage_area VARCHAR(200),           -- ุงูููุทูุฉ ุงููุบุทุงุฉ
    
    -- ุงูุชูุงููู
    equipment_cost DECIMAL(15, 2),        -- ุชูููุฉ ุงููุนุฏุงุช
    installation_cost DECIMAL(15, 2),     -- ุชูููุฉ ุงูุชุฑููุจ
    survey_cost DECIMAL(15, 2),           -- ุชูููุฉ ุงููุณุญ
    licensing_cost DECIMAL(15, 2),        -- ุชูููุฉ ุงูุชุฑุงุฎูุต
    other_costs DECIMAL(15, 2),           -- ุชูุงููู ุฃุฎุฑู
    total_project_cost DECIMAL(15, 2),    -- ุฅุฌูุงูู ุงูุชูููุฉ
    
    -- ุงูุฑุณููุฉ
    capitalization_date DATE,
    asset_account_code VARCHAR(50),       -- ุฑูุฒ ุญุณุงุจ ุงูุฃุตูู
    depreciation_start_date DATE,
    useful_life_years INT DEFAULT 5,
    
    -- ุงูุญุงูุฉ
    status ENUM('planning', 'in_progress', 'completed', 'capitalized') DEFAULT 'planning',
    
    -- ุงูููุงููุงุช
    approved_by UUID REFERENCES users(id),
    approved_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ุญุณุงุจ ุฅุฌูุงูู ุชูููุฉ ุงููุดุฑูุน
CREATE OR REPLACE FUNCTION calculate_network_project_cost()
RETURNS TRIGGER AS $$
BEGIN
    NEW.total_project_cost := COALESCE(NEW.equipment_cost, 0) + 
                              COALESCE(NEW.installation_cost, 0) + 
                              COALESCE(NEW.survey_cost, 0) + 
                              COALESCE(NEW.licensing_cost, 0) + 
                              COALESCE(NEW.other_costs, 0);
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_network_project_cost
BEFORE INSERT OR UPDATE ON network_project_capitalization
FOR EACH ROW
EXECUTE FUNCTION calculate_network_project_cost();
```

### 23.4 ุดุงุดุฉ ุชุณุฌูู ุฃุตู ุดุจูุฉ ุฌุฏูุฏ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ๐ก ุชุณุฌูู ุฃุตู ุดุจูุฉ ุงุชุตุงูุงุช ุฌุฏูุฏ                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ูุนูููุงุช ุงูุฃุตู ุงูุฃุณุงุณูุฉ                                              โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ ููุฏ ุงูุฃุตู:        [NET-AP-2024-001    ] (ุชููุงุฆู)                    โ   โ
โ  โ ุงุณู ุงูุฃุตู:        [ููุทุฉ ูุตูู ุญู ุงูุฃูู ุงูุฑุฆูุณูุฉ                   ] โ   โ
โ  โ ููุน ุงูุฃุตู:        [โผ ููุทุฉ ูุตูู                                   ] โ   โ
โ  โ ุงูุฑูู ุงูุชุณูุณูู:   [UAP-AC-M-001234                               ] โ   โ
โ  โ MAC Address:      [AA:BB:CC:DD:EE:01                             ] โ   โ
โ  โ ุงูุดุฑูุฉ ุงููุตูุนุฉ:   [Ubiquiti                                      ] โ   โ
โ  โ ุงูููุฏูู:          [UAP-AC-M                                      ] โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงููููุน                                                              โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ ุงุณู ุงููููุน:       [ุณุทุญ ูุญุทุฉ ุงูุฃูู ุงููุฑุนูุฉ                        ] โ   โ
โ  โ ุงูุฅุญุฏุงุซูุงุช:       [15.3694    ] ุฎุท ุงูุนุฑุถ  [44.1910    ] ุฎุท ุงูุทูู  โ   โ
โ  โ ุงูุงุฑุชูุงุน:         [15         ] ูุชุฑ                                โ   โ
โ  โ [๐ ุชุญุฏูุฏ ุนูู ุงูุฎุฑูุทุฉ]                                             โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงููุนูููุงุช ุงููุงููุฉ                                                   โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ ุชุงุฑูุฎ ุงูุงูุชูุงุก:   [2024-12-15]                                     โ   โ
โ  โ ุชูููุฉ ุงูุดุฑุงุก:     [150,000    ] ุฑ.ู                                โ   โ
โ  โ ุชูููุฉ ุงูุชุฑููุจ:    [25,000     ] ุฑ.ู                                โ   โ
โ  โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ   โ
โ  โ ุงูุชูููุฉ ุงููุฑุณููุฉ: [175,000    ] ุฑ.ู (ุชููุงุฆู)                       โ   โ
โ  โ                                                                     โ   โ
โ  โ ุงูุนูุฑ ุงูุฅูุชุงุฌู:   [5          ] ุณููุงุช                              โ   โ
โ  โ ุทุฑููุฉ ุงูุฅููุงู:    [โผ ุงููุณุท ุงูุซุงุจุช                                ] โ   โ
โ  โ ุงููููุฉ ุงูุชุฎุฑูุฏูุฉ: [10,000     ] ุฑ.ู                                โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงูุถูุงู                                                              โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ ุจุฏุงูุฉ ุงูุถูุงู:     [2024-12-15]                                     โ   โ
โ  โ ููุงูุฉ ุงูุถูุงู:     [2026-12-15]                                     โ   โ
โ  โ ูุฒูุฏ ุงูุถูุงู:      [ุดุฑูุฉ ุงูุงุชุตุงูุงุช ุงููุชูุฏูุฉ                       ] โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ            [๐พ ุญูุธ]    [๐ ุฑุจุท ุจููุทุฉ ูุตูู]    [โ ุฅูุบุงุก]                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 23.5 View: ููุฎุต ุฃุตูู ุงูุดุจูุฉ

```sql
CREATE OR REPLACE VIEW v_network_assets_summary AS
SELECT 
    s.id AS station_id,
    s.name AS station_name,
    na.asset_type,
    COUNT(na.id) AS total_assets,
    COUNT(CASE WHEN na.status = 'operational' THEN 1 END) AS operational_assets,
    COUNT(CASE WHEN na.status = 'offline' THEN 1 END) AS offline_assets,
    SUM(na.total_capitalized_cost) AS total_capitalized_value,
    SUM(na.accumulated_depreciation) AS total_depreciation,
    SUM(na.current_book_value) AS total_book_value,
    COUNT(CASE WHEN na.warranty_end_date > CURRENT_DATE THEN 1 END) AS assets_under_warranty
FROM stations s
LEFT JOIN network_assets na ON na.station_id = s.id
GROUP BY s.id, s.name, na.asset_type;
```

### 23.6 ุตูุงูุฉ ุฃุตูู ุงูุดุจูุฉ

```sql
-- ุฌุฏูู ุตูุงูุฉ ุฃุตูู ุงูุดุจูุฉ
CREATE TABLE network_asset_maintenance (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    network_asset_id UUID NOT NULL REFERENCES network_assets(id),
    
    -- ููุน ุงูุตูุงูุฉ
    maintenance_type ENUM(
        'preventive',     -- ููุงุฆูุฉ
        'corrective',     -- ุชุตุญูุญูุฉ
        'upgrade',        -- ุชุฑููุฉ
        'replacement'     -- ุงุณุชุจุฏุงู
    ) NOT NULL,
    
    -- ุงูุชูุงุตูู
    description TEXT,
    scheduled_date DATE,
    completed_date DATE,
    
    -- ุงูุชูููุฉ
    labor_cost DECIMAL(12, 2),
    parts_cost DECIMAL(12, 2),
    total_cost DECIMAL(12, 2),
    
    -- ุงูููู
    technician_id UUID REFERENCES users(id),
    
    -- ุงููุชูุฌุฉ
    result TEXT,
    status ENUM('scheduled', 'in_progress', 'completed', 'cancelled') DEFAULT 'scheduled',
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ุญุณุงุจ ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ
CREATE OR REPLACE FUNCTION calculate_maintenance_cost()
RETURNS TRIGGER AS $$
BEGIN
    NEW.total_cost := COALESCE(NEW.labor_cost, 0) + COALESCE(NEW.parts_cost, 0);
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_maintenance_cost
BEFORE INSERT OR UPDATE ON network_asset_maintenance
FOR EACH ROW
EXECUTE FUNCTION calculate_maintenance_cost();
```


---

# 15. ุฃุตูู ุงููุฑุงูุจุฉ ูุงูุฃูุงู (Surveillance Assets)

## 15.1 ุฌุฏูู ุฃุตูู ุงููุงููุฑุงุช (camera_assets)

```sql
CREATE TABLE camera_assets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- ูุนูููุงุช ุงูุฃุตู
    asset_code VARCHAR(50) UNIQUE NOT NULL,
    asset_name VARCHAR(200) NOT NULL,
    camera_type ENUM('fixed', 'ptz', 'dome', 'bullet', 'thermal') NOT NULL,
    
    -- ูุนูููุงุช ุงูุฌูุงุฒ
    serial_number VARCHAR(100) NOT NULL,
    mac_address VARCHAR(17),
    ip_address VARCHAR(45),
    brand VARCHAR(100),
    model VARCHAR(100),
    
    -- ุงููููุฉ ุงููุงููุฉ
    purchase_cost DECIMAL(15, 2),
    purchase_date DATE,
    useful_life_years INT DEFAULT 5,
    salvage_value DECIMAL(15, 2) DEFAULT 0,
    current_book_value DECIMAL(15, 2),
    
    -- ุงููููุน
    location_name VARCHAR(200),
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    
    -- ุงูุฑุจุท ุจุงูุฃุตู ุงูููุฑุงููุจ
    monitored_asset_type VARCHAR(50),
    monitored_asset_id UUID,
    monitored_asset_name VARCHAR(200),
    
    -- ุงูุญุงูุฉ
    status ENUM('active', 'inactive', 'maintenance', 'disposed') DEFAULT 'active',
    
    -- ุงูุชุฑููุจ
    installation_date DATE,
    installed_by UUID REFERENCES users(id),
    installation_work_order_id UUID,
    
    -- ุงูุถูุงู
    warranty_start DATE,
    warranty_end DATE,
    warranty_provider VARCHAR(200),
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_camera_assets_station ON camera_assets(station_id);
CREATE INDEX idx_camera_assets_status ON camera_assets(status);
CREATE INDEX idx_camera_assets_monitored ON camera_assets(monitored_asset_type, monitored_asset_id);
```

## 15.2 ุฌุฏูู ุฃุตูู ุงูุญุณุงุณุงุช (sensor_assets)

```sql
CREATE TABLE sensor_assets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- ูุนูููุงุช ุงูุฃุตู
    asset_code VARCHAR(50) UNIQUE NOT NULL,
    asset_name VARCHAR(200) NOT NULL,
    sensor_type ENUM('door', 'motion', 'smoke', 'temperature', 'flood') NOT NULL,
    
    -- ูุนูููุงุช ุงูุฌูุงุฒ
    serial_number VARCHAR(100) NOT NULL,
    
    -- ุงููููุฉ ุงููุงููุฉ
    purchase_cost DECIMAL(15, 2),
    purchase_date DATE,
    
    -- ุงููููุน
    location_name VARCHAR(200),
    
    -- ุงูุฑุจุท
    linked_camera_id UUID REFERENCES camera_assets(id),
    linked_asset_type VARCHAR(50),
    linked_asset_id UUID,
    
    -- ุงูุญุงูุฉ
    status ENUM('active', 'inactive', 'maintenance', 'disposed') DEFAULT 'active',
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

## 15.3 ุฌุฏูู ุตูุงูุฉ ุงููุงููุฑุงุช (camera_maintenance)

```sql
CREATE TABLE camera_maintenance (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    camera_asset_id UUID NOT NULL REFERENCES camera_assets(id),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- ููุน ุงูุตูุงูุฉ
    maintenance_type ENUM(
        'preventive',         -- ููุงุฆูุฉ
        'corrective',         -- ุชุตุญูุญูุฉ
        'cleaning',           -- ุชูุธูู
        'firmware_update',    -- ุชุญุฏูุซ ุงูุจุฑูุงูุฌ
        'replacement'         -- ุงุณุชุจุฏุงู
    ) NOT NULL,
    
    -- ุงูุชูุงุตูู
    description TEXT,
    findings TEXT,
    actions_taken TEXT,
    
    -- ุงูุชูููุฉ
    labor_cost DECIMAL(15, 2) DEFAULT 0,
    parts_cost DECIMAL(15, 2) DEFAULT 0,
    total_cost DECIMAL(15, 2) GENERATED ALWAYS AS (labor_cost + parts_cost) STORED,
    
    -- ุงูุชูููุฐ
    performed_by UUID REFERENCES users(id),
    performed_date DATE NOT NULL,
    
    -- ุฃูุฑ ุงูุนูู
    work_order_id UUID,
    
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_camera_maint_asset ON camera_maintenance(camera_asset_id);
CREATE INDEX idx_camera_maint_date ON camera_maintenance(performed_date);
```

## 15.4 View ููุฎุต ุฃุตูู ุงููุฑุงูุจุฉ

```sql
CREATE OR REPLACE VIEW v_surveillance_assets_summary AS
SELECT 
    s.id AS station_id,
    s.station_name,
    
    -- ุงููุงููุฑุงุช
    COUNT(DISTINCT ca.id) AS total_cameras,
    COUNT(DISTINCT CASE WHEN ca.status = 'active' THEN ca.id END) AS active_cameras,
    COUNT(DISTINCT CASE WHEN ca.status = 'inactive' THEN ca.id END) AS inactive_cameras,
    
    -- ุงูุญุณุงุณุงุช
    COUNT(DISTINCT sa.id) AS total_sensors,
    COUNT(DISTINCT CASE WHEN sa.sensor_type = 'door' THEN sa.id END) AS door_sensors,
    COUNT(DISTINCT CASE WHEN sa.sensor_type = 'motion' THEN sa.id END) AS motion_sensors,
    
    -- ุงููููุฉ
    COALESCE(SUM(ca.current_book_value), 0) AS cameras_book_value,
    COALESCE(SUM(sa.purchase_cost), 0) AS sensors_value,
    
    -- ุงูุตูุงูุฉ
    (
        SELECT COUNT(*) 
        FROM camera_maintenance cm 
        WHERE cm.station_id = s.id 
        AND cm.performed_date >= CURRENT_DATE - INTERVAL '30 days'
    ) AS maintenance_last_30_days

FROM stations s
LEFT JOIN camera_assets ca ON ca.station_id = s.id
LEFT JOIN sensor_assets sa ON sa.station_id = s.id
GROUP BY s.id, s.station_name;
```

## 15.5 ุดุงุดุฉ ุฅุฏุงุฑุฉ ุฃุตูู ุงููุฑุงูุจุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ๐น ุฅุฏุงุฑุฉ ุฃุตูู ุงููุฑุงูุจุฉ ูุงูุฃูุงู                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  ุงููุญุทุฉ: [ูุญุทุฉ ุงูุดูุงู โผ]                                                   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ๐ ููุฎุต ุงูุฃุตูู                                                      โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ  ๐น ุงููุงููุฑุงุช: 12 (ูุดุทุฉ: 11 | ูุนุทูุฉ: 1)                            โ   โ
โ  โ  ๐ช ุญุณุงุณุงุช ุงูุฃุจูุงุจ: 8                                               โ   โ
โ  โ  ๐ ุญุณุงุณุงุช ุงูุญุฑูุฉ: 4                                                โ   โ
โ  โ  ๐ฐ ุงููููุฉ ุงูุฏูุชุฑูุฉ: 45,000 ุฑ.ุณ                                     โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                              ุงููุงููุฑุงุช                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงูููุฏ    โ ุงูุงุณู          โ ุงูููุน   โ ุงููููุน      โ ูุฑุงูุจ    โ ุงูุญุงูุฉโ   โ
โ  โโโโโโโโโโโโผโโโโโโโโโโโโโโโโโผโโโโโโโโโโผโโโโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโค   โ
โ  โ CAM-001  โ ูุงููุฑุง ุงููููุฏ G1โ ุซุงุจุชุฉ  โ ุบุฑูุฉ ุงููููุฏุงุชโ ุงููููุฏ G1โ ๐ข    โ   โ
โ  โ CAM-002  โ ูุงููุฑุง ุงูุจูุงุจุฉ โ PTZ    โ ุงูุจูุงุจุฉ ุงูุฑุฆูุณูุฉโ ุงูุจูุงุจุฉโ ๐ข    โ   โ
โ  โ CAM-003  โ ูุงููุฑุง ุงููุญูู  โ ุซุงุจุชุฉ  โ ุบุฑูุฉ ุงููุญููุงุชโ ุงููุญูู T1โ ๐ด    โ   โ
โ  โ CAM-004  โ ูุงููุฑุง ุงููุฎุฒู  โ ูุจุฉ    โ ุงููุฎุฒู      โ -        โ ๐ข    โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  [โ ุฅุถุงูุฉ ูุงููุฑุง]  [๐ง ุฌุฏููุฉ ุตูุงูุฉ]  [๐ ุชูุฑูุฑ ุงูุฃุตูู]                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```


---

# 14. ูุญุฏุฉ ุงูุตูุงูุฉ ุงูููุงุฆูุฉ ุงููุฌุฏููุฉ (Preventive Maintenance - PM)

## 14.1 ูุธุฑุฉ ุนุงูุฉ

> **ุงูุบุฑุถ:** ุฅูุดุงุก ูุธุงู ูุชุนุฑูู ูุฌุฏููุฉ ูุชุชุจุน ููุงู ุงูุตูุงูุฉ ุงูุฏูุฑูุฉ ุจูุงุกู ุนูู ุชูููู ุฒููู ุฃู ูุฑุงุกุงุช ุงูุนุฏุงุฏุงุชุ ูุฑุจุทูุง ุจุงููุฎุฒูู ูุงูุชูุงุฑูุฑ.

### ุงููุฒุงูุง ุงูุฑุฆูุณูุฉ

1. **ุตูุงูุฉ ุงุณุชุจุงููุฉ:** ุชูููู ุงูุฃุนุทุงู ุงูููุงุฌุฆุฉ ูุฒูุงุฏุฉ ุนูุฑ ุงูุฃุตู
2. **ุฃุชูุชุฉ ูุงููุฉ:** ุจุฏูู Excel ุฃู ุชุฐูุฑ ูุฏูู
3. **ุฅุฏุงุฑุฉ ูุฎุฒูู ุฏูููุฉ:** ุฑุจุท ุงูุงุณุชููุงู ุจุฃูุงูุฑ ุงูุนูู
4. **ุณุฌู ุตูุงูุฉ ูุงูู:** ุชุญููู ุงูุชูุงููู ูุงูุฃุฏุงุก

## 14.2 ุฌุฏูู ุฎุทุท ุงูุตูุงูุฉ ุงูููุงุฆูุฉ (pm_plans)

```sql
CREATE TABLE pm_plans (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- ูุนูููุงุช ุงูุฎุทุฉ
    plan_code VARCHAR(50) UNIQUE NOT NULL,
    plan_name VARCHAR(200) NOT NULL,
    description TEXT,
    
    -- ูุทุงู ุงูุชุทุจูู
    scope_type ENUM('single_asset', 'asset_category', 'asset_model') NOT NULL,
    asset_id UUID REFERENCES assets(id),              -- ููุฃุตู ุงููุญุฏุฏ
    asset_category_id UUID REFERENCES asset_categories(id),  -- ูููุฆุฉ
    asset_model VARCHAR(100),                         -- ููููุฏูู
    
    -- ููุน ุงูููุดุบูู
    trigger_type ENUM(
        'time_based',           -- ูุงุฆู ุนูู ุงูููุช
        'usage_based',          -- ูุงุฆู ุนูู ุงูุงุณุชุฎุฏุงู
        'hybrid'                -- ูุฒูุฌ (ุฃูููุง ูุฃุชู ุฃููุงู)
    ) NOT NULL,
    
    -- ุฅุนุฏุงุฏุงุช ุงูููุดุบูู ุงูุฒููู
    time_frequency ENUM('daily', 'weekly', 'biweekly', 'monthly', 'quarterly', 'semi_annual', 'annual'),
    time_day_of_week INT,                             -- 0-6 ููุฃุณุจูุนู
    time_day_of_month INT,                            -- 1-31 ููุดูุฑู
    time_month_of_year INT,                           -- 1-12 ููุณููู
    
    -- ุฅุนุฏุงุฏุงุช ุงูููุดุบูู ุจุงูุงุณุชุฎุฏุงู
    usage_meter_type ENUM('running_hours', 'kwh_produced', 'km_traveled', 'cycles'),
    usage_interval DECIMAL(12, 2),                    -- ูู 250 ุณุงุนุฉ ูุซูุงู
    usage_tolerance_percent DECIMAL(5, 2) DEFAULT 10, -- ูุงูุด ุงูุชุณุงูุญ
    
    -- ุงูุฃููููุฉ ูุงูุชุตููู
    priority ENUM('critical', 'high', 'medium', 'low') DEFAULT 'medium',
    estimated_duration_hours DECIMAL(5, 2),
    requires_shutdown BOOLEAN DEFAULT false,
    
    -- ุงูุญุงูุฉ
    is_active BOOLEAN DEFAULT true,
    last_generated_date DATE,
    next_due_date DATE,
    
    -- ุงูุชุชุจุน
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    CONSTRAINT valid_time_trigger CHECK (
        trigger_type != 'time_based' OR time_frequency IS NOT NULL
    ),
    CONSTRAINT valid_usage_trigger CHECK (
        trigger_type != 'usage_based' OR (usage_meter_type IS NOT NULL AND usage_interval IS NOT NULL)
    )
);

CREATE INDEX idx_pm_plans_active ON pm_plans(is_active);
CREATE INDEX idx_pm_plans_next_due ON pm_plans(next_due_date);
```

## 14.3 ุฌุฏูู ููุงู ุฎุทุฉ ุงูุตูุงูุฉ (pm_plan_tasks)

```sql
CREATE TABLE pm_plan_tasks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    pm_plan_id UUID NOT NULL REFERENCES pm_plans(id) ON DELETE CASCADE,
    
    -- ุชุฑุชูุจ ุงููููุฉ
    sequence_number INT NOT NULL,
    
    -- ุชูุงุตูู ุงููููุฉ
    task_name VARCHAR(200) NOT NULL,
    task_description TEXT,
    task_instructions TEXT,                           -- ุชุนูููุงุช ุชูุตูููุฉ
    
    -- ุงูููุช ุงูููุฏุฑ
    estimated_minutes INT DEFAULT 30,
    
    -- ูุชุทูุจุงุช ุฎุงุตุฉ
    requires_specialist BOOLEAN DEFAULT false,
    specialist_skill VARCHAR(100),
    safety_precautions TEXT,
    
    -- ุญุงูุฉ ุงููููุฉ
    is_mandatory BOOLEAN DEFAULT true,
    
    created_at TIMESTAMP DEFAULT NOW(),
    
    UNIQUE(pm_plan_id, sequence_number)
);

CREATE INDEX idx_pm_tasks_plan ON pm_plan_tasks(pm_plan_id);
```

## 14.4 ุฌุฏูู ุงูููุงุฏ ุงููุทููุจุฉ ูููููุฉ (pm_task_materials)

```sql
CREATE TABLE pm_task_materials (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    pm_task_id UUID NOT NULL REFERENCES pm_plan_tasks(id) ON DELETE CASCADE,
    
    -- ุงููุงุฏุฉ ุงููุทููุจุฉ
    item_id UUID NOT NULL REFERENCES inventory_items(id),
    
    -- ุงููููุฉ
    required_quantity DECIMAL(10, 3) NOT NULL,
    unit_of_measure VARCHAR(20) NOT NULL,
    
    -- ุจุฏูู ููุจูู
    allow_substitute BOOLEAN DEFAULT false,
    substitute_item_id UUID REFERENCES inventory_items(id),
    
    -- ููุงุญุธุงุช
    notes TEXT,
    
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_pm_materials_task ON pm_task_materials(pm_task_id);
CREATE INDEX idx_pm_materials_item ON pm_task_materials(item_id);
```

## 14.5 ุฌุฏูู ุฃูุงูุฑ ุนูู ุงูุตูุงูุฉ ุงูููุงุฆูุฉ (pm_work_orders)

```sql
CREATE TABLE pm_work_orders (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- ุงูุฑุจุท ุจุงูุฎุทุฉ ูุงูุฃุตู
    pm_plan_id UUID NOT NULL REFERENCES pm_plans(id),
    asset_id UUID NOT NULL REFERENCES assets(id),
    
    -- ุฑูู ุฃูุฑ ุงูุนูู
    wo_number VARCHAR(50) UNIQUE NOT NULL,
    
    -- ุงูุชูุงุฑูุฎ
    scheduled_date DATE NOT NULL,
    due_date DATE NOT NULL,
    started_at TIMESTAMP,
    completed_at TIMESTAMP,
    
    -- ูุฑุงุกุฉ ุงูุนุฏุงุฏ ุนูุฏ ุงูุฅูุดุงุก
    meter_reading_at_creation DECIMAL(12, 2),
    meter_reading_at_completion DECIMAL(12, 2),
    
    -- ุงูุฅุณูุงุฏ
    assigned_to UUID REFERENCES employees(id),
    assigned_team_id UUID REFERENCES teams(id),
    assigned_at TIMESTAMP,
    assigned_by UUID REFERENCES users(id),
    
    -- ุงูุญุงูุฉ
    status ENUM(
        'scheduled',            -- ูุฌุฏูู
        'pending_assignment',   -- ุจุงูุชุธุงุฑ ุงูุฅุณูุงุฏ
        'assigned',             -- ููุณูุฏ
        'in_progress',          -- ููุฏ ุงูุชูููุฐ
        'pending_parts',        -- ุจุงูุชุธุงุฑ ูุทุน ุบูุงุฑ
        'completed',            -- ููุชูู
        'cancelled',            -- ููุบู
        'overdue'               -- ูุชุฃุฎุฑ
    ) DEFAULT 'scheduled',
    
    -- ุงูุฃููููุฉ
    priority ENUM('critical', 'high', 'medium', 'low') DEFAULT 'medium',
    
    -- ููุงุญุธุงุช
    notes TEXT,
    completion_notes TEXT,
    
    -- ุงูุชูููุฉ
    labor_cost DECIMAL(12, 2) DEFAULT 0,
    material_cost DECIMAL(12, 2) DEFAULT 0,
    total_cost DECIMAL(12, 2) GENERATED ALWAYS AS (labor_cost + material_cost) STORED,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_pm_wo_plan ON pm_work_orders(pm_plan_id);
CREATE INDEX idx_pm_wo_asset ON pm_work_orders(asset_id);
CREATE INDEX idx_pm_wo_status ON pm_work_orders(status);
CREATE INDEX idx_pm_wo_scheduled ON pm_work_orders(scheduled_date);
CREATE INDEX idx_pm_wo_assigned ON pm_work_orders(assigned_to);
```

## 14.6 ุฌุฏูู ุชูููุฐ ููุงู ุฃูุฑ ุงูุนูู (pm_wo_task_execution)

```sql
CREATE TABLE pm_wo_task_execution (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    pm_work_order_id UUID NOT NULL REFERENCES pm_work_orders(id) ON DELETE CASCADE,
    pm_task_id UUID NOT NULL REFERENCES pm_plan_tasks(id),
    
    -- ุญุงูุฉ ุงูุชูููุฐ
    status ENUM('pending', 'in_progress', 'completed', 'skipped') DEFAULT 'pending',
    
    -- ุงูุชูููุฐ
    executed_by UUID REFERENCES employees(id),
    started_at TIMESTAMP,
    completed_at TIMESTAMP,
    actual_minutes INT,
    
    -- ุงููุชูุฌุฉ
    result ENUM('pass', 'fail', 'needs_attention') DEFAULT 'pass',
    findings TEXT,
    
    -- ุตูุฑ/ูุฑููุงุช
    attachments JSONB DEFAULT '[]',
    
    created_at TIMESTAMP DEFAULT NOW(),
    
    UNIQUE(pm_work_order_id, pm_task_id)
);

CREATE INDEX idx_pm_execution_wo ON pm_wo_task_execution(pm_work_order_id);
```

## 14.7 ุฌุฏูู ุงูููุงุฏ ุงููุณุชุฎุฏูุฉ (pm_wo_materials_used)

```sql
CREATE TABLE pm_wo_materials_used (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    pm_work_order_id UUID NOT NULL REFERENCES pm_work_orders(id) ON DELETE CASCADE,
    
    -- ุงููุงุฏุฉ
    item_id UUID NOT NULL REFERENCES inventory_items(id),
    
    -- ุงููููุฉ
    quantity_used DECIMAL(10, 3) NOT NULL,
    unit_of_measure VARCHAR(20) NOT NULL,
    unit_cost DECIMAL(12, 2),
    total_cost DECIMAL(12, 2),
    
    -- ูุตุฏุฑ ุงููุงุฏุฉ
    source_warehouse_id UUID REFERENCES warehouses(id),
    inventory_transaction_id UUID,                    -- ุฑุจุท ุจุญุฑูุฉ ุงููุฎุฒูู
    
    -- ุชุณุฌูู
    recorded_by UUID REFERENCES employees(id),
    recorded_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_pm_materials_wo ON pm_wo_materials_used(pm_work_order_id);
```

## 14.8 ูุญุฑู ุฌุฏููุฉ ุงูุตูุงูุฉ ุงูููุงุฆูุฉ

```sql
-- Function ูุฅูุดุงุก ุฃูุงูุฑ ุนูู PM
CREATE OR REPLACE FUNCTION generate_pm_work_orders()
RETURNS TABLE (
    plan_id UUID,
    plan_name VARCHAR,
    assets_count INT,
    work_orders_created INT
) AS $$
DECLARE
    v_plan RECORD;
    v_asset RECORD;
    v_wo_count INT;
    v_last_reading DECIMAL(12, 2);
    v_last_pm_reading DECIMAL(12, 2);
    v_should_generate BOOLEAN;
    v_wo_number VARCHAR(50);
BEGIN
    FOR v_plan IN 
        SELECT * FROM pm_plans WHERE is_active = true
    LOOP
        v_wo_count := 0;
        
        -- ุงูุญุตูู ุนูู ุงูุฃุตูู ุงููุทุจู ุนูููุง ุงูุฎุทุฉ
        FOR v_asset IN 
            SELECT a.* FROM assets a
            WHERE (v_plan.scope_type = 'single_asset' AND a.id = v_plan.asset_id)
               OR (v_plan.scope_type = 'asset_category' AND a.category_id = v_plan.asset_category_id)
               OR (v_plan.scope_type = 'asset_model' AND a.model = v_plan.asset_model)
        LOOP
            v_should_generate := false;
            
            -- ุงูุชุญูู ูู ุงูููุดุบูู ุงูุฒููู
            IF v_plan.trigger_type IN ('time_based', 'hybrid') THEN
                v_should_generate := CASE v_plan.time_frequency
                    WHEN 'daily' THEN true
                    WHEN 'weekly' THEN EXTRACT(DOW FROM CURRENT_DATE) = COALESCE(v_plan.time_day_of_week, 0)
                    WHEN 'monthly' THEN EXTRACT(DAY FROM CURRENT_DATE) = COALESCE(v_plan.time_day_of_month, 1)
                    WHEN 'quarterly' THEN EXTRACT(DAY FROM CURRENT_DATE) = 1 AND EXTRACT(MONTH FROM CURRENT_DATE) IN (1,4,7,10)
                    WHEN 'annual' THEN EXTRACT(DAY FROM CURRENT_DATE) = 1 AND EXTRACT(MONTH FROM CURRENT_DATE) = COALESCE(v_plan.time_month_of_year, 1)
                    ELSE false
                END;
            END IF;
            
            -- ุงูุชุญูู ูู ุงูููุดุบูู ุจุงูุงุณุชุฎุฏุงู
            IF v_plan.trigger_type IN ('usage_based', 'hybrid') AND NOT v_should_generate THEN
                -- ุขุฎุฑ ูุฑุงุกุฉ ููุนุฏุงุฏ
                SELECT meter_value INTO v_last_reading
                FROM asset_meter_readings
                WHERE asset_id = v_asset.id AND meter_type = v_plan.usage_meter_type
                ORDER BY reading_date DESC LIMIT 1;
                
                -- ูุฑุงุกุฉ ุขุฎุฑ ุตูุงูุฉ
                SELECT meter_reading_at_completion INTO v_last_pm_reading
                FROM pm_work_orders
                WHERE asset_id = v_asset.id AND pm_plan_id = v_plan.id AND status = 'completed'
                ORDER BY completed_at DESC LIMIT 1;
                
                IF v_last_reading IS NOT NULL THEN
                    v_should_generate := (v_last_reading - COALESCE(v_last_pm_reading, 0)) >= v_plan.usage_interval;
                END IF;
            END IF;
            
            -- ุฅูุดุงุก ุฃูุฑ ุงูุนูู
            IF v_should_generate THEN
                -- ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃูุฑ ุนูู ููุชูุญ
                IF NOT EXISTS (
                    SELECT 1 FROM pm_work_orders 
                    WHERE pm_plan_id = v_plan.id AND asset_id = v_asset.id 
                    AND status NOT IN ('completed', 'cancelled')
                ) THEN
                    -- ุฅูุดุงุก ุฑูู ุฃูุฑ ุงูุนูู
                    v_wo_number := 'PM-' || TO_CHAR(CURRENT_DATE, 'YYYYMMDD') || '-' || 
                                   LPAD((SELECT COUNT(*) + 1 FROM pm_work_orders WHERE DATE(created_at) = CURRENT_DATE)::TEXT, 4, '0');
                    
                    INSERT INTO pm_work_orders (
                        pm_plan_id, asset_id, wo_number, scheduled_date, due_date,
                        priority, status, meter_reading_at_creation
                    ) VALUES (
                        v_plan.id, v_asset.id, v_wo_number, CURRENT_DATE,
                        CURRENT_DATE + INTERVAL '7 days', v_plan.priority,
                        'pending_assignment', v_last_reading
                    );
                    
                    v_wo_count := v_wo_count + 1;
                END IF;
            END IF;
        END LOOP;
        
        -- ุชุญุฏูุซ ุชุงุฑูุฎ ุขุฎุฑ ุฅูุดุงุก
        IF v_wo_count > 0 THEN
            UPDATE pm_plans SET last_generated_date = CURRENT_DATE WHERE id = v_plan.id;
        END IF;
        
        plan_id := v_plan.id;
        plan_name := v_plan.plan_name;
        assets_count := (SELECT COUNT(*) FROM assets WHERE 
            (v_plan.scope_type = 'single_asset' AND id = v_plan.asset_id) OR
            (v_plan.scope_type = 'asset_category' AND category_id = v_plan.asset_category_id) OR
            (v_plan.scope_type = 'asset_model' AND model = v_plan.asset_model));
        work_orders_created := v_wo_count;
        
        RETURN NEXT;
    END LOOP;
END;
$$ LANGUAGE plpgsql;
```

## 14.9 Function ุฅููุงู ุฃูุฑ ุนูู PM ูุฎุตู ุงููุฎุฒูู

```sql
CREATE OR REPLACE FUNCTION complete_pm_work_order(
    p_wo_id UUID,
    p_completion_notes TEXT DEFAULT NULL,
    p_meter_reading DECIMAL(12, 2) DEFAULT NULL
) RETURNS JSONB AS $$
DECLARE
    v_wo RECORD;
    v_material RECORD;
    v_total_material_cost DECIMAL(12, 2) := 0;
BEGIN
    -- ุงูุญุตูู ุนูู ุฃูุฑ ุงูุนูู
    SELECT * INTO v_wo FROM pm_work_orders WHERE id = p_wo_id;
    
    IF v_wo IS NULL THEN
        RETURN jsonb_build_object('success', false, 'error', 'ุฃูุฑ ุงูุนูู ุบูุฑ ููุฌูุฏ');
    END IF;
    
    IF v_wo.status = 'completed' THEN
        RETURN jsonb_build_object('success', false, 'error', 'ุฃูุฑ ุงูุนูู ููุชูู ูุณุจูุงู');
    END IF;
    
    -- ุฎุตู ุงูููุงุฏ ูู ุงููุฎุฒูู
    FOR v_material IN 
        SELECT * FROM pm_wo_materials_used WHERE pm_work_order_id = p_wo_id
    LOOP
        -- ุฅูุดุงุก ุญุฑูุฉ ูุฎุฒูู (ุตุฑู)
        INSERT INTO inventory_transactions (
            item_id, transaction_type, quantity, reference_type, reference_id,
            warehouse_id, notes
        ) VALUES (
            v_material.item_id, 'issue', -v_material.quantity_used,
            'pm_work_order', p_wo_id, v_material.source_warehouse_id,
            'ุตุฑู ูุฃูุฑ ุนูู ุตูุงูุฉ ููุงุฆูุฉ: ' || v_wo.wo_number
        );
        
        -- ุชุญุฏูุซ ุฑุตูุฏ ุงููุฎุฒูู
        UPDATE inventory_stock
        SET quantity = quantity - v_material.quantity_used,
            updated_at = NOW()
        WHERE item_id = v_material.item_id AND warehouse_id = v_material.source_warehouse_id;
        
        v_total_material_cost := v_total_material_cost + COALESCE(v_material.total_cost, 0);
    END LOOP;
    
    -- ุชุญุฏูุซ ุฃูุฑ ุงูุนูู
    UPDATE pm_work_orders SET
        status = 'completed',
        completed_at = NOW(),
        completion_notes = p_completion_notes,
        meter_reading_at_completion = p_meter_reading,
        material_cost = v_total_material_cost,
        updated_at = NOW()
    WHERE id = p_wo_id;
    
    -- ุชุณุฌูู ูู ุณุฌู ุงูุฃุตู ุงูุชุงุฑูุฎู
    INSERT INTO asset_maintenance_history (
        asset_id, maintenance_type, work_order_id, work_order_type,
        description, performed_by, performed_at, total_cost
    )
    SELECT 
        v_wo.asset_id, 'preventive', p_wo_id, 'pm',
        pp.plan_name, v_wo.assigned_to, NOW(), v_wo.total_cost
    FROM pm_plans pp WHERE pp.id = v_wo.pm_plan_id;
    
    RETURN jsonb_build_object(
        'success', true,
        'wo_number', v_wo.wo_number,
        'material_cost', v_total_material_cost
    );
END;
$$ LANGUAGE plpgsql;
```

## 14.10 ุดุงุดุฉ ุฅูุดุงุก ุฎุทุฉ ุตูุงูุฉ ููุงุฆูุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ๐ง ุฅูุดุงุก ุฎุทุฉ ุตูุงูุฉ ููุงุฆูุฉ ุฌุฏูุฏุฉ                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                           ูุนูููุงุช ุงูุฎุทุฉ ุงูุฃุณุงุณูุฉ                           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  ููุฏ ุงูุฎุทุฉ: [PM-GEN-OIL-250H        ]                                      โ
โ  ุงุณู ุงูุฎุทุฉ: [ุชุบููุฑ ุฒูุช ุงููููุฏุงุช ูู 250 ุณุงุนุฉ                              ] โ
โ  ุงููุตู:     [ุตูุงูุฉ ุฏูุฑูุฉ ูุชุบููุฑ ุฒูุช ุงููุญุฑู ูููุชุฑ ุงูุฒูุช ูููููุฏุงุช          ] โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                              ูุทุงู ุงูุชุทุจูู                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  ููุน ุงููุทุงู: (โ) ูุฆุฉ ุฃุตูู  ( ) ุฃุตู ูุญุฏุฏ  ( ) ููุฏูู                        โ
โ  ุงููุฆุฉ:      [ุงููููุฏุงุช ุงูููุฑุจุงุฆูุฉ              โผ]                          โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                               ุงูููุดุบูู (Trigger)                           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  ููุน ุงูููุดุบูู: ( ) ุฒููู  (โ) ุจุงูุงุณุชุฎุฏุงู  ( ) ูุฒูุฌ                          โ
โ                                                                             โ
โ  โโ ุฅุนุฏุงุฏุงุช ุงูุงุณุชุฎุฏุงู โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  ููุน ุงูุนุฏุงุฏ: [ุณุงุนุงุช ุงูุชุดุบูู              โผ]                          โ  โ
โ  โ  ุงููุชุฑุฉ:     [250        ] ุณุงุนุฉ                                      โ  โ
โ  โ  ูุงูุด ุงูุชุณุงูุญ: [10       ] %                                         โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                              ูุงุฆูุฉ ุงูููุงู                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ #  โ ุงููููุฉ                        โ ุงูููุช   โ ุงูููุงุฏ ุงููุทููุจุฉ     โ   โ
โ  โโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ 1  โ ุชุตุฑูู ุงูุฒูุช ุงููุฏูู            โ 15 ุฏ    โ -                   โ   โ
โ  โ 2  โ ุชุบููุฑ ููุชุฑ ุงูุฒูุช              โ 10 ุฏ    โ ููุชุฑ CAT-1R-0739    โ   โ
โ  โ 3  โ ุฅุถุงูุฉ ุงูุฒูุช ุงูุฌุฏูุฏ            โ 20 ุฏ    โ 20 ูุชุฑ Shell Rimula โ   โ
โ  โ 4  โ ูุญุต ูุณุชูู ุงูุฒูุช               โ 5 ุฏ     โ -                   โ   โ
โ  โ 5  โ ุชุดุบูู ุชุฌุฑูุจู ูุงููุญุต           โ 10 ุฏ    โ -                   โ   โ
โ  โโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  [+ ุฅุถุงูุฉ ูููุฉ]                                                            โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  ุงูุฃููููุฉ: [ูุชูุณุทุฉ    โผ]   ุงูููุช ุงูููุฏุฑ: [60    ] ุฏูููุฉ                   โ
โ  [โ] ูุชุทูุจ ุฅููุงู ุงูุฃุตู                                                     โ
โ                                                                             โ
โ  [๐พ ุญูุธ ุงูุฎุทุฉ]                                              [โ ุฅูุบุงุก]    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 14.11 View ุชูููู ุงูุตูุงูุฉ ุงูููุงุฆูุฉ

```sql
CREATE OR REPLACE VIEW v_pm_calendar AS
SELECT 
    pwo.id AS work_order_id,
    pwo.wo_number,
    pwo.scheduled_date,
    pwo.due_date,
    pwo.status,
    pwo.priority,
    
    -- ุงูุฃุตู
    a.asset_code,
    a.asset_name,
    a.location_description,
    s.station_name,
    
    -- ุงูุฎุทุฉ
    pp.plan_code,
    pp.plan_name,
    pp.trigger_type,
    pp.estimated_duration_hours,
    
    -- ุงูุฅุณูุงุฏ
    e.full_name AS assigned_to_name,
    
    -- ุญุณุงุจ ุงูุชุฃุฎูุฑ
    CASE 
        WHEN pwo.status = 'completed' THEN 0
        WHEN CURRENT_DATE > pwo.due_date THEN CURRENT_DATE - pwo.due_date
        ELSE 0
    END AS days_overdue,
    
    -- ููู ุงูุนุฑุถ
    CASE 
        WHEN pwo.status = 'completed' THEN 'green'
        WHEN CURRENT_DATE > pwo.due_date THEN 'red'
        WHEN CURRENT_DATE > pwo.due_date - 2 THEN 'orange'
        ELSE 'blue'
    END AS display_color

FROM pm_work_orders pwo
JOIN pm_plans pp ON pp.id = pwo.pm_plan_id
JOIN assets a ON a.id = pwo.asset_id
LEFT JOIN stations s ON s.id = a.station_id
LEFT JOIN employees e ON e.id = pwo.assigned_to
WHERE pwo.status NOT IN ('cancelled')
ORDER BY pwo.scheduled_date;
```

## 14.12 APIs ุงูุตูุงูุฉ ุงูููุงุฆูุฉ

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| GET | `/api/v1/pm/plans` | ูุงุฆูุฉ ุฎุทุท ุงูุตูุงูุฉ |
| POST | `/api/v1/pm/plans` | ุฅูุดุงุก ุฎุทุฉ ุฌุฏูุฏุฉ |
| GET | `/api/v1/pm/plans/:id` | ุชูุงุตูู ุฎุทุฉ |
| PUT | `/api/v1/pm/plans/:id` | ุชุญุฏูุซ ุฎุทุฉ |
| DELETE | `/api/v1/pm/plans/:id` | ุญุฐู ุฎุทุฉ |
| GET | `/api/v1/pm/work-orders` | ูุงุฆูุฉ ุฃูุงูุฑ ุงูุนูู |
| GET | `/api/v1/pm/work-orders/:id` | ุชูุงุตูู ุฃูุฑ ุนูู |
| PUT | `/api/v1/pm/work-orders/:id/assign` | ุฅุณูุงุฏ ุฃูุฑ ุนูู |
| PUT | `/api/v1/pm/work-orders/:id/start` | ุจุฏุก ุงูุชูููุฐ |
| PUT | `/api/v1/pm/work-orders/:id/complete` | ุฅููุงู ุฃูุฑ ุงูุนูู |
| POST | `/api/v1/pm/work-orders/:id/materials` | ุชุณุฌูู ููุงุฏ ูุณุชุฎุฏูุฉ |
| GET | `/api/v1/pm/calendar` | ุชูููู ุงูุตูุงูุฉ |
| POST | `/api/v1/pm/generate` | ุชุดุบูู ูุญุฑู ุงูุฌุฏููุฉ ูุฏููุงู |


---

# 15. ูุญุฏุฉ ููุฏุณุฉ ุงูููุซูููุฉ ูุชุชุจุน ุงูููููุงุช (Reliability Engineering)

## 15.1 ูุธุฑุฉ ุนุงูุฉ

> **ุงูุบุฑุถ:** ุชุชุจุน ุฏูุฑุฉ ุญูุงุฉ ุงูููููุงุช ุงููุฑุนูุฉ ุฏุงุฎู ุงูุฃุตููุ ูุญุณุงุจ ุงูุนูุฑ ุงูุชุดุบูููุ ูุชุญููู ุงูููุซูููุฉ ูุงุชุฎุงุฐ ูุฑุงุฑุงุช ูุจููุฉ ุนูู ุงูุจูุงูุงุช.

### ุงููุฒุงูุง ุงูุฑุฆูุณูุฉ

1. **ุชุญููู MTBF:** ูุชูุณุท ุงูุนูุฑ ูุจู ุงููุดู ููู ููุน ูุทุนุฉ
2. **ููุงุฑูุฉ ุงูููุฑุฏูู:** ุฃู ุนูุงูุฉ ุชุฌุงุฑูุฉ ุชุฏูู ุฃุทููุ
3. **ูุฑุงุฑุงุช ุดุฑุงุก ุฃูุถู:** ุจูุงุกู ุนูู ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ ููููููุฉ
4. **ุชุญุฏูุฏ ุงูุญุงูุงุช ุงูุดุงุฐุฉ:** ูุดู ูุจูุฑ ุฃู ุนูุฑ ุทููู ุบูุฑ ุนุงุฏู

## 15.2 ุฌุฏูู ููุงูุน ุงูููููุงุช (component_slots)

```sql
CREATE TABLE component_slots (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- ุงูุฃุตู ุงูุฃุจ
    asset_id UUID NOT NULL REFERENCES assets(id) ON DELETE CASCADE,
    
    -- ูุนูููุงุช ุงููููุน
    slot_code VARCHAR(50) NOT NULL,
    slot_name VARCHAR(200) NOT NULL,
    slot_description TEXT,
    
    -- ููุน ุงููููู ุงููุชููุน
    expected_item_category_id UUID REFERENCES item_categories(id),
    expected_item_model VARCHAR(100),
    
    -- ุฅุนุฏุงุฏุงุช ุงูุชุชุจุน
    track_operating_hours BOOLEAN DEFAULT true,
    track_calendar_days BOOLEAN DEFAULT true,
    
    -- ุงูุนูุฑ ุงููุชููุน
    expected_life_hours DECIMAL(10, 2),
    expected_life_days INT,
    warning_threshold_percent DECIMAL(5, 2) DEFAULT 80,
    
    -- ุงูุญุงูุฉ
    is_active BOOLEAN DEFAULT true,
    
    created_at TIMESTAMP DEFAULT NOW(),
    
    UNIQUE(asset_id, slot_code)
);

CREATE INDEX idx_slots_asset ON component_slots(asset_id);
```

## 15.3 ุฌุฏูู ุงูููููุงุช ุงููุฑูุจุฉ (installed_components)

```sql
CREATE TABLE installed_components (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- ุงููููุน ูุงูุฃุตู
    slot_id UUID NOT NULL REFERENCES component_slots(id),
    asset_id UUID NOT NULL REFERENCES assets(id),
    
    -- ุงููููู
    item_id UUID NOT NULL REFERENCES inventory_items(id),
    serial_number VARCHAR(100),
    batch_number VARCHAR(100),
    
    -- ุชุงุฑูุฎ ุงูุชุฑููุจ
    installed_at TIMESTAMP NOT NULL DEFAULT NOW(),
    installed_by UUID REFERENCES employees(id),
    installation_work_order_id UUID,
    
    -- ูุฑุงุกุงุช ุนูุฏ ุงูุชุฑููุจ
    meter_reading_at_install DECIMAL(12, 2),
    
    -- ุชุงุฑูุฎ ุงูุฅุฒุงูุฉ (NULL = ูุฑูุจ ุญุงููุงู)
    removed_at TIMESTAMP,
    removed_by UUID REFERENCES employees(id),
    removal_work_order_id UUID,
    removal_reason ENUM('replacement', 'failure', 'upgrade', 'decommission') DEFAULT 'replacement',
    
    -- ูุฑุงุกุงุช ุนูุฏ ุงูุฅุฒุงูุฉ
    meter_reading_at_removal DECIMAL(12, 2),
    
    -- ุงูุนูุฑ ุงูุชุดุบููู ุงููุญุณูุจ
    operating_hours DECIMAL(12, 2) GENERATED ALWAYS AS (
        COALESCE(meter_reading_at_removal, 0) - COALESCE(meter_reading_at_install, 0)
    ) STORED,
    calendar_days INT GENERATED ALWAYS AS (
        EXTRACT(DAY FROM (COALESCE(removed_at, NOW()) - installed_at))
    ) STORED,
    
    -- ุงูุญุงูุฉ
    status ENUM('installed', 'removed', 'failed') DEFAULT 'installed',
    
    -- ููุงุญุธุงุช
    notes TEXT,
    failure_description TEXT,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_components_slot ON installed_components(slot_id);
CREATE INDEX idx_components_asset ON installed_components(asset_id);
CREATE INDEX idx_components_serial ON installed_components(serial_number);
CREATE INDEX idx_components_status ON installed_components(status);
CREATE INDEX idx_components_item ON installed_components(item_id);
```

## 15.4 ุฌุฏูู ุณุฌู ุงูุฃุนูุงุฑ ุงูุชุดุบูููุฉ (component_lifecycle_log)

```sql
CREATE TABLE component_lifecycle_log (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- ุงููููู
    installed_component_id UUID NOT NULL REFERENCES installed_components(id),
    item_id UUID NOT NULL REFERENCES inventory_items(id),
    serial_number VARCHAR(100),
    
    -- ุงูุฃุตู
    asset_id UUID NOT NULL REFERENCES assets(id),
    asset_code VARCHAR(50),
    slot_id UUID REFERENCES component_slots(id),
    slot_name VARCHAR(200),
    
    -- ูุชุฑุฉ ุงูุฎุฏูุฉ
    installed_at TIMESTAMP NOT NULL,
    removed_at TIMESTAMP NOT NULL,
    
    -- ุงูุนูุฑ ุงูุชุดุบููู
    operating_hours DECIMAL(12, 2),
    calendar_days INT,
    
    -- ุณุจุจ ุงูุฅุฒุงูุฉ
    removal_reason ENUM('replacement', 'failure', 'upgrade', 'decommission'),
    failure_description TEXT,
    
    -- ูุนูููุงุช ุฅุถุงููุฉ
    supplier_id UUID REFERENCES suppliers(id),
    purchase_cost DECIMAL(12, 2),
    
    -- ููุชุญููู
    is_premature_failure BOOLEAN DEFAULT false,
    is_exceptional_life BOOLEAN DEFAULT false,
    
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_lifecycle_item ON component_lifecycle_log(item_id);
CREATE INDEX idx_lifecycle_asset ON component_lifecycle_log(asset_id);
CREATE INDEX idx_lifecycle_removed ON component_lifecycle_log(removed_at);
```

## 15.5 Function ุงุณุชุจุฏุงู ูููู (Scan Out/In)

```sql
CREATE OR REPLACE FUNCTION replace_component(
    p_slot_id UUID,
    p_old_serial VARCHAR(100),
    p_new_item_id UUID,
    p_new_serial VARCHAR(100),
    p_technician_id UUID,
    p_work_order_id UUID DEFAULT NULL,
    p_removal_reason VARCHAR(20) DEFAULT 'replacement',
    p_failure_description TEXT DEFAULT NULL,
    p_current_meter_reading DECIMAL(12, 2) DEFAULT NULL
) RETURNS JSONB AS $$
DECLARE
    v_slot RECORD;
    v_old_component RECORD;
    v_asset RECORD;
    v_operating_hours DECIMAL(12, 2);
    v_calendar_days INT;
    v_expected_hours DECIMAL(12, 2);
    v_is_premature BOOLEAN := false;
    v_is_exceptional BOOLEAN := false;
BEGIN
    -- ุงูุญุตูู ุนูู ูุนูููุงุช ุงููููุน
    SELECT cs.*, a.id AS asset_id, a.asset_code
    INTO v_slot
    FROM component_slots cs
    JOIN assets a ON a.id = cs.asset_id
    WHERE cs.id = p_slot_id;
    
    IF v_slot IS NULL THEN
        RETURN jsonb_build_object('success', false, 'error', 'ูููุน ุงููููู ุบูุฑ ููุฌูุฏ');
    END IF;
    
    -- ุงูุญุตูู ุนูู ุงููููู ุงููุฏูู
    SELECT * INTO v_old_component
    FROM installed_components
    WHERE slot_id = p_slot_id AND status = 'installed'
    AND (serial_number = p_old_serial OR p_old_serial IS NULL);
    
    IF v_old_component IS NULL THEN
        RETURN jsonb_build_object('success', false, 'error', 'ุงููููู ุงููุฏูู ุบูุฑ ููุฌูุฏ');
    END IF;
    
    -- ุญุณุงุจ ุงูุนูุฑ ุงูุชุดุบููู
    v_operating_hours := COALESCE(p_current_meter_reading, 0) - COALESCE(v_old_component.meter_reading_at_install, 0);
    v_calendar_days := EXTRACT(DAY FROM (NOW() - v_old_component.installed_at));
    
    -- ุงูุชุญูู ูู ุงูุญุงูุงุช ุงูุดุงุฐุฉ
    v_expected_hours := v_slot.expected_life_hours;
    IF v_expected_hours IS NOT NULL THEN
        IF v_operating_hours < (v_expected_hours * 0.5) THEN
            v_is_premature := true;  -- ูุดู ูุจูุฑ (ุฃูู ูู 50% ูู ุงููุชููุน)
        ELSIF v_operating_hours > (v_expected_hours * 1.5) THEN
            v_is_exceptional := true;  -- ุนูุฑ ุงุณุชุซูุงุฆู (ุฃูุซุฑ ูู 150% ูู ุงููุชููุน)
        END IF;
    END IF;
    
    -- ุชุญุฏูุซ ุงููููู ุงููุฏูู (Scan Out)
    UPDATE installed_components SET
        status = CASE WHEN p_removal_reason = 'failure' THEN 'failed' ELSE 'removed' END,
        removed_at = NOW(),
        removed_by = p_technician_id,
        removal_work_order_id = p_work_order_id,
        removal_reason = p_removal_reason,
        meter_reading_at_removal = p_current_meter_reading,
        failure_description = p_failure_description,
        updated_at = NOW()
    WHERE id = v_old_component.id;
    
    -- ุชุณุฌูู ูู ุณุฌู ุงูุฃุนูุงุฑ
    INSERT INTO component_lifecycle_log (
        installed_component_id, item_id, serial_number,
        asset_id, asset_code, slot_id, slot_name,
        installed_at, removed_at, operating_hours, calendar_days,
        removal_reason, failure_description,
        is_premature_failure, is_exceptional_life
    ) VALUES (
        v_old_component.id, v_old_component.item_id, v_old_component.serial_number,
        v_slot.asset_id, v_slot.asset_code, p_slot_id, v_slot.slot_name,
        v_old_component.installed_at, NOW(), v_operating_hours, v_calendar_days,
        p_removal_reason, p_failure_description,
        v_is_premature, v_is_exceptional
    );
    
    -- ุชุฑููุจ ุงููููู ุงูุฌุฏูุฏ (Scan In)
    INSERT INTO installed_components (
        slot_id, asset_id, item_id, serial_number,
        installed_at, installed_by, installation_work_order_id,
        meter_reading_at_install, status
    ) VALUES (
        p_slot_id, v_slot.asset_id, p_new_item_id, p_new_serial,
        NOW(), p_technician_id, p_work_order_id,
        p_current_meter_reading, 'installed'
    );
    
    -- ุฎุตู ูู ุงููุฎุฒูู
    INSERT INTO inventory_transactions (
        item_id, transaction_type, quantity, reference_type, reference_id, notes
    ) VALUES (
        p_new_item_id, 'issue', -1, 'component_replacement', v_old_component.id,
        'ุงุณุชุจุฏุงู ูููู ูู ุงูุฃุตู: ' || v_slot.asset_code
    );
    
    RETURN jsonb_build_object(
        'success', true,
        'old_serial', p_old_serial,
        'new_serial', p_new_serial,
        'operating_hours', v_operating_hours,
        'calendar_days', v_calendar_days,
        'is_premature_failure', v_is_premature,
        'is_exceptional_life', v_is_exceptional
    );
END;
$$ LANGUAGE plpgsql;
```

## 15.6 View ุชุญููู MTBF (ูุชูุณุท ุงูุนูุฑ ูุจู ุงููุดู)

```sql
CREATE OR REPLACE VIEW v_mtbf_analysis AS
SELECT 
    ii.id AS item_id,
    ii.item_code,
    ii.item_name,
    ii.brand,
    ii.model,
    ic.category_name,
    s.supplier_name,
    
    -- ุฅุญุตุงุฆูุงุช ุงูุนููุฉ
    COUNT(cll.id) AS sample_count,
    
    -- ูุชูุณุท ุงูุนูุฑ
    ROUND(AVG(cll.operating_hours), 2) AS avg_operating_hours,
    ROUND(AVG(cll.calendar_days), 0) AS avg_calendar_days,
    
    -- ุงูุงูุญุฑุงู ุงููุนูุงุฑู
    ROUND(STDDEV(cll.operating_hours), 2) AS stddev_hours,
    
    -- ุงูุญุฏ ุงูุฃุฏูู ูุงูุฃูุตู
    MIN(cll.operating_hours) AS min_hours,
    MAX(cll.operating_hours) AS max_hours,
    
    -- ูุณุจุฉ ุงููุดู ุงููุจูุฑ
    ROUND(
        COUNT(*) FILTER (WHERE cll.is_premature_failure) * 100.0 / NULLIF(COUNT(*), 0), 2
    ) AS premature_failure_rate,
    
    -- ูุณุจุฉ ุงูุนูุฑ ุงูุงุณุชุซูุงุฆู
    ROUND(
        COUNT(*) FILTER (WHERE cll.is_exceptional_life) * 100.0 / NULLIF(COUNT(*), 0), 2
    ) AS exceptional_life_rate,
    
    -- ูุชูุณุท ุงูุชูููุฉ
    ROUND(AVG(cll.purchase_cost), 2) AS avg_purchase_cost,
    
    -- ุงูุชูููุฉ ููู ุณุงุนุฉ ุชุดุบูู
    ROUND(
        AVG(cll.purchase_cost) / NULLIF(AVG(cll.operating_hours), 0), 4
    ) AS cost_per_hour

FROM component_lifecycle_log cll
JOIN inventory_items ii ON ii.id = cll.item_id
LEFT JOIN item_categories ic ON ic.id = ii.category_id
LEFT JOIN suppliers s ON s.id = cll.supplier_id
GROUP BY ii.id, ii.item_code, ii.item_name, ii.brand, ii.model, ic.category_name, s.supplier_name
HAVING COUNT(cll.id) >= 3;  -- ุนูู ุงูุฃูู 3 ุนููุงุช ููุชุญููู
```

## 15.7 View ููุงุฑูุฉ ุฃุฏุงุก ุงูููุฑุฏูู

```sql
CREATE OR REPLACE VIEW v_supplier_performance_comparison AS
SELECT 
    ic.category_name AS component_category,
    s.supplier_name,
    ii.brand,
    
    COUNT(cll.id) AS total_components,
    ROUND(AVG(cll.operating_hours), 2) AS avg_life_hours,
    ROUND(AVG(cll.calendar_days), 0) AS avg_life_days,
    
    -- ูุณุจุฉ ุงููุดู ุงููุจูุฑ
    ROUND(
        COUNT(*) FILTER (WHERE cll.is_premature_failure) * 100.0 / NULLIF(COUNT(*), 0), 2
    ) AS failure_rate_percent,
    
    -- ูุชูุณุท ุงูุชูููุฉ ููู ุณุงุนุฉ
    ROUND(
        AVG(cll.purchase_cost) / NULLIF(AVG(cll.operating_hours), 0), 4
    ) AS cost_per_hour,
    
    -- ุงูุชุฑุชูุจ (ุงูุฃูุถู = 1)
    RANK() OVER (
        PARTITION BY ic.category_name 
        ORDER BY AVG(cll.operating_hours) DESC
    ) AS performance_rank

FROM component_lifecycle_log cll
JOIN inventory_items ii ON ii.id = cll.item_id
LEFT JOIN item_categories ic ON ic.id = ii.category_id
LEFT JOIN suppliers s ON s.id = cll.supplier_id
GROUP BY ic.category_name, s.supplier_name, ii.brand
HAVING COUNT(cll.id) >= 3;
```

## 15.8 View ุชุญููู ุฃุฏุงุก ุงูุฃุตูู

```sql
CREATE OR REPLACE VIEW v_asset_component_consumption AS
SELECT 
    a.id AS asset_id,
    a.asset_code,
    a.asset_name,
    a.model AS asset_model,
    s.station_name,
    
    ic.category_name AS component_category,
    
    -- ุนุฏุฏ ุงูุงุณุชุจุฏุงูุงุช
    COUNT(cll.id) AS replacement_count,
    
    -- ูุชูุณุท ุนูุฑ ุงูููููุงุช ูู ูุฐุง ุงูุฃุตู
    ROUND(AVG(cll.operating_hours), 2) AS avg_component_life_hours,
    
    -- ููุงุฑูุฉ ุจุงููุชูุณุท ุงูุนุงู
    ROUND(
        AVG(cll.operating_hours) / NULLIF((
            SELECT AVG(operating_hours) FROM component_lifecycle_log 
            WHERE item_id = cll.item_id
        ), 0) * 100, 2
    ) AS percent_of_average,
    
    -- ุฅุฌูุงูู ุงูุชูููุฉ
    SUM(cll.purchase_cost) AS total_component_cost,
    
    -- ุชุตููู ุงูุฃุฏุงุก
    CASE 
        WHEN AVG(cll.operating_hours) < (
            SELECT AVG(operating_hours) * 0.7 FROM component_lifecycle_log WHERE item_id = cll.item_id
        ) THEN 'poor'
        WHEN AVG(cll.operating_hours) > (
            SELECT AVG(operating_hours) * 1.3 FROM component_lifecycle_log WHERE item_id = cll.item_id
        ) THEN 'excellent'
        ELSE 'normal'
    END AS performance_rating

FROM component_lifecycle_log cll
JOIN assets a ON a.id = cll.asset_id
LEFT JOIN stations s ON s.id = a.station_id
LEFT JOIN inventory_items ii ON ii.id = cll.item_id
LEFT JOIN item_categories ic ON ic.id = ii.category_id
GROUP BY a.id, a.asset_code, a.asset_name, a.model, s.station_name, ic.category_name, cll.item_id;
```

## 15.9 View ุงูุญุงูุงุช ุงูุดุงุฐุฉ

```sql
CREATE OR REPLACE VIEW v_anomaly_cases AS
SELECT 
    cll.id,
    cll.serial_number,
    ii.item_name,
    ii.brand,
    a.asset_code,
    a.asset_name,
    cll.slot_name,
    
    cll.installed_at,
    cll.removed_at,
    cll.operating_hours,
    cll.calendar_days,
    cll.removal_reason,
    cll.failure_description,
    
    -- ููุน ุงูุญุงูุฉ ุงูุดุงุฐุฉ
    CASE 
        WHEN cll.is_premature_failure THEN 'ูุดู ูุจูุฑ'
        WHEN cll.is_exceptional_life THEN 'ุนูุฑ ุงุณุชุซูุงุฆู'
    END AS anomaly_type,
    
    -- ุงููุชูุณุท ุงููุชููุน
    (SELECT ROUND(AVG(operating_hours), 2) FROM component_lifecycle_log WHERE item_id = cll.item_id) AS expected_avg_hours,
    
    -- ูุณุจุฉ ุงูุงูุญุฑุงู
    ROUND(
        (cll.operating_hours - (SELECT AVG(operating_hours) FROM component_lifecycle_log WHERE item_id = cll.item_id)) 
        / NULLIF((SELECT AVG(operating_hours) FROM component_lifecycle_log WHERE item_id = cll.item_id), 0) * 100, 2
    ) AS deviation_percent

FROM component_lifecycle_log cll
JOIN inventory_items ii ON ii.id = cll.item_id
JOIN assets a ON a.id = cll.asset_id
WHERE cll.is_premature_failure = true OR cll.is_exceptional_life = true
ORDER BY cll.removed_at DESC;
```

## 15.10 ุดุงุดุฉ ุดุฌุฑุฉ ููููุงุช ุงูุฃุตู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ๐ง ุดุฌุฑุฉ ููููุงุช ุงูุฃุตู - ูููุฏ G1                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  ุงูุฃุตู: ูููุฏ ูุงุชุฑุจููุฑ C15 | ุงูููุฏ: G1 | ุงููุญุทุฉ: ุงููุญุทุฉ ุงูุฑุฆูุณูุฉ            โ
โ  ุณุงุนุงุช ุงูุชุดุบูู ุงูุญุงููุฉ: 2,450 ุณุงุนุฉ                                         โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                              ุงูููููุงุช ุงููุฑูุจุฉ                              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโ โ
โ  โ ุงููููุน          โ ุงููููู ุงููุฑูุจ      โ ุชุงุฑูุฎ ุงูุชุฑููุจโ ุงูุนูุฑ ุงูุญุงูู   โ โ
โ  โโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโค โ
โ  โ ๐ ููุชุฑ ุงูุฒูุช   โ CAT-1R-0739        โ 2024-10-15   โ 245 ุณุงุนุฉ โ    โ โ
โ  โ                  โ SN: FO-2024-1234   โ              โ (98% ูู ุงููุชููุน)โ โ
โ  โโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโค โ
โ  โ ๐ ููุชุฑ ุงูููุงุก  โ CAT-AIR-001        โ 2024-09-01   โ 520 ุณุงุนุฉ โ๏ธ    โ โ
โ  โ                  โ SN: FA-2024-5678   โ              โ (104% ุชุฌุงูุฒ!)  โ โ
โ  โโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโค โ
โ  โ ๐ ูุถุฎุฉ ุงููููุฏ  โ Bosch-FP-200       โ 2024-01-15   โ 1,890 ุณุงุนุฉ โ  โ โ
โ  โ                  โ SN: BP-2024-9999   โ              โ (63% ูู ุงููุชููุน)โ โ
โ  โโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโค โ
โ  โ ๐ ุจุทุงุฑูุฉ       โ Exide-200AH        โ 2024-06-01   โ 1,200 ุณุงุนุฉ โ  โ โ
โ  โ                  โ SN: BT-2024-1111   โ              โ (40% ูู ุงููุชููุน)โ โ
โ  โโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโ โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                              ุณุฌู ุงูุงุณุชุจุฏุงูุงุช                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ โ
โ  โ ุงูุชุงุฑูุฎ   โ ุงููููุน       โ ุงููููู ุงููุฏููโ ุงูุนูุฑ      โ ุงูุณุจุจ        โ โ
โ  โโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโค โ
โ  โ 2024-10-15โ ููุชุฑ ุงูุฒูุช   โ SN: FO-1234  โ 248 ุณุงุนุฉ  โ ุงุณุชุจุฏุงู ุฏูุฑู โ โ
โ  โ 2024-09-01โ ููุชุฑ ุงูููุงุก  โ SN: FA-9876  โ 510 ุณุงุนุฉ  โ ุงุณุชุจุฏุงู ุฏูุฑู โ โ
โ  โ 2024-07-20โ ููุชุฑ ุงูุฒูุช   โ SN: FO-0001  โ 252 ุณุงุนุฉ  โ ุงุณุชุจุฏุงู ุฏูุฑู โ โ
โ  โโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโ โ
โ                                                                             โ
โ  [๐ ุงุณุชุจุฏุงู ูููู]  [๐ ุชูุฑูุฑ MTBF]  [๐ ุณุฌู ูุงูู]                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 15.11 APIs ููุฏุณุฉ ุงูููุซูููุฉ

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| GET | `/api/v1/reliability/assets/:id/components` | ุดุฌุฑุฉ ููููุงุช ุงูุฃุตู |
| POST | `/api/v1/reliability/components/replace` | ุงุณุชุจุฏุงู ูููู (Scan In/Out) |
| GET | `/api/v1/reliability/mtbf` | ุชูุฑูุฑ MTBF |
| GET | `/api/v1/reliability/suppliers` | ููุงุฑูุฉ ุงูููุฑุฏูู |
| GET | `/api/v1/reliability/assets/consumption` | ุชุญููู ุงุณุชููุงู ุงูุฃุตูู |
| GET | `/api/v1/reliability/anomalies` | ุงูุญุงูุงุช ุงูุดุงุฐุฉ |
| GET | `/api/v1/reliability/components/:serial/history` | ุชุงุฑูุฎ ูููู ูุญุฏุฏ |


---

# 21. ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ ููููููุฉ (Total Cost of Ownership - TCO)

## 21.1 ูุธุฑุฉ ุนุงูุฉ

> **ุงูุบุฑุถ:** ุญุณุงุจ ุงูุชูููุฉ ุงูุญููููุฉ ููู ูุทุนุฉ ุบูุงุฑ ุชุดูู ุณุนุฑ ุงูุดุฑุงุก + ุชูุงููู ุงูุฅุตูุงุญ + ุชูุงููู ุงูุตูุงูุฉ.

## 21.2 View ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ ููููููุฉ

```sql
CREATE VIEW v_component_tco AS
SELECT 
    isn.id AS serial_number_id,
    isn.serial_number,
    ii.item_name,
    ii.item_category,
    s.supplier_name,
    
    -- ุชูููุฉ ุงูุดุฑุงุก
    isn.purchase_cost,
    isn.purchase_date,
    
    -- ุชูุงููู ุงูุฅุตูุงุญ
    COALESCE((
        SELECT SUM(total_cost) 
        FROM repair_work_orders rwo
        WHERE rwo.input_items @> jsonb_build_array(jsonb_build_object('serial_number_id', isn.id::TEXT))
        AND rwo.status = 'completed'
    ), 0) AS total_repair_cost,
    
    -- ุนุฏุฏ ูุฑุงุช ุงูุฅุตูุงุญ
    COALESCE((
        SELECT COUNT(*) 
        FROM repair_work_orders rwo
        WHERE rwo.input_items @> jsonb_build_array(jsonb_build_object('serial_number_id', isn.id::TEXT))
        AND rwo.status = 'completed'
    ), 0) AS repair_count,
    
    -- ุชูุงููู ุงูุตูุงูุฉ ุงููุฑุชุจุทุฉ
    COALESCE((
        SELECT SUM(woc.total_cost)
        FROM work_order_costs woc
        JOIN work_orders wo ON wo.id = woc.work_order_id
        JOIN component_replacement_requests crr ON crr.work_order_id = wo.id
        WHERE crr.new_serial_number_id = isn.id
    ), 0) AS maintenance_cost,
    
    -- ุงูุนูุฑ ุงูุชุดุบููู (ุณุงุนุงุช)
    COALESCE((
        SELECT SUM(operating_hours)
        FROM component_lifecycle_log
        WHERE serial_number_id = isn.id
    ), 0) AS total_operating_hours,
    
    -- ุงูุนูุฑ ุงูุชุดุบููู (ุฃูุงู)
    COALESCE((
        SELECT SUM(operating_days)
        FROM component_lifecycle_log
        WHERE serial_number_id = isn.id
    ), 0) AS total_operating_days,
    
    -- ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ ููููููุฉ
    (
        COALESCE(isn.purchase_cost, 0) +
        COALESCE((
            SELECT SUM(total_cost) 
            FROM repair_work_orders rwo
            WHERE rwo.input_items @> jsonb_build_array(jsonb_build_object('serial_number_id', isn.id::TEXT))
        ), 0) +
        COALESCE((
            SELECT SUM(woc.total_cost)
            FROM work_order_costs woc
            JOIN work_orders wo ON wo.id = woc.work_order_id
            JOIN component_replacement_requests crr ON crr.work_order_id = wo.id
            WHERE crr.new_serial_number_id = isn.id
        ), 0)
    ) AS total_cost_of_ownership,
    
    -- ุงูุชูููุฉ ููู ุณุงุนุฉ ุชุดุบูู
    CASE 
        WHEN COALESCE((SELECT SUM(operating_hours) FROM component_lifecycle_log WHERE serial_number_id = isn.id), 0) > 0
        THEN (
            COALESCE(isn.purchase_cost, 0) +
            COALESCE((SELECT SUM(total_cost) FROM repair_work_orders rwo WHERE rwo.input_items @> jsonb_build_array(jsonb_build_object('serial_number_id', isn.id::TEXT))), 0)
        ) / (SELECT SUM(operating_hours) FROM component_lifecycle_log WHERE serial_number_id = isn.id)
        ELSE NULL
    END AS cost_per_operating_hour,
    
    -- ุงูุญุงูุฉ ุงูุญุงููุฉ
    isn.status,
    isn.condition
    
FROM item_serial_numbers isn
JOIN inventory_items ii ON ii.id = isn.item_id
LEFT JOIN suppliers s ON s.id = ii.preferred_supplier_id;
```

## 21.3 View ููุงุฑูุฉ TCO ุจูู ุงูููุฑุฏูู

```sql
CREATE VIEW v_supplier_tco_comparison AS
SELECT 
    ii.item_name,
    ii.item_category,
    s.supplier_name,
    
    -- ุนุฏุฏ ุงููุทุน
    COUNT(isn.id) AS total_units,
    
    -- ูุชูุณุท ุณุนุฑ ุงูุดุฑุงุก
    AVG(isn.purchase_cost) AS avg_purchase_cost,
    
    -- ูุชูุณุท ุชูููุฉ ุงูุฅุตูุงุญ
    AVG(COALESCE((
        SELECT SUM(total_cost) 
        FROM repair_work_orders rwo
        WHERE rwo.input_items @> jsonb_build_array(jsonb_build_object('serial_number_id', isn.id::TEXT))
    ), 0)) AS avg_repair_cost,
    
    -- ูุชูุณุท ุงูุนูุฑ ุงูุชุดุบููู (ุณุงุนุงุช)
    AVG(COALESCE((
        SELECT SUM(operating_hours)
        FROM component_lifecycle_log
        WHERE serial_number_id = isn.id
    ), 0)) AS avg_operating_hours,
    
    -- ูุชูุณุท TCO
    AVG(
        COALESCE(isn.purchase_cost, 0) +
        COALESCE((
            SELECT SUM(total_cost) 
            FROM repair_work_orders rwo
            WHERE rwo.input_items @> jsonb_build_array(jsonb_build_object('serial_number_id', isn.id::TEXT))
        ), 0)
    ) AS avg_tco,
    
    -- ูุชูุณุท ุงูุชูููุฉ ููู ุณุงุนุฉ
    AVG(
        CASE 
            WHEN COALESCE((SELECT SUM(operating_hours) FROM component_lifecycle_log WHERE serial_number_id = isn.id), 0) > 0
            THEN (
                COALESCE(isn.purchase_cost, 0) +
                COALESCE((SELECT SUM(total_cost) FROM repair_work_orders rwo WHERE rwo.input_items @> jsonb_build_array(jsonb_build_object('serial_number_id', isn.id::TEXT))), 0)
            ) / (SELECT SUM(operating_hours) FROM component_lifecycle_log WHERE serial_number_id = isn.id)
            ELSE NULL
        END
    ) AS avg_cost_per_hour,
    
    -- ุงูุชูููู
    CASE 
        WHEN AVG(COALESCE((SELECT SUM(operating_hours) FROM component_lifecycle_log WHERE serial_number_id = isn.id), 0)) > 
             (SELECT AVG(oh) FROM (SELECT SUM(operating_hours) AS oh FROM component_lifecycle_log GROUP BY serial_number_id) sub)
        THEN 'ููุชุงุฒ'
        WHEN AVG(COALESCE((SELECT SUM(operating_hours) FROM component_lifecycle_log WHERE serial_number_id = isn.id), 0)) > 
             (SELECT AVG(oh) * 0.8 FROM (SELECT SUM(operating_hours) AS oh FROM component_lifecycle_log GROUP BY serial_number_id) sub)
        THEN 'ุฌูุฏ'
        ELSE 'ูุญุชุงุฌ ูุฑุงุฌุนุฉ'
    END AS supplier_rating

FROM item_serial_numbers isn
JOIN inventory_items ii ON ii.id = isn.item_id
LEFT JOIN suppliers s ON s.id = ii.preferred_supplier_id
WHERE isn.status IN ('in_use', 'consumed', 'scrapped')
GROUP BY ii.item_name, ii.item_category, s.supplier_name;
```

## 21.4 ุดุงุดุฉ ุชุญููู TCO

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ๐ ุชุญููู ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ ููููููุฉ (TCO)                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  ุงูุตูู: [ููุชุฑ ุฒูุช โผ]                    ุงููุชุฑุฉ: [ุขุฎุฑ ุณูุฉ โผ]                โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                          ููุงุฑูุฉ ุงูููุฑุฏูู                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงูููุฑุฏ      โ ุณุนุฑ ุงูุดุฑุงุก โ ุชูููุฉ ุงูุฅุตูุงุญ โ ุงูุนูุฑ (ุณุงุนุฉ) โ TCO/ุณุงุนุฉ โ   โ
โ  โโโโโโโโโโโโโโโผโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโค   โ
โ  โ CAT ุงูุฃุตูู  โ 150 ุฑ.ุณ   โ 20 ุฑ.ุณ       โ 500          โ 0.34 ุฑ.ุณโ โญโ
โ  โ Fleetguard  โ 120 ุฑ.ุณ   โ 45 ุฑ.ุณ       โ 350          โ 0.47 ุฑ.ุณโ   โ
โ  โ ูุญูู        โ 80 ุฑ.ุณ    โ 60 ุฑ.ุณ       โ 200          โ 0.70 ุฑ.ุณโ โ๏ธโ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  ๐ก ุงูุชูุตูุฉ: CAT ุงูุฃุตูู ุฃุฑุฎุต ุนูู ุงููุฏู ุงูุทููู ุฑุบู ุงุฑุชูุงุน ุณุนุฑ ุงูุดุฑุงุก        โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                          ุชูุงุตูู ุงูุชูุงููู                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  ๐ [ุฑุณู ุจูุงูู: TCO ููุงุฑูุฉ ุจูู ุงูููุฑุฏูู ุนูู ูุฏุงุฑ ุงูุณูุฉ]                    โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                                                                     โ   โ
โ  โ   CAT โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ 170 ุฑ.ุณ   โ   โ
โ  โ   Fleetguard โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ 165 ุฑ.ุณ   โ   โ
โ  โ   ูุญูู โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ 140 ุฑ.ุณ   โ   โ
โ  โ                                                                     โ   โ
โ  โ   โ ุณุนุฑ ุงูุดุฑุงุก    โ ุชูููุฉ ุงูุฅุตูุงุญ    โ ุชูููุฉ ุงูุตูุงูุฉ              โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  [๐ฅ ุชุตุฏูุฑ ุงูุชูุฑูุฑ]                              [๐ ุชุญุฏูุซ ุงูุจูุงูุงุช]       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 21.5 APIs ุชุญููู TCO

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| GET | `/api/v1/analytics/tco` | ุชุญููู TCO ูุฌููุน ุงูุฃุตูุงู |
| GET | `/api/v1/analytics/tco/item/:itemId` | ุชุญููู TCO ูุตูู ูุนูู |
| GET | `/api/v1/analytics/tco/supplier-comparison` | ููุงุฑูุฉ TCO ุจูู ุงูููุฑุฏูู |
| GET | `/api/v1/analytics/tco/recommendations` | ุชูุตูุงุช ุงูุดุฑุงุก ุจูุงุกู ุนูู TCO |



---

# ๐ ุชุฑุญูู ุงูุฃุตูู ุงูุชุงุฑูุฎูุฉ

> **ุงูุบุฑุถ:** ุชุฑุญูู ุจูุงูุงุช ุงูุฃุตูู ุงูููุฌูุฏุฉ ููุฐ ุจุฏุงูุฉ 2024 ุฅูู ุงููุธุงู ุงูุฌุฏูุฏ

---

## 1. ุฌุฏูู ุงูุฃุตูู ุงูุงูุชุชุงุญูุฉ (asset_opening_records)

```sql
CREATE TABLE asset_opening_records (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    migration_project_id UUID REFERENCES migration_projects(id),
    
    asset_code VARCHAR(50),
    asset_name VARCHAR(200),
    asset_type VARCHAR(100),
    serial_number VARCHAR(100),
    
    location VARCHAR(200),
    station_id UUID REFERENCES stations(id),
    
    purchase_date DATE,
    purchase_cost DECIMAL(18,2),
    current_book_value DECIMAL(18,2),
    accumulated_depreciation DECIMAL(18,2),
    useful_life_years INTEGER,
    
    condition VARCHAR(50),
    operational_status VARCHAR(50),
    
    is_verified BOOLEAN DEFAULT FALSE,
    verified_by UUID REFERENCES users(id),
    verified_at TIMESTAMP,
    verification_method VARCHAR(50),
    verification_photos JSONB,
    
    new_asset_id UUID,
    status VARCHAR(50) DEFAULT 'pending',
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

## 2. Function ุชุฑุญูู ุงูุฃุตูู

```sql
CREATE OR REPLACE FUNCTION migrate_assets(p_project_id UUID, p_opening_date DATE)
RETURNS TABLE (success BOOLEAN, assets_migrated INTEGER, total_book_value DECIMAL, message TEXT) AS $$
DECLARE
    v_count INTEGER := 0;
    v_total DECIMAL := 0;
BEGIN
    SELECT COUNT(*), COALESCE(SUM(current_book_value), 0) INTO v_count, v_total
    FROM asset_opening_records WHERE migration_project_id = p_project_id AND status = 'verified';
    
    IF v_count = 0 THEN
        RETURN QUERY SELECT FALSE, 0, 0::DECIMAL, 'ูุง ุชูุฌุฏ ุฃุตูู ูุนุชูุฏุฉ ููุชุฑุญูู';
        RETURN;
    END IF;
    
    -- ุฅูุดุงุก ุงูุฃุตูู ูู ุงููุธุงู ุงูุฌุฏูุฏ
    INSERT INTO assets (code, name, asset_type, serial_number, location, station_id, purchase_date, purchase_cost, current_book_value, accumulated_depreciation, useful_life_years, condition, operational_status, is_migrated, migration_date)
    SELECT asset_code, asset_name, asset_type, serial_number, location, station_id, purchase_date, purchase_cost, current_book_value, accumulated_depreciation, useful_life_years, condition, operational_status, TRUE, p_opening_date
    FROM asset_opening_records WHERE migration_project_id = p_project_id AND status = 'verified';
    
    UPDATE asset_opening_records SET status = 'migrated' WHERE migration_project_id = p_project_id AND status = 'verified';
    
    RETURN QUERY SELECT TRUE, v_count, v_total, 'ุชู ุชุฑุญูู ' || v_count || ' ุฃุตู';
END;
$$ LANGUAGE plpgsql;
```

## 3. APIs ุชุฑุญูู ุงูุฃุตูู

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| POST | `/api/v1/migration/assets/import` | ุงุณุชูุฑุงุฏ ุงูุฃุตูู ูู Excel |
| GET | `/api/v1/migration/assets` | ูุงุฆูุฉ ุงูุฃุตูู ููุชุฑุญูู |
| PUT | `/api/v1/migration/assets/:id/verify` | ุงุนุชูุงุฏ ุฃุตู |
| POST | `/api/v1/migration/assets/:id/photos` | ุฑูุน ุตูุฑ ุงูุชุญูู |
| POST | `/api/v1/migration/assets/migrate` | ุชูููุฐ ุงูุชุฑุญูู |
| GET | `/api/v1/migration/assets/summary` | ููุฎุต ุงูุชุฑุญูู |


---

# ๐ ุงูุชูุงูู ูุน ูุธุงู ุงููุทูุฑ (02)

## ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงูุฃุตูู ูุงูุตูุงูุฉ ูุชูุงูู ูุน ูุธุงู ุงููุทูุฑ ุนุจุฑ:
1. **APIs ุงูุฏุงุฎููุฉ** - ููุชูุงุตู ูุน ุงูุฃูุธูุฉ ุงูุฃุฎุฑู
2. **ูุธุงู ุงูุฃุญุฏุงุซ** - ููุดุฑ ุฃุญุฏุงุซ ุงูุฃุตูู ูุงูุตูุงูุฉ
3. **ุชูุงูู IoT** - ูุงุณุชูุจุงู ุจูุงูุงุช ุฃุฌูุฒุฉ Acrel
4. **ุงูุชูุงูู ุงููุงูู** - ููุฅููุงู ูุงูุฑุณููุฉ

---

## ๐ก APIs ุงููุณุฌูุฉ ูู ูุธุงู ุงููุทูุฑ

ุฌููุน APIs ูุธุงู ุงูุฃุตูู ูุงูุตูุงูุฉ ูุชุงุญุฉ ุนุจุฑ `/api/assets/*` ู `/api/maintenance/*`:

| ุงููุฌููุนุฉ | Endpoint | ุงููุตู |
|----------|----------|-------|
| ุงูุฃุตูู | `/api/assets` | ุฅุฏุงุฑุฉ ุงูุฃุตูู |
| ุงูุตูุงูุฉ | `/api/maintenance` | ุฅุฏุงุฑุฉ ุงูุตูุงูุฉ |
| ุงููุฑุงุกุงุช | `/api/assets/readings` | ูุฑุงุกุงุช ุงูุฃุตูู |
| ุงูุฅููุงู | `/api/assets/depreciation` | ุญุณุงุจ ุงูุฅููุงู |

---

## ๐ฏ ุงูุฃุญุฏุงุซ ุงูููุดูุฑุฉ

```
asset.created               - ุฅูุดุงุก ุฃุตู ุฌุฏูุฏ
asset.updated               - ุชุญุฏูุซ ุจูุงูุงุช ุฃุตู
asset.installed             - ุชุฑููุจ ุฃุตู
asset.decommissioned        - ุฅููุงู ุฃุตู
asset.fault_detected        - ุงูุชุดุงู ุนุทู

maintenance.scheduled       - ุฌุฏููุฉ ุตูุงูุฉ
maintenance.started         - ุจุฏุก ุตูุงูุฉ
maintenance.completed       - ุฅููุงู ุตูุงูุฉ
maintenance.due             - ุตูุงูุฉ ูุณุชุญูุฉ

reading.received            - ุงุณุชูุจุงู ูุฑุงุกุฉ
reading.anomaly_detected    - ุงูุชุดุงู ูุฑุงุกุฉ ุดุงุฐุฉ
```

---

## ๐ฅ ุงูุฃุญุฏุงุซ ุงููุณุชูุจูุฉ

| ุงูุญุฏุซ | ุงููุตุฏุฑ | ุงูุฅุฌุฑุงุก |
|-------|--------|---------|
| `invoice.paid` | ุงูุนููุงุก ูุงูููุชุฑุฉ | ุชุญุฏูุซ ุญุงูุฉ ุงูุฃุตู |
| `work_order.completed` | ุงูุนูููุงุช ุงูููุฏุงููุฉ | ุฅุบูุงู ุฃูุฑ ุงูุตูุงูุฉ |
| `project.completed` | ุงูุชุฎุทูุท ูุงููุดุงุฑูุน | ุฑุณููุฉ ุงูุฃุตูู |
| `scada.alert` | ุงููุฑุงูุจุฉ ูุงูุชุญูู | ุฅูุดุงุก ุฃูุฑ ุตูุงูุฉ ุทุงุฑุฆ |

---

## ๐ง ุชูุงูู ุฃุฌูุฒุฉ Acrel IoT

### Webhook ูุงุณุชูุจุงู ุจูุงูุงุช IoT

```
POST /api/assets/iot/readings
```

### ูููู ุงูุจูุงูุงุช ุงููุงุฑุฏุฉ

```json
{
  "device_id": "ACREL-001",
  "device_type": "energy_meter",
  "readings": [
    {
      "parameter": "active_power",
      "value": 150.5,
      "unit": "kW",
      "timestamp": "2024-12-15T10:00:00Z"
    },
    {
      "parameter": "voltage",
      "value": 220.5,
      "unit": "V",
      "timestamp": "2024-12-15T10:00:00Z"
    }
  ]
}
```

### ูุนุงูุฌุฉ ุงููุฑุงุกุงุช

```sql
-- ุฏุงูุฉ ูุนุงูุฌุฉ ูุฑุงุกุงุช IoT
CREATE OR REPLACE FUNCTION process_iot_reading(
    p_device_id VARCHAR(50),
    p_readings JSONB
)
RETURNS VOID AS $$
DECLARE
    v_asset_id UUID;
    v_reading JSONB;
BEGIN
    -- ุงูุจุญุซ ุนู ุงูุฃุตู
    SELECT id INTO v_asset_id
    FROM assets
    WHERE iot_device_id = p_device_id;
    
    -- ูุนุงูุฌุฉ ูู ูุฑุงุกุฉ
    FOR v_reading IN SELECT * FROM jsonb_array_elements(p_readings)
    LOOP
        INSERT INTO asset_readings (
            asset_id, parameter, value, unit, reading_time
        ) VALUES (
            v_asset_id,
            v_reading->>'parameter',
            (v_reading->>'value')::DECIMAL,
            v_reading->>'unit',
            (v_reading->>'timestamp')::TIMESTAMP
        );
        
        -- ูุญุต ุงูููู ุงูุดุงุฐุฉ
        PERFORM check_reading_anomaly(v_asset_id, v_reading);
    END LOOP;
END;
$$ LANGUAGE plpgsql;
```

---

## ๐ฐ ุงูุชูุงูู ุงููุงูู

### ุญุณุงุจ ุงูุฅููุงู ุงูุชููุงุฆู

```
POST /api/assets/depreciation/calculate
{
  "period": "2024-12",
  "asset_category": "all"
}
```

### ูููุฏ ุงูุฅููุงู

```sql
-- Trigger ูุฅูุดุงุก ูููุฏ ุงูุฅููุงู
CREATE OR REPLACE FUNCTION create_depreciation_journal()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO journal_entries (
        tenant_id, entry_date, reference_type, reference_id,
        description, status
    ) VALUES (
        NEW.tenant_id, NEW.depreciation_date, 'depreciation', NEW.id,
        'ุฅููุงู ุงูุฃุตูู - ' || to_char(NEW.depreciation_date, 'YYYY-MM'),
        'draft'
    );
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

---

## ๐ ููุงููุณ ุงูุฃุฏุงุก ุงููุฑุณูุฉ ููุธุงู ุงููุทูุฑ

```sql
INSERT INTO performance_metrics (metric_name, metric_type, metric_value, labels)
VALUES
  ('assets.total_count', 'gauge', 500, '{}'),
  ('assets.active_count', 'gauge', 480, '{}'),
  ('maintenance.pending_count', 'gauge', 25, '{}'),
  ('maintenance.overdue_count', 'gauge', 5, '{}'),
  ('iot.readings_per_minute', 'gauge', 150, '{}');
```

---

## ๐ค ุชูุงูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู

### ุงูุชูุจุค ุจุงูุฃุนุทุงู

```
POST /api/ai/predict/asset-failure
{
  "asset_id": "uuid",
  "prediction_horizon_days": 30
}
```

### ุชุญุณูู ุฌุฏุงูู ุงูุตูุงูุฉ

```
POST /api/ai/optimize/maintenance-schedule
{
  "asset_category": "generators",
  "optimization_goal": "minimize_downtime"
}
```


---

# ๐ก APIs ุงูุชูุตูููุฉ ุงูุฅุถุงููุฉ

## APIs ุฅุฏุงุฑุฉ ุงูุฃุตูู ุงููุชูุฏูุฉ

```
# === ุงูุฃุตูู ===
GET    /api/assets/                          - ูุงุฆูุฉ ุงูุฃุตูู ูุน ุงูููุงุชุฑ
GET    /api/assets/:id                       - ุชูุงุตูู ุฃุตู ูุงููุฉ
POST   /api/assets/                          - ุฅูุดุงุก ุฃุตู ุฌุฏูุฏ
PUT    /api/assets/:id                       - ุชุนุฏูู ุฃุตู
DELETE /api/assets/:id                       - ุญุฐู ุฃุตู (soft delete)
GET    /api/assets/:id/history               - ุชุงุฑูุฎ ุงูุฃุตู ุงููุงูู
GET    /api/assets/:id/components            - ููููุงุช ุงูุฃุตู
POST   /api/assets/:id/components            - ุฅุถุงูุฉ ูููู
GET    /api/assets/:id/documents             - ูุณุชูุฏุงุช ุงูุฃุตู
POST   /api/assets/:id/documents             - ุฑูุน ูุณุชูุฏ
GET    /api/assets/:id/photos                - ุตูุฑ ุงูุฃุตู
POST   /api/assets/:id/photos                - ุฑูุน ุตูุฑุฉ
GET    /api/assets/by-category/:category_id  - ุฃุตูู ุงููุฆุฉ
GET    /api/assets/by-station/:station_id    - ุฃุตูู ุงููุญุทุฉ
GET    /api/assets/by-project/:project_id    - ุฃุตูู ุงููุดุฑูุน
GET    /api/assets/expiring                  - ุฃุตูู ุชูุชูู ุตูุงุญูุชูุง
GET    /api/assets/warranty-expiring         - ุฃุตูู ููุชูู ุถูุงููุง
GET    /api/assets/search                    - ุจุญุซ ูุชูุฏู

# === ุงูุฅููุงู ===
GET    /api/assets/:id/depreciation          - ุฌุฏูู ุฅููุงู ุงูุฃุตู
GET    /api/assets/:id/depreciation/schedule - ุฌุฏูู ุงูุฅููุงู ุงููุณุชูุจูู
POST   /api/depreciation/run                 - ุชุดุบูู ุงูุฅููุงู ุงูุดูุฑู
POST   /api/depreciation/run/:asset_id       - ุฅููุงู ุฃุตู ูุญุฏุฏ
GET    /api/depreciation/report              - ุชูุฑูุฑ ุงูุฅููุงู
GET    /api/depreciation/forecast            - ุชููุนุงุช ุงูุฅููุงู

# === ุงูุงุณุชุจุนุงุฏ ูุงูุชุญููู ===
POST   /api/assets/:id/dispose               - ุงุณุชุจุนุงุฏ ุฃุตู
POST   /api/assets/:id/transfer              - ุชุญููู ุฃุตู ููููุน ุขุฎุฑ
POST   /api/assets/:id/revalue               - ุฅุนุงุฏุฉ ุชูููู ุงูุฃุตู
GET    /api/assets/:id/book-value            - ุงููููุฉ ุงูุฏูุชุฑูุฉ ุงูุญุงููุฉ
```

## APIs ุงูุตูุงูุฉ ุงูููุงุฆูุฉ

```
# === ุฎุทุท ุงูุตูุงูุฉ ===
GET    /api/pm/plans                         - ูุงุฆูุฉ ุฎุทุท ุงูุตูุงูุฉ
GET    /api/pm/plans/:id                     - ุชูุงุตูู ุฎุทุฉ
POST   /api/pm/plans                         - ุฅูุดุงุก ุฎุทุฉ ุตูุงูุฉ
PUT    /api/pm/plans/:id                     - ุชุนุฏูู ุฎุทุฉ
DELETE /api/pm/plans/:id                     - ุญุฐู ุฎุทุฉ
POST   /api/pm/plans/:id/activate            - ุชูุนูู ุฎุทุฉ
POST   /api/pm/plans/:id/deactivate          - ุฅููุงู ุฎุทุฉ
GET    /api/pm/plans/:id/tasks               - ููุงู ุงูุฎุทุฉ
POST   /api/pm/plans/:id/tasks               - ุฅุถุงูุฉ ูููุฉ
GET    /api/pm/plans/:id/schedule            - ุฌุฏูู ุงูุชูููุฐ

# === ุฃูุงูุฑ ุนูู ุงูุตูุงูุฉ ุงูููุงุฆูุฉ ===
GET    /api/pm/work-orders                   - ุฃูุงูุฑ ุนูู PM
GET    /api/pm/work-orders/:id               - ุชูุงุตูู ุฃูุฑ ุนูู
POST   /api/pm/work-orders                   - ุฅูุดุงุก ุฃูุฑ ุนูู ูุฏูู
PUT    /api/pm/work-orders/:id               - ุชุนุฏูู ุฃูุฑ ุนูู
POST   /api/pm/work-orders/:id/start         - ุจุฏุก ุงูุชูููุฐ
POST   /api/pm/work-orders/:id/complete      - ุฅููุงู ุฃูุฑ ุงูุนูู
POST   /api/pm/work-orders/:id/cancel        - ุฅูุบุงุก ุฃูุฑ ุงูุนูู
GET    /api/pm/work-orders/:id/tasks         - ููุงู ุฃูุฑ ุงูุนูู
PUT    /api/pm/work-orders/:id/tasks/:task_id - ุชุญุฏูุซ ูููุฉ
POST   /api/pm/work-orders/:id/materials     - ุชุณุฌูู ููุงุฏ ูุณุชุฎุฏูุฉ

# === ุชูููู ุงูุตูุงูุฉ ===
GET    /api/pm/calendar                      - ุชูููู ุงูุตูุงูุฉ
GET    /api/pm/calendar/week                 - ุฌุฏูู ุงูุฃุณุจูุน
GET    /api/pm/calendar/month                - ุฌุฏูู ุงูุดูุฑ
GET    /api/pm/upcoming                      - ุงูุตูุงูุฉ ุงููุงุฏูุฉ
GET    /api/pm/overdue                       - ุงูุตูุงูุฉ ุงููุชุฃุฎุฑุฉ
```

## APIs ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ

```
# === ุทูุจุงุช ุงูุตูุงูุฉ ===
GET    /api/cm/requests                      - ุทูุจุงุช ุงูุตูุงูุฉ
GET    /api/cm/requests/:id                  - ุชูุงุตูู ุทูุจ
POST   /api/cm/requests                      - ุฅูุดุงุก ุทูุจ ุตูุงูุฉ
PUT    /api/cm/requests/:id                  - ุชุนุฏูู ุทูุจ
POST   /api/cm/requests/:id/approve          - ููุงููุฉ ุนูู ุงูุทูุจ
POST   /api/cm/requests/:id/reject           - ุฑูุถ ุงูุทูุจ
POST   /api/cm/requests/:id/convert          - ุชุญููู ูุฃูุฑ ุนูู

# === ุฃูุงูุฑ ุนูู ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ ===
GET    /api/cm/work-orders                   - ุฃูุงูุฑ ุนูู CM
GET    /api/cm/work-orders/:id               - ุชูุงุตูู ุฃูุฑ ุนูู
POST   /api/cm/work-orders                   - ุฅูุดุงุก ุฃูุฑ ุนูู
PUT    /api/cm/work-orders/:id               - ุชุนุฏูู ุฃูุฑ ุนูู
POST   /api/cm/work-orders/:id/assign        - ุชุนููู ููู
POST   /api/cm/work-orders/:id/start         - ุจุฏุก ุงูุชูููุฐ
POST   /api/cm/work-orders/:id/complete      - ุฅููุงู ุฃูุฑ ุงูุนูู
POST   /api/cm/work-orders/:id/close         - ุฅุบูุงู ุฃูุฑ ุงูุนูู
GET    /api/cm/work-orders/:id/timeline      - ุงูุฌุฏูู ุงูุฒููู
POST   /api/cm/work-orders/:id/notes         - ุฅุถุงูุฉ ููุงุญุธุฉ
POST   /api/cm/work-orders/:id/photos        - ุฑูุน ุตูุฑุฉ
```

## APIs ููุฏุณุฉ ุงูููุซูููุฉ

```
# === ุงูููููุงุช ===
GET    /api/reliability/components           - ูุงุฆูุฉ ุงูููููุงุช
GET    /api/reliability/components/:id       - ุชูุงุตูู ูููู
POST   /api/reliability/components           - ุชุณุฌูู ูููู ุฌุฏูุฏ
PUT    /api/reliability/components/:id       - ุชุนุฏูู ูููู
POST   /api/reliability/components/:id/install   - ุชุฑููุจ ูููู
POST   /api/reliability/components/:id/remove    - ูู ูููู
POST   /api/reliability/components/:id/replace   - ุงุณุชุจุฏุงู ูููู
GET    /api/reliability/components/:id/history   - ุชุงุฑูุฎ ุงููููู

# === ุชุญููู MTBF ===
GET    /api/reliability/mtbf                 - ุชูุฑูุฑ MTBF
GET    /api/reliability/mtbf/by-asset/:id    - MTBF ููุฃุตู
GET    /api/reliability/mtbf/by-category     - MTBF ุจุงููุฆุฉ
GET    /api/reliability/mtbf/by-supplier     - MTBF ุจุงูููุฑุฏ
GET    /api/reliability/mtbf/trend           - ุงุชุฌุงู MTBF

# === ุงูุชุญูููุงุช ===
GET    /api/reliability/failures             - ุชูุฑูุฑ ุงูุฃุนุทุงู
GET    /api/reliability/failures/pareto      - ุชุญููู ุจุงุฑูุชู
GET    /api/reliability/failures/root-cause  - ุชุญููู ุงูุณุจุจ ุงูุฌุฐุฑู
GET    /api/reliability/performance          - ุฃุฏุงุก ุงูุฃุตูู
GET    /api/reliability/anomalies            - ุงูุญุงูุงุช ุงูุดุงุฐุฉ
```

## APIs ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ ููููููุฉ (TCO)

```
# === ุชุญููู TCO ===
GET    /api/tco/assets/:id                   - TCO ููุฃุตู
GET    /api/tco/categories/:id               - TCO ูููุฆุฉ
GET    /api/tco/suppliers/:id                - TCO ููููุฑุฏ
GET    /api/tco/comparison                   - ููุงุฑูุฉ TCO
GET    /api/tco/forecast/:id                 - ุชููุนุงุช TCO
GET    /api/tco/breakdown/:id                - ุชูุตูู ุงูุชูุงููู

# === ุงูุชูุงุฑูุฑ ===
GET    /api/tco/reports/summary              - ููุฎุต TCO
GET    /api/tco/reports/trend                - ุงุชุฌุงู TCO
GET    /api/tco/reports/benchmark            - ุงูููุงุฑูุฉ ุงููุนูุงุฑูุฉ
```

## APIs ุงููุญุทุงุช ูุงูุดุจูุฉ

```
# === ุงููุญุทุงุช ===
GET    /api/stations                         - ูุงุฆูุฉ ุงููุญุทุงุช
GET    /api/stations/:id                     - ุชูุงุตูู ูุญุทุฉ
POST   /api/stations                         - ุฅูุดุงุก ูุญุทุฉ
PUT    /api/stations/:id                     - ุชุนุฏูู ูุญุทุฉ
GET    /api/stations/:id/assets              - ุฃุตูู ุงููุญุทุฉ
GET    /api/stations/:id/readings            - ูุฑุงุกุงุช ุงููุญุทุฉ
GET    /api/stations/:id/alarms              - ุชูุจููุงุช ุงููุญุทุฉ
GET    /api/stations/:id/maintenance         - ุตูุงูุฉ ุงููุญุทุฉ
GET    /api/stations/map                     - ุฎุฑูุทุฉ ุงููุญุทุงุช
GET    /api/stations/status                  - ุญุงูุฉ ุฌููุน ุงููุญุทุงุช

# === ุงูุดุจูุฉ ===
GET    /api/network/topology                 - ุทูุจูููุฌูุง ุงูุดุจูุฉ
GET    /api/network/lines                    - ุฎุทูุท ุงูุดุจูุฉ
GET    /api/network/transformers             - ุงููุญููุงุช
GET    /api/network/feeders                  - ุงููุบุฐูุงุช
GET    /api/network/distribution-boxes       - ุตูุงุฏูู ุงูุชูุฒูุน
GET    /api/network/meters                   - ุงูุนุฏุงุฏุงุช
GET    /api/network/gis                      - ุจูุงูุงุช GIS
```

---

# ๐ ุงูุชูุงูู ุงููุงูู ูุน ุงูุฃูุธูุฉ ุงูุฃุฎุฑู

## ุงูุชูุงูู ูุน ุงููุธุงู ุงูุฃู (01)

| ุงููุธููุฉ | API ุงููุธุงู ุงูุฃู | ุงููุตู |
|---------|-----------------|-------|
| ููุฏ ุดุฑุงุก ุฃุตู | `POST /api/core/journal-entries` | ุฅูุดุงุก ููุฏ ุดุฑุงุก |
| ููุฏ ุฅููุงู | `POST /api/core/journal-entries` | ุฅูุดุงุก ููุฏ ุฅููุงู ุดูุฑู |
| ููุฏ ุงุณุชุจุนุงุฏ | `POST /api/core/journal-entries` | ุฅูุดุงุก ููุฏ ุงุณุชุจุนุงุฏ |
| ููุฏ ุตูุงูุฉ | `POST /api/core/journal-entries` | ุฅูุดุงุก ููุฏ ูุตุฑูู ุตูุงูุฉ |
| ูุฑูุฒ ุงูุชูููุฉ | `GET /api/core/cost-centers` | ุฌูุจ ูุฑุงูุฒ ุงูุชูููุฉ |

## ุงูุชูุงูู ูุน ูุธุงู ุงููุทูุฑ (02)

| ุงููุธููุฉ | ุงููุตู |
|---------|-------|
| ูุดุฑ ุงูุฃุญุฏุงุซ | `ASSET_CREATED`, `ASSET_UPDATED`, `MAINTENANCE_COMPLETED` |
| ุงุณุชูุจุงู ุงูุฃุญุฏุงุซ | `IOT_READING_RECEIVED`, `ALARM_TRIGGERED` |
| APIs ูุณุฌูุฉ | ุฌููุน APIs ุงูุฃุตูู ูุงูุตูุงูุฉ |
| Webhooks | ุงุณุชูุจุงู ูุฑุงุกุงุช Acrel IoT |

## ุงูุชูุงูู ูุน ุงูุนูููุงุช ุงูููุฏุงููุฉ (04)

| ุงููุธููุฉ | API | ุงููุตู |
|---------|-----|-------|
| ุฅูุดุงุก ุฃูุฑ ุนูู | `POST /api/field/work-orders` | ุฅูุดุงุก ุฃูุฑ ุนูู ููุฏุงูู |
| ุชุนููู ููู | `POST /api/field/work-orders/:id/assign` | ุชุนููู ููู ููุตูุงูุฉ |
| ุชุญุฏูุซ ุงูุญุงูุฉ | `PUT /api/field/work-orders/:id/status` | ุชุญุฏูุซ ุญุงูุฉ ุฃูุฑ ุงูุนูู |
| ุฅุฑุณุงู ุฅุดุนุงุฑ | `POST /api/field/notifications` | ุฅุดุนุงุฑ ุงูููู |

## ุงูุชูุงูู ูุน ุงููุฑุงูุจุฉ ูุงูุชุญูู (05)

| ุงููุธููุฉ | API | ุงููุตู |
|---------|-----|-------|
| ุงุณุชูุจุงู ูุฑุงุกุงุช | `POST /api/assets/iot/readings` | ูุฑุงุกุงุช ูู SCADA |
| ุงุณุชูุจุงู ุชูุจููุงุช | `POST /api/assets/alarms` | ุชูุจููุงุช ูู SCADA |
| ุญุงูุฉ ุงูุฃุตู | `GET /api/scada/devices/:id/status` | ุญุงูุฉ ุงูุฌูุงุฒ |
| ุฃูุงูุฑ ุงูุชุญูู | `POST /api/scada/devices/:id/command` | ุฅุฑุณุงู ุฃูุฑ |

## ุงูุชูุงูู ูุน ุงููุฎุฒูู ูุงููุดุชุฑูุงุช (06)

| ุงููุธููุฉ | API | ุงููุตู |
|---------|-----|-------|
| ุตุฑู ูุทุน ุบูุงุฑ | `POST /api/inventory/issue` | ุตุฑู ููุตูุงูุฉ |
| ุงุณุชูุงู ุฃุตู | `POST /api/inventory/receive` | ุงุณุชูุงู ุฃุตู ุฌุฏูุฏ |
| ุทูุจ ุดุฑุงุก | `POST /api/procurement/purchase-requests` | ุทูุจ ูุทุน ุบูุงุฑ |
| ุฑุตูุฏ ุงููุฎุฒูู | `GET /api/inventory/items/:id/stock` | ุงูุชุญูู ูู ุงูุฑุตูุฏ |

## ุงูุชูุงูู ูุน ุงูุนููุงุก ูุงูููุชุฑุฉ (07)

| ุงููุธููุฉ | API | ุงููุตู |
|---------|-----|-------|
| ุฑุจุท ุงูุนุฏุงุฏ | `PUT /api/billing/meters/:id` | ุฑุจุท ุงูุนุฏุงุฏ ุจุงูุนููู |
| ุงุณุชุจุฏุงู ุงูุนุฏุงุฏ | `POST /api/billing/meters/:id/replace` | ุงุณุชุจุฏุงู ุนุฏุงุฏ |
| ููุชุฑุฉ ุชูุฏูุฑูุฉ | `POST /api/billing/invoices/estimate` | ูุงุชูุฑุฉ ุชูุฏูุฑูุฉ |
| ูุฑุงุกุฉ ุงูุนุฏุงุฏ | `GET /api/billing/meters/:id/readings` | ุขุฎุฑ ูุฑุงุกุฉ |

## ุงูุชูุงูู ูุน ุงูุชุฎุทูุท ูุงููุดุงุฑูุน (10)

| ุงููุธููุฉ | API | ุงููุตู |
|---------|-----|-------|
| ุฑุจุท ุฃุตู ุจูุดุฑูุน | `POST /api/projects/:id/assets` | ุฅุถุงูุฉ ุฃุตู ูููุดุฑูุน |
| ุฑุณููุฉ ุฃุตู | `POST /api/projects/:id/capitalize` | ุฑุณููุฉ ุฃุตูู ุงููุดุฑูุน |
| ุชูููุฉ ุงููุดุฑูุน | `GET /api/projects/:id/costs` | ุชูุงููู ุงูุฃุตูู |
| ุญุงูุฉ ุงูุฃุตูู | `GET /api/projects/:id/assets/status` | ุญุงูุฉ ุฃุตูู ุงููุดุฑูุน |

---

# ๐ ููุงุนุฏ ุงูุนูู ุงูุฅุถุงููุฉ

## ููุงุนุฏ ุงูุฃุตูู

| ุงูููุฏ | ุงููุงุนุฏุฉ | ุงููุตู |
|-------|---------|-------|
| BR-AST-001 | ุงูุชุฑููู ุงูุชููุงุฆู | ูู ุฃุตู ูุญุตู ุนูู ุฑูู ูุฑูุฏ ุชููุงุฆูุงู |
| BR-AST-002 | ุงูุฅููุงู ุงูุฅูุฒุงูู | ุงูุฃุตูู ุงูุซุงุจุชุฉ ุชูููู ุดูุฑูุงู |
| BR-AST-003 | ุงูุญุฏ ุงูุฃุฏูู ูููููุฉ | ูุง ูููู ุฅููุงู ุฃุตู ุชุญุช ูููุฉ ุงูุฎุฑุฏุฉ |
| BR-AST-004 | ููุงููุฉ ุงูุงุณุชุจุนุงุฏ | ุงุณุชุจุนุงุฏ ุงูุฃุตูู ูุชุทูุจ ููุงููุฉ |
| BR-AST-005 | ุงูุชุญููู ุจูู ุงูููุงูุน | ุงูุชุญููู ูุชุทูุจ ุชูุซูู |

## ููุงุนุฏ ุงูุตูุงูุฉ ุงูููุงุฆูุฉ

| ุงูููุฏ | ุงููุงุนุฏุฉ | ุงููุตู |
|-------|---------|-------|
| BR-PM-001 | ุงูุชูููุฏ ุงูุชููุงุฆู | ุฃูุงูุฑ ุงูุนูู ุชูููุฏ ุชููุงุฆูุงู ุญุณุจ ุงูุฌุฏูู |
| BR-PM-002 | ุงูุชุฃุฎูุฑ ุงููุณููุญ | 7 ุฃูุงู ุชุฃุฎูุฑ ูุจู ุงูุชุตุนูุฏ |
| BR-PM-003 | ุงูููุงุฏ ุงููุทููุจุฉ | ุงูุชุญูู ูู ุชููุฑ ุงูููุงุฏ ูุจู ุงูุชูููุฏ |
| BR-PM-004 | ุงูุฅููุงู ุงูุฅูุฒุงูู | ุฌููุน ุงูููุงู ูุฌุจ ุฅููุงููุง |
| BR-PM-005 | ุฎุตู ุงููุฎุฒูู | ุฎุตู ุงูููุงุฏ ุชููุงุฆูุงู ุนูุฏ ุงูุฅููุงู |

## ููุงุนุฏ ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ

| ุงูููุฏ | ุงููุงุนุฏุฉ | ุงููุตู |
|-------|---------|-------|
| BR-CM-001 | ุงูุฃููููุฉ | ุงูุฃููููุฉ ุชุญุฏุฏ ููุช ุงูุงุณุชุฌุงุจุฉ |
| BR-CM-002 | ุงูุชุตุนูุฏ | ุงูุชุตุนูุฏ ุงูุชููุงุฆู ุนูุฏ ุงูุชุฃุฎูุฑ |
| BR-CM-003 | ุงูุชูุซูู | ุชูุซูู ุงูุณุจุจ ูุงูุญู ุฅูุฒุงูู |
| BR-CM-004 | ุงูุตูุฑ | ุตูุฑ ูุจู ูุจุนุฏ ููุฃุนุทุงู ุงููุจูุฑุฉ |
| BR-CM-005 | ุงูุชูููุฉ | ุญุณุงุจ ุงูุชูููุฉ ุงููุนููุฉ |


---

# ๐ง ููุทู ุงูุนูู ุงูุชูุตููู (Business Logic)

## 1. ููุทู ุฅุฏุงุฑุฉ ุงูุฃุตูู

### 1.1 ุฅูุดุงุก ุฃุตู ุฌุฏูุฏ

```python
def create_asset(asset_data: dict) -> Asset:
    """
    ุฅูุดุงุก ุฃุตู ุฌุฏูุฏ ูุน ุงูุชุญูู ูุงููููุฏ ุงููุญุงุณุจูุฉ
    """
    # 1. ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงูุฅูุฒุงููุฉ
    validate_required_fields(asset_data, [
        'name', 'category_id', 'acquisition_date', 
        'acquisition_cost', 'useful_life_months'
    ])
    
    # 2. ุชูููุฏ ุฑูู ุงูุฃุตู ุงูุชููุงุฆู
    asset_code = generate_asset_code(
        category=asset_data['category_id'],
        station=asset_data.get('station_id'),
        year=datetime.now().year
    )
    # ูุซุงู: AST-TRF-ST01-2024-0001 (ุฃุตู-ูุญูู-ูุญุทุฉ01-2024-ุชุณูุณู)
    
    # 3. ุญุณุงุจ ูููุฉ ุงูุฎุฑุฏุฉ (10% ุงูุชุฑุงุถูุงู)
    salvage_value = asset_data.get('salvage_value', 
        asset_data['acquisition_cost'] * 0.10)
    
    # 4. ุญุณุงุจ ูููุฉ ุงูุฅููุงู ุงูุดูุฑู
    depreciable_amount = asset_data['acquisition_cost'] - salvage_value
    monthly_depreciation = depreciable_amount / asset_data['useful_life_months']
    
    # 5. ุฅูุดุงุก ุงูุฃุตู
    asset = Asset.create(
        code=asset_code,
        name=asset_data['name'],
        category_id=asset_data['category_id'],
        station_id=asset_data.get('station_id'),
        location=asset_data.get('location'),
        acquisition_date=asset_data['acquisition_date'],
        acquisition_cost=asset_data['acquisition_cost'],
        salvage_value=salvage_value,
        useful_life_months=asset_data['useful_life_months'],
        monthly_depreciation=monthly_depreciation,
        current_value=asset_data['acquisition_cost'],
        status='active',
        warranty_end_date=asset_data.get('warranty_end_date'),
        supplier_id=asset_data.get('supplier_id'),
        serial_number=asset_data.get('serial_number'),
        model=asset_data.get('model'),
        manufacturer=asset_data.get('manufacturer')
    )
    
    # 6. ุฅูุดุงุก ุงูููุฏ ุงููุญุงุณุจู (ุดุฑุงุก ุงูุฃุตู)
    if asset_data.get('create_journal_entry', True):
        create_asset_purchase_entry(asset)
    
    # 7. ูุดุฑ ุญุฏุซ ุฅูุดุงุก ุงูุฃุตู
    publish_event('ASSET_CREATED', {
        'asset_id': asset.id,
        'asset_code': asset.code,
        'category': asset.category.name,
        'cost': asset.acquisition_cost
    })
    
    # 8. ุฅูุดุงุก ุฎุทุฉ ุงูุตูุงูุฉ ุงูููุงุฆูุฉ (ุฅู ูุฌุฏุช ูููุฆุฉ)
    create_default_pm_plan(asset)
    
    return asset


def generate_asset_code(category: str, station: str, year: int) -> str:
    """ุชูููุฏ ุฑูู ุฃุตู ูุฑูุฏ"""
    prefix = get_category_prefix(category)  # TRF, MTR, CBL, etc.
    station_code = get_station_code(station) if station else 'GEN'
    
    # ุงูุญุตูู ุนูู ุขุฎุฑ ุชุณูุณู
    last_seq = Asset.query.filter(
        Asset.code.like(f'AST-{prefix}-{station_code}-{year}-%')
    ).count()
    
    return f'AST-{prefix}-{station_code}-{year}-{str(last_seq + 1).zfill(4)}'
```

### 1.2 ุญุณุงุจ ูุชุดุบูู ุงูุฅููุงู

```python
def run_monthly_depreciation(business_id: UUID, period: str) -> DepreciationResult:
    """
    ุชุดุบูู ุงูุฅููุงู ุงูุดูุฑู ูุฌููุน ุงูุฃุตูู
    
    Args:
        business_id: ูุนุฑู ุงูููุดุฃุฉ
        period: ุงููุชุฑุฉ ุงููุญุงุณุจูุฉ (YYYY-MM)
    
    Returns:
        ูุชูุฌุฉ ุงูุฅููุงู ูุน ุงูููุฏ ุงููุญุงุณุจู
    """
    # 1. ุงูุชุญูู ูู ุนุฏู ุชุดุบูู ุงูุฅููุงู ูุณุจูุงู ููุฐู ุงููุชุฑุฉ
    existing = DepreciationRun.query.filter_by(
        business_id=business_id,
        period=period
    ).first()
    
    if existing:
        raise BusinessError('ุงูุฅููุงู ุชู ุชุดุบููู ูุณุจูุงู ููุฐู ุงููุชุฑุฉ')
    
    # 2. ุฌูุจ ุงูุฃุตูู ุงููุงุจูุฉ ููุฅููุงู
    assets = Asset.query.filter(
        Asset.business_id == business_id,
        Asset.status == 'active',
        Asset.current_value > Asset.salvage_value,
        Asset.acquisition_date <= get_period_end_date(period)
    ).all()
    
    # 3. ุญุณุงุจ ุงูุฅููุงู ููู ุฃุตู
    depreciation_entries = []
    total_depreciation = Decimal('0')
    
    for asset in assets:
        # ุญุณุงุจ ุงูุฅููุงู ุงูุดูุฑู
        depreciation_amount = calculate_depreciation(asset, period)
        
        if depreciation_amount > 0:
            # ุชุญุฏูุซ ุงููููุฉ ุงูุฏูุชุฑูุฉ
            new_value = max(
                asset.current_value - depreciation_amount,
                asset.salvage_value
            )
            
            # ุชุณุฌูู ุงูุฅููุงู
            entry = AssetDepreciation.create(
                asset_id=asset.id,
                period=period,
                depreciation_amount=depreciation_amount,
                accumulated_depreciation=asset.accumulated_depreciation + depreciation_amount,
                book_value_before=asset.current_value,
                book_value_after=new_value
            )
            
            # ุชุญุฏูุซ ุงูุฃุตู
            asset.update(
                current_value=new_value,
                accumulated_depreciation=asset.accumulated_depreciation + depreciation_amount,
                last_depreciation_date=get_period_end_date(period)
            )
            
            depreciation_entries.append(entry)
            total_depreciation += depreciation_amount
    
    # 4. ุฅูุดุงุก ุงูููุฏ ุงููุญุงุณุจู ุงููุฌูุน
    journal_entry = create_depreciation_journal_entry(
        business_id=business_id,
        period=period,
        entries=depreciation_entries,
        total=total_depreciation
    )
    
    # 5. ุชุณุฌูู ุนูููุฉ ุงูุฅููุงู
    run = DepreciationRun.create(
        business_id=business_id,
        period=period,
        assets_count=len(depreciation_entries),
        total_depreciation=total_depreciation,
        journal_entry_id=journal_entry.id,
        status='completed'
    )
    
    return DepreciationResult(
        run=run,
        entries=depreciation_entries,
        journal_entry=journal_entry
    )


def calculate_depreciation(asset: Asset, period: str) -> Decimal:
    """
    ุญุณุงุจ ูููุฉ ุงูุฅููุงู ููุฃุตู
    
    ูุฏุนู ุทุฑู ุงูุฅููุงู:
    - straight_line: ุงููุณุท ุงูุซุงุจุช
    - declining_balance: ุงููุณุท ุงููุชูุงูุต
    - units_of_production: ูุญุฏุงุช ุงูุฅูุชุงุฌ
    """
    method = asset.depreciation_method or 'straight_line'
    
    if method == 'straight_line':
        # ุงูุฅููุงู = (ุงูุชูููุฉ - ุงูุฎุฑุฏุฉ) / ุงูุนูุฑ ุงูุฅูุชุงุฌู
        return asset.monthly_depreciation
    
    elif method == 'declining_balance':
        # ุงูุฅููุงู = ุงููููุฉ ุงูุฏูุชุฑูุฉ ร ูุนุฏู ุงูุฅููุงู
        rate = asset.depreciation_rate or (2 / asset.useful_life_months)
        return asset.current_value * Decimal(str(rate))
    
    elif method == 'units_of_production':
        # ุงูุฅููุงู = (ุงูุชูููุฉ - ุงูุฎุฑุฏุฉ) ร (ุงููุญุฏุงุช ุงูููุชุฌุฉ / ุฅุฌูุงูู ุงููุญุฏุงุช)
        units_this_period = get_production_units(asset.id, period)
        rate = units_this_period / asset.total_estimated_units
        return (asset.acquisition_cost - asset.salvage_value) * Decimal(str(rate))
    
    return Decimal('0')
```

### 1.3 ุงุณุชุจุนุงุฏ ุงูุฃุตู

```python
def dispose_asset(asset_id: UUID, disposal_data: dict) -> DisposalResult:
    """
    ุงุณุชุจุนุงุฏ ุฃุตู (ุจูุนุ ุฅุชูุงูุ ุชุจุฑุน)
    
    Args:
        asset_id: ูุนุฑู ุงูุฃุตู
        disposal_data: ุจูุงูุงุช ุงูุงุณุชุจุนุงุฏ
            - disposal_type: ููุน ุงูุงุณุชุจุนุงุฏ (sale, scrap, donation)
            - disposal_date: ุชุงุฑูุฎ ุงูุงุณุชุจุนุงุฏ
            - disposal_value: ูููุฉ ุงูุจูุน (ููุจูุน ููุท)
            - reason: ุณุจุจ ุงูุงุณุชุจุนุงุฏ
    """
    asset = Asset.get_or_404(asset_id)
    
    # 1. ุงูุชุญูู ูู ุฅููุงููุฉ ุงูุงุณุชุจุนุงุฏ
    if asset.status != 'active':
        raise BusinessError('ุงูุฃุตู ุบูุฑ ูุดุท ููุง ูููู ุงุณุชุจุนุงุฏู')
    
    # 2. ุงูุชุญูู ูู ุงูููุงููุงุช (ููุฃุตูู ุนุงููุฉ ุงููููุฉ)
    if asset.current_value > get_disposal_approval_threshold():
        require_approval('asset_disposal', asset_id, disposal_data)
    
    # 3. ุญุณุงุจ ุงูุฑุจุญ/ุงูุฎุณุงุฑุฉ
    book_value = asset.current_value
    disposal_value = disposal_data.get('disposal_value', Decimal('0'))
    gain_loss = disposal_value - book_value
    
    # 4. ุฅูุดุงุก ุงูููุฏ ุงููุญุงุณุจู
    """
    ุญุงูุฉ ุงูุจูุน ุจุฑุจุญ:
        ูู ุญู/ ุงูููุฏูุฉ (ุฃู ุงููุฏูููู)     XXX
        ูู ุญู/ ูุฌูุน ุงูุฅููุงู              XXX
            ุฅูู ุญู/ ุงูุฃุตู                    XXX
            ุฅูู ุญู/ ุฃุฑุจุงุญ ุจูุน ุฃุตูู           XXX
    
    ุญุงูุฉ ุงูุจูุน ุจุฎุณุงุฑุฉ:
        ูู ุญู/ ุงูููุฏูุฉ                   XXX
        ูู ุญู/ ูุฌูุน ุงูุฅููุงู              XXX
        ูู ุญู/ ุฎุณุงุฆุฑ ุจูุน ุฃุตูู           XXX
            ุฅูู ุญู/ ุงูุฃุตู                    XXX
    
    ุญุงูุฉ ุงูุฅุชูุงู:
        ูู ุญู/ ูุฌูุน ุงูุฅููุงู              XXX
        ูู ุญู/ ุฎุณุงุฆุฑ ุฅุชูุงู ุฃุตูู         XXX
            ุฅูู ุญู/ ุงูุฃุตู                    XXX
    """
    journal_entry = create_disposal_journal_entry(
        asset=asset,
        disposal_type=disposal_data['disposal_type'],
        disposal_value=disposal_value,
        gain_loss=gain_loss
    )
    
    # 5. ุชุญุฏูุซ ุญุงูุฉ ุงูุฃุตู
    asset.update(
        status='disposed',
        disposal_date=disposal_data['disposal_date'],
        disposal_type=disposal_data['disposal_type'],
        disposal_value=disposal_value,
        disposal_gain_loss=gain_loss,
        disposal_reason=disposal_data.get('reason')
    )
    
    # 6. ุฅูุบุงุก ุฎุทุท ุงูุตูุงูุฉ ุงููุฑุชุจุทุฉ
    cancel_asset_maintenance_plans(asset_id)
    
    # 7. ูุดุฑ ุญุฏุซ ุงูุงุณุชุจุนุงุฏ
    publish_event('ASSET_DISPOSED', {
        'asset_id': asset.id,
        'asset_code': asset.code,
        'disposal_type': disposal_data['disposal_type'],
        'book_value': book_value,
        'disposal_value': disposal_value,
        'gain_loss': gain_loss
    })
    
    return DisposalResult(
        asset=asset,
        journal_entry=journal_entry,
        gain_loss=gain_loss
    )
```

---

## 2. ููุทู ุงูุตูุงูุฉ ุงูููุงุฆูุฉ (PM)

### 2.1 ุฅูุดุงุก ุฎุทุฉ ุตูุงูุฉ ููุงุฆูุฉ

```python
def create_pm_plan(plan_data: dict) -> PMPlan:
    """
    ุฅูุดุงุก ุฎุทุฉ ุตูุงูุฉ ููุงุฆูุฉ
    """
    # 1. ุงูุชุญูู ูู ุงูุจูุงูุงุช
    validate_required_fields(plan_data, [
        'name', 'asset_id', 'frequency_type', 'frequency_value'
    ])
    
    asset = Asset.get_or_404(plan_data['asset_id'])
    
    # 2. ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุฎุทุฉ ููุฑุฑุฉ
    existing = PMPlan.query.filter_by(
        asset_id=asset.id,
        frequency_type=plan_data['frequency_type'],
        is_active=True
    ).first()
    
    if existing:
        raise BusinessError('ุชูุฌุฏ ุฎุทุฉ ุตูุงูุฉ ูุดุทุฉ ุจููุณ ุงูุชูุฑุงุฑ ููุฐุง ุงูุฃุตู')
    
    # 3. ุฅูุดุงุก ุงูุฎุทุฉ
    plan = PMPlan.create(
        name=plan_data['name'],
        asset_id=asset.id,
        frequency_type=plan_data['frequency_type'],  # daily, weekly, monthly, yearly, meter_based
        frequency_value=plan_data['frequency_value'],  # ูู X ููู/ุฃุณุจูุน/ุดูุฑ/ุณูุฉ/ุณุงุนุฉ ุชุดุบูู
        estimated_duration_hours=plan_data.get('estimated_duration_hours', 2),
        priority=plan_data.get('priority', 'medium'),
        requires_shutdown=plan_data.get('requires_shutdown', False),
        instructions=plan_data.get('instructions'),
        safety_notes=plan_data.get('safety_notes'),
        is_active=True
    )
    
    # 4. ุฅุถุงูุฉ ุงูููุงู
    for task_data in plan_data.get('tasks', []):
        PMPlanTask.create(
            plan_id=plan.id,
            sequence=task_data['sequence'],
            name=task_data['name'],
            description=task_data.get('description'),
            estimated_minutes=task_data.get('estimated_minutes', 30),
            requires_photo=task_data.get('requires_photo', False),
            requires_measurement=task_data.get('requires_measurement', False),
            measurement_unit=task_data.get('measurement_unit'),
            min_value=task_data.get('min_value'),
            max_value=task_data.get('max_value')
        )
    
    # 5. ุฅุถุงูุฉ ุงูููุงุฏ ุงููุทููุจุฉ
    for material in plan_data.get('materials', []):
        PMPlanMaterial.create(
            plan_id=plan.id,
            item_id=material['item_id'],
            quantity=material['quantity'],
            is_critical=material.get('is_critical', False)
        )
    
    # 6. ุญุณุงุจ ุชุงุฑูุฎ ุงูุชูููุฐ ุงูุชุงูู
    plan.next_due_date = calculate_next_pm_date(plan)
    plan.save()
    
    return plan


def calculate_next_pm_date(plan: PMPlan, from_date: date = None) -> date:
    """
    ุญุณุงุจ ุชุงุฑูุฎ ุงูุตูุงูุฉ ุงูููุงุฆูุฉ ุงูุชุงููุฉ
    """
    base_date = from_date or plan.last_completed_date or plan.created_at.date()
    
    if plan.frequency_type == 'daily':
        return base_date + timedelta(days=plan.frequency_value)
    
    elif plan.frequency_type == 'weekly':
        return base_date + timedelta(weeks=plan.frequency_value)
    
    elif plan.frequency_type == 'monthly':
        return add_months(base_date, plan.frequency_value)
    
    elif plan.frequency_type == 'yearly':
        return add_years(base_date, plan.frequency_value)
    
    elif plan.frequency_type == 'meter_based':
        # ุจูุงุกู ุนูู ุณุงุนุงุช ุงูุชุดุบูู ุฃู ุงููููููุชุฑุงุช
        current_reading = get_asset_meter_reading(plan.asset_id)
        last_reading = plan.last_meter_reading or 0
        
        if current_reading - last_reading >= plan.frequency_value:
            return date.today()
        else:
            # ุชูุฏูุฑ ุจูุงุกู ุนูู ูุนุฏู ุงูุงุณุชุฎุฏุงู
            daily_usage = calculate_daily_usage(plan.asset_id)
            remaining = plan.frequency_value - (current_reading - last_reading)
            days_remaining = remaining / daily_usage if daily_usage > 0 else 30
            return date.today() + timedelta(days=int(days_remaining))
    
    return base_date + timedelta(days=30)  # ุงูุชุฑุงุถู
```

### 2.2 ูุญุฑู ุชูููุฏ ุฃูุงูุฑ ุงูุนูู

```python
def pm_scheduler_job():
    """
    ูุธููุฉ ูุฌุฏููุฉ ูุชูููุฏ ุฃูุงูุฑ ุนูู ุงูุตูุงูุฉ ุงูููุงุฆูุฉ
    ุชุนูู ููููุงู ูู ุงูุณุงุนุฉ 6 ุตุจุงุญุงู
    """
    today = date.today()
    lookahead_days = 7  # ุชูููุฏ ุฃูุงูุฑ ุงูุนูู ูุจู 7 ุฃูุงู
    
    # ุฌูุจ ุงูุฎุทุท ุงููุณุชุญูุฉ
    due_plans = PMPlan.query.filter(
        PMPlan.is_active == True,
        PMPlan.next_due_date <= today + timedelta(days=lookahead_days),
        ~PMPlan.id.in_(
            # ุงุณุชุจุนุงุฏ ุงูุฎุทุท ุงูุชู ููุง ุฃูุงูุฑ ุนูู ููุชูุญุฉ
            db.session.query(PMWorkOrder.plan_id).filter(
                PMWorkOrder.status.in_(['pending', 'in_progress'])
            )
        )
    ).all()
    
    generated_orders = []
    
    for plan in due_plans:
        try:
            work_order = generate_pm_work_order(plan)
            generated_orders.append(work_order)
        except Exception as e:
            log_error(f'ูุดู ุชูููุฏ ุฃูุฑ ุนูู ููุฎุทุฉ {plan.id}: {str(e)}')
    
    # ุฅุฑุณุงู ุชูุฑูุฑ
    send_pm_generation_report(generated_orders)
    
    return generated_orders


def generate_pm_work_order(plan: PMPlan) -> PMWorkOrder:
    """
    ุชูููุฏ ุฃูุฑ ุนูู ุตูุงูุฉ ููุงุฆูุฉ ูู ุงูุฎุทุฉ
    """
    # 1. ุงูุชุญูู ูู ุชููุฑ ุงูููุงุฏ
    materials_check = check_materials_availability(plan)
    
    if not materials_check['available'] and plan.materials_required:
        # ุฅูุดุงุก ุทูุจ ุดุฑุงุก ููููุงุฏ ุงููุงูุตุฉ
        create_purchase_request_for_pm(plan, materials_check['missing'])
        
        # ุชุฃุฌูู ุฃูุฑ ุงูุนูู ุฅุฐุง ูุงูุช ุงูููุงุฏ ุญุฑุฌุฉ
        if materials_check['critical_missing']:
            notify_pm_delayed(plan, 'ููุงุฏ ุญุฑุฌุฉ ุบูุฑ ูุชููุฑุฉ')
            return None
    
    # 2. ุชุญุฏูุฏ ุงูููู ุงูููุงุณุจ
    technician = assign_technician_for_pm(plan)
    
    # 3. ุฅูุดุงุก ุฃูุฑ ุงูุนูู
    work_order = PMWorkOrder.create(
        plan_id=plan.id,
        asset_id=plan.asset_id,
        work_order_number=generate_wo_number('PM'),
        scheduled_date=plan.next_due_date,
        priority=plan.priority,
        estimated_hours=plan.estimated_duration_hours,
        assigned_to=technician.id if technician else None,
        status='pending',
        requires_shutdown=plan.requires_shutdown,
        instructions=plan.instructions,
        safety_notes=plan.safety_notes
    )
    
    # 4. ูุณุฎ ุงูููุงู ูู ุงูุฎุทุฉ
    for task in plan.tasks:
        PMWorkOrderTask.create(
            work_order_id=work_order.id,
            task_id=task.id,
            sequence=task.sequence,
            name=task.name,
            description=task.description,
            status='pending'
        )
    
    # 5. ุญุฌุฒ ุงูููุงุฏ
    reserve_materials_for_wo(work_order, plan.materials)
    
    # 6. ุฅุฑุณุงู ุฅุดุนุงุฑ ููููู
    if technician:
        send_notification(
            user_id=technician.user_id,
            title='ุฃูุฑ ุนูู ุตูุงูุฉ ููุงุฆูุฉ ุฌุฏูุฏ',
            body=f'ุชู ุชุนูููู ูุฃูุฑ ุงูุนูู {work_order.work_order_number}',
            data={'work_order_id': work_order.id}
        )
    
    return work_order
```

### 2.3 ุฅููุงู ุฃูุฑ ุนูู ุงูุตูุงูุฉ ุงูููุงุฆูุฉ

```python
def complete_pm_work_order(work_order_id: UUID, completion_data: dict) -> PMWorkOrder:
    """
    ุฅููุงู ุฃูุฑ ุนูู ุตูุงูุฉ ููุงุฆูุฉ
    """
    work_order = PMWorkOrder.get_or_404(work_order_id)
    
    # 1. ุงูุชุญูู ูู ุฅููุงู ุฌููุน ุงูููุงู
    incomplete_tasks = PMWorkOrderTask.query.filter_by(
        work_order_id=work_order_id,
        status='pending'
    ).count()
    
    if incomplete_tasks > 0:
        raise BusinessError(f'ููุฌุฏ {incomplete_tasks} ููุงู ุบูุฑ ููุชููุฉ')
    
    # 2. ุงูุชุญูู ูู ุงูููุงุณุงุช (ุฅู ูุฌุฏุช)
    validate_measurements(work_order)
    
    # 3. ุชุณุฌูู ุงูููุงุฏ ุงููุณุชุฎุฏูุฉ ูุฎุตููุง ูู ุงููุฎุฒูู
    for material in completion_data.get('materials_used', []):
        # ุชุณุฌูู ุงูุงุณุชุฎุฏุงู
        PMWorkOrderMaterial.create(
            work_order_id=work_order_id,
            item_id=material['item_id'],
            quantity_used=material['quantity'],
            warehouse_id=material['warehouse_id']
        )
        
        # ุฎุตู ูู ุงููุฎุฒูู
        issue_inventory(
            item_id=material['item_id'],
            warehouse_id=material['warehouse_id'],
            quantity=material['quantity'],
            reference_type='pm_work_order',
            reference_id=work_order_id
        )
    
    # 4. ุญุณุงุจ ุงูุชูููุฉ ุงููุนููุฉ
    actual_cost = calculate_pm_cost(work_order, completion_data)
    
    # 5. ุชุญุฏูุซ ุฃูุฑ ุงูุนูู
    work_order.update(
        status='completed',
        completed_at=datetime.now(),
        completed_by=get_current_user_id(),
        actual_hours=completion_data.get('actual_hours'),
        actual_cost=actual_cost,
        technician_notes=completion_data.get('notes'),
        condition_after=completion_data.get('condition_after', 'good')
    )
    
    # 6. ุชุญุฏูุซ ุงูุฎุทุฉ
    plan = work_order.plan
    plan.update(
        last_completed_date=date.today(),
        last_meter_reading=completion_data.get('meter_reading'),
        next_due_date=calculate_next_pm_date(plan, date.today()),
        total_executions=plan.total_executions + 1
    )
    
    # 7. ุชุญุฏูุซ ุงูุฃุตู
    asset = work_order.asset
    asset.update(
        last_maintenance_date=date.today(),
        total_maintenance_cost=asset.total_maintenance_cost + actual_cost
    )
    
    # 8. ุชุญุฑูุฑ ุงูููุงุฏ ุงููุญุฌูุฒุฉ ุบูุฑ ุงููุณุชุฎุฏูุฉ
    release_unused_materials(work_order)
    
    # 9. ุฅูุดุงุก ุงูููุฏ ุงููุญุงุณุจู (ูุตุฑูู ุตูุงูุฉ)
    if actual_cost > 0:
        create_maintenance_expense_entry(work_order, actual_cost)
    
    # 10. ูุดุฑ ุงูุญุฏุซ
    publish_event('PM_COMPLETED', {
        'work_order_id': work_order.id,
        'asset_id': asset.id,
        'cost': actual_cost,
        'next_due_date': plan.next_due_date.isoformat()
    })
    
    return work_order
```

---

## 3. ููุทู ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ (CM)

### 3.1 ุฅูุดุงุก ุทูุจ ุตูุงูุฉ ุทุงุฑุฆุฉ

```python
def create_maintenance_request(request_data: dict) -> MaintenanceRequest:
    """
    ุฅูุดุงุก ุทูุจ ุตูุงูุฉ ุทุงุฑุฆุฉ
    """
    # 1. ุชุญุฏูุฏ ุงูุฃููููุฉ ุชููุงุฆูุงู ุจูุงุกู ุนูู ููุน ุงูุนุทู
    priority = determine_priority(
        fault_type=request_data.get('fault_type'),
        asset_criticality=get_asset_criticality(request_data['asset_id']),
        impact=request_data.get('impact')
    )
    
    # 2. ุฅูุดุงุก ุงูุทูุจ
    request = MaintenanceRequest.create(
        request_number=generate_request_number(),
        asset_id=request_data['asset_id'],
        reported_by=get_current_user_id(),
        fault_type=request_data['fault_type'],
        description=request_data['description'],
        priority=priority,
        impact=request_data.get('impact'),
        location=request_data.get('location'),
        photos=request_data.get('photos', []),
        status='pending'
    )
    
    # 3. ุญุณุงุจ ููุช ุงูุงุณุชุฌุงุจุฉ ุงููุทููุจ (SLA)
    sla = calculate_sla(priority)
    request.update(
        response_due_at=datetime.now() + timedelta(hours=sla['response_hours']),
        resolution_due_at=datetime.now() + timedelta(hours=sla['resolution_hours'])
    )
    
    # 4. ุฅุดุนุงุฑ ุงููุณุคูููู
    notify_maintenance_team(request)
    
    # 5. ููุฃุนุทุงู ุงูุญุฑุฌุฉ: ุชุญููู ุชููุงุฆู ูุฃูุฑ ุนูู
    if priority == 'critical':
        work_order = convert_to_work_order(request)
        auto_assign_technician(work_order)
    
    return request


def determine_priority(fault_type: str, asset_criticality: str, impact: str) -> str:
    """
    ุชุญุฏูุฏ ุฃููููุฉ ุงูุทูุจ ุจูุงุกู ุนูู ุนุฏุฉ ุนูุงูู
    """
    priority_matrix = {
        # (ููุน ุงูุนุทูุ ุฃูููุฉ ุงูุฃุตูุ ุงูุชุฃุซูุฑ) -> ุงูุฃููููุฉ
        ('power_outage', 'critical', 'high'): 'critical',
        ('power_outage', 'critical', 'medium'): 'high',
        ('power_outage', 'high', 'high'): 'high',
        ('equipment_failure', 'critical', 'high'): 'critical',
        ('equipment_failure', 'critical', 'medium'): 'high',
        ('safety_hazard', '*', '*'): 'critical',  # ุฃู ุฎุทุฑ ุนูู ุงูุณูุงูุฉ = ุญุฑุฌ
        # ... ุงููุฒูุฏ ูู ุงูููุงุนุฏ
    }
    
    # ุงูุจุญุซ ูู ุงููุตูููุฉ
    key = (fault_type, asset_criticality, impact)
    if key in priority_matrix:
        return priority_matrix[key]
    
    # ููุงุนุฏ ุงูุชุฑุงุถูุฉ
    if asset_criticality == 'critical':
        return 'high'
    elif asset_criticality == 'high':
        return 'medium'
    else:
        return 'low'


def calculate_sla(priority: str) -> dict:
    """
    ุญุณุงุจ SLA ุจูุงุกู ุนูู ุงูุฃููููุฉ
    """
    sla_config = {
        'critical': {'response_hours': 1, 'resolution_hours': 4},
        'high': {'response_hours': 4, 'resolution_hours': 24},
        'medium': {'response_hours': 8, 'resolution_hours': 48},
        'low': {'response_hours': 24, 'resolution_hours': 72}
    }
    return sla_config.get(priority, sla_config['medium'])
```

### 3.2 ุชุนููู ุงูููู ูุฅุฏุงุฑุฉ ุฃูุงูุฑ ุงูุนูู

```python
def assign_technician(work_order_id: UUID, technician_id: UUID = None) -> CMWorkOrder:
    """
    ุชุนููู ููู ูุฃูุฑ ุนูู ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ
    """
    work_order = CMWorkOrder.get_or_404(work_order_id)
    
    if technician_id:
        technician = Technician.get_or_404(technician_id)
    else:
        # ุงูุชุนููู ุงูุชููุงุฆู
        technician = find_best_technician(work_order)
    
    if not technician:
        raise BusinessError('ูุง ููุฌุฏ ููู ูุชุงุญ')
    
    # ุงูุชุญูู ูู ุชููุฑ ุงูููู
    if not is_technician_available(technician.id):
        raise BusinessError('ุงูููู ุบูุฑ ูุชุงุญ ุญุงููุงู')
    
    # ุชุญุฏูุซ ุฃูุฑ ุงูุนูู
    work_order.update(
        assigned_to=technician.id,
        assigned_at=datetime.now(),
        status='assigned'
    )
    
    # ุฅุฑุณุงู ุฅุดุนุงุฑ ููููู
    send_notification(
        user_id=technician.user_id,
        title='ุฃูุฑ ุนูู ุตูุงูุฉ ุทุงุฑุฆุฉ',
        body=f'ุชู ุชุนูููู ูุฃูุฑ ุงูุนูู {work_order.work_order_number}',
        data={
            'work_order_id': work_order.id,
            'priority': work_order.priority,
            'asset_name': work_order.asset.name,
            'location': work_order.asset.location
        },
        push=True  # ุฅุดุนุงุฑ ููุฑู
    )
    
    # ุชุณุฌูู ูู ุงูุฌุฏูู ุงูุฒููู
    WorkOrderTimeline.create(
        work_order_id=work_order.id,
        action='assigned',
        description=f'ุชู ุชุนููู ุงูููู {technician.name}',
        performed_by=get_current_user_id()
    )
    
    return work_order


def find_best_technician(work_order: CMWorkOrder) -> Technician:
    """
    ุงูุจุญุซ ุนู ุฃูุถู ููู ูุชุงุญ ุจูุงุกู ุนูู:
    1. ุงูููุงุฑุงุช ุงููุทููุจุฉ
    2. ุงููุฑุจ ูู ุงููููุน
    3. ุญูู ุงูุนูู ุงูุญุงูู
    4. ุงูุชูููู
    """
    required_skills = get_required_skills(work_order.fault_type, work_order.asset.category_id)
    
    # ุฌูุจ ุงูููููู ุงููุชุงุญูู ุจุงูููุงุฑุงุช ุงููุทููุจุฉ
    candidates = Technician.query.filter(
        Technician.is_active == True,
        Technician.status == 'available',
        Technician.skills.contains(required_skills)
    ).all()
    
    if not candidates:
        # ุชูุณูุน ุงูุจุญุซ ููููููู ุฐูู ุงูููุงุฑุงุช ุงููุดุงุจูุฉ
        candidates = Technician.query.filter(
            Technician.is_active == True,
            Technician.status == 'available'
        ).all()
    
    # ุญุณุงุจ ุงูููุงุท ููู ููู
    scored_candidates = []
    for tech in candidates:
        score = 0
        
        # ููุงุท ุงูููุงุฑุงุช (0-40)
        skill_match = len(set(tech.skills) & set(required_skills)) / len(required_skills) if required_skills else 1
        score += skill_match * 40
        
        # ููุงุท ุงููุฑุจ (0-30)
        distance = calculate_distance(tech.current_location, work_order.asset.location)
        score += max(0, 30 - distance)  # ูููุง ูุฑุจุ ุฒุงุฏุช ุงูููุงุท
        
        # ููุงุท ุญูู ุงูุนูู (0-20)
        current_load = get_technician_workload(tech.id)
        score += max(0, 20 - current_load * 4)  # ูููุง ูู ุงูุญููุ ุฒุงุฏุช ุงูููุงุท
        
        # ููุงุท ุงูุชูููู (0-10)
        score += (tech.rating or 3) * 2
        
        scored_candidates.append((tech, score))
    
    # ุชุฑุชูุจ ุญุณุจ ุงูููุงุท
    scored_candidates.sort(key=lambda x: x[1], reverse=True)
    
    return scored_candidates[0][0] if scored_candidates else None
```

### 3.3 ุฅููุงู ุฃูุฑ ุนูู ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ

```python
def complete_cm_work_order(work_order_id: UUID, completion_data: dict) -> CMWorkOrder:
    """
    ุฅููุงู ุฃูุฑ ุนูู ุตูุงูุฉ ุทุงุฑุฆุฉ
    """
    work_order = CMWorkOrder.get_or_404(work_order_id)
    
    # 1. ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงูุฅูุฒุงููุฉ
    validate_required_fields(completion_data, [
        'root_cause', 'action_taken', 'condition_after'
    ])
    
    # 2. ุงูุชุญูู ูู ุงูุตูุฑ (ููุฃุนุทุงู ุงููุจูุฑุฉ)
    if work_order.priority in ['critical', 'high']:
        if not completion_data.get('photos_after'):
            raise BusinessError('ูุฌุจ ุฅุฑูุงู ุตูุฑ ุจุนุฏ ุงูุฅุตูุงุญ ููุฃุนุทุงู ุงูุญุฑุฌุฉ')
    
    # 3. ุชุณุฌูู ุงูููุงุฏ ุงููุณุชุฎุฏูุฉ
    materials_cost = Decimal('0')
    for material in completion_data.get('materials_used', []):
        PMWorkOrderMaterial.create(
            work_order_id=work_order_id,
            item_id=material['item_id'],
            quantity_used=material['quantity'],
            unit_cost=get_item_cost(material['item_id'])
        )
        
        # ุฎุตู ูู ุงููุฎุฒูู
        issue_inventory(
            item_id=material['item_id'],
            warehouse_id=material['warehouse_id'],
            quantity=material['quantity'],
            reference_type='cm_work_order',
            reference_id=work_order_id
        )
        
        materials_cost += material['quantity'] * get_item_cost(material['item_id'])
    
    # 4. ุญุณุงุจ ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ
    labor_cost = calculate_labor_cost(
        technician_id=work_order.assigned_to,
        hours=completion_data['actual_hours']
    )
    
    total_cost = materials_cost + labor_cost + completion_data.get('other_costs', Decimal('0'))
    
    # 5. ุชุญุฏูุซ ุฃูุฑ ุงูุนูู
    work_order.update(
        status='completed',
        completed_at=datetime.now(),
        completed_by=get_current_user_id(),
        actual_hours=completion_data['actual_hours'],
        root_cause=completion_data['root_cause'],
        action_taken=completion_data['action_taken'],
        condition_after=completion_data['condition_after'],
        materials_cost=materials_cost,
        labor_cost=labor_cost,
        total_cost=total_cost,
        photos_after=completion_data.get('photos_after', []),
        technician_notes=completion_data.get('notes')
    )
    
    # 6. ุชุญุฏูุซ ุงูุฃุตู
    asset = work_order.asset
    asset.update(
        status='active' if completion_data['condition_after'] == 'good' else 'needs_attention',
        last_maintenance_date=date.today(),
        total_maintenance_cost=asset.total_maintenance_cost + total_cost,
        failure_count=asset.failure_count + 1
    )
    
    # 7. ุชุณุฌูู ุงูุนุทู ูุชุญููู MTBF
    record_failure(
        asset_id=asset.id,
        failure_date=work_order.created_at,
        repair_date=datetime.now(),
        root_cause=completion_data['root_cause'],
        downtime_hours=completion_data['actual_hours']
    )
    
    # 8. ุฅูุดุงุก ุงูููุฏ ุงููุญุงุณุจู
    create_maintenance_expense_entry(work_order, total_cost)
    
    # 9. ุงูุชุญูู ูู ุงูุญุงุฌุฉ ูุตูุงูุฉ ููุงุฆูุฉ
    if should_create_pm_plan(asset, completion_data['root_cause']):
        suggest_pm_plan(asset, completion_data['root_cause'])
    
    # 10. ูุดุฑ ุงูุญุฏุซ
    publish_event('CM_COMPLETED', {
        'work_order_id': work_order.id,
        'asset_id': asset.id,
        'root_cause': completion_data['root_cause'],
        'cost': total_cost,
        'downtime_hours': completion_data['actual_hours']
    })
    
    return work_order
```

---

## 4. ููุทู ููุฏุณุฉ ุงูููุซูููุฉ

### 4.1 ุญุณุงุจ MTBF

```python
def calculate_mtbf(asset_id: UUID = None, category_id: UUID = None, 
                   period_start: date = None, period_end: date = None) -> dict:
    """
    ุญุณุงุจ ูุชูุณุท ุงูููุช ุจูู ุงูุฃุนุทุงู (Mean Time Between Failures)
    
    MTBF = ุฅุฌูุงูู ููุช ุงูุชุดุบูู / ุนุฏุฏ ุงูุฃุนุทุงู
    """
    query = AssetFailure.query
    
    if asset_id:
        query = query.filter_by(asset_id=asset_id)
    if category_id:
        query = query.join(Asset).filter(Asset.category_id == category_id)
    if period_start:
        query = query.filter(AssetFailure.failure_date >= period_start)
    if period_end:
        query = query.filter(AssetFailure.failure_date <= period_end)
    
    failures = query.order_by(AssetFailure.failure_date).all()
    
    if len(failures) < 2:
        return {'mtbf_hours': None, 'mtbf_days': None, 'message': 'ุจูุงูุงุช ุบูุฑ ูุงููุฉ'}
    
    # ุญุณุงุจ ุงููุชุฑุงุช ุจูู ุงูุฃุนุทุงู
    intervals = []
    for i in range(1, len(failures)):
        interval = (failures[i].failure_date - failures[i-1].repair_date).total_seconds() / 3600
        intervals.append(interval)
    
    mtbf_hours = sum(intervals) / len(intervals)
    
    return {
        'mtbf_hours': round(mtbf_hours, 2),
        'mtbf_days': round(mtbf_hours / 24, 2),
        'failure_count': len(failures),
        'period': f'{period_start} - {period_end}' if period_start else 'all time',
        'reliability': calculate_reliability(mtbf_hours)
    }


def calculate_reliability(mtbf_hours: float, mission_time: float = 720) -> float:
    """
    ุญุณุงุจ ุงูููุซูููุฉ (ุงุญุชูุงู ุนุฏู ุงููุดู ุฎูุงู ูุชุฑุฉ ูุนููุฉ)
    
    R(t) = e^(-t/MTBF)
    
    Args:
        mtbf_hours: ูุชูุณุท ุงูููุช ุจูู ุงูุฃุนุทุงู
        mission_time: ุงููุชุฑุฉ ุงููุทููุจุฉ (ุงูุชุฑุงุถู: ุดูุฑ = 720 ุณุงุนุฉ)
    """
    import math
    if mtbf_hours <= 0:
        return 0
    return round(math.exp(-mission_time / mtbf_hours) * 100, 2)
```

### 4.2 ุชุญููู ุงูุณุจุจ ุงูุฌุฐุฑู

```python
def analyze_root_causes(asset_id: UUID = None, category_id: UUID = None,
                        period_months: int = 12) -> dict:
    """
    ุชุญููู ุงูุฃุณุจุงุจ ุงูุฌุฐุฑูุฉ ููุฃุนุทุงู (Pareto Analysis)
    """
    period_start = date.today() - timedelta(days=period_months * 30)
    
    query = db.session.query(
        AssetFailure.root_cause,
        func.count(AssetFailure.id).label('count'),
        func.sum(AssetFailure.downtime_hours).label('total_downtime'),
        func.sum(CMWorkOrder.total_cost).label('total_cost')
    ).join(CMWorkOrder)
    
    if asset_id:
        query = query.filter(AssetFailure.asset_id == asset_id)
    if category_id:
        query = query.join(Asset).filter(Asset.category_id == category_id)
    
    query = query.filter(AssetFailure.failure_date >= period_start)
    query = query.group_by(AssetFailure.root_cause)
    query = query.order_by(func.count(AssetFailure.id).desc())
    
    results = query.all()
    
    # ุญุณุงุจ ุงููุณุจ ุงูุชุฑุงูููุฉ (Pareto)
    total_failures = sum(r.count for r in results)
    cumulative = 0
    analysis = []
    
    for r in results:
        cumulative += r.count
        analysis.append({
            'root_cause': r.root_cause,
            'count': r.count,
            'percentage': round(r.count / total_failures * 100, 1),
            'cumulative_percentage': round(cumulative / total_failures * 100, 1),
            'total_downtime_hours': r.total_downtime or 0,
            'total_cost': float(r.total_cost or 0)
        })
    
    # ุชุญุฏูุฏ ุงูุฃุณุจุงุจ ุงูุฑุฆูุณูุฉ (80/20)
    vital_few = [a for a in analysis if a['cumulative_percentage'] <= 80]
    
    return {
        'analysis': analysis,
        'vital_few': vital_few,
        'total_failures': total_failures,
        'recommendation': generate_improvement_recommendations(vital_few)
    }
```

---

## 5. ููุทู ุงูุชูุงูู ุงููุญุงุณุจู

### 5.1 ูููุฏ ุงูุฃุตูู

```python
def create_asset_purchase_entry(asset: Asset) -> JournalEntry:
    """
    ุฅูุดุงุก ููุฏ ุดุฑุงุก ุฃุตู
    
    ูู ุญู/ ุงูุฃุตูู ุงูุซุงุจุชุฉ (ุญุณุจ ุงููุฆุฉ)
        ุฅูู ุญู/ ุงูููุฏูุฉ / ุงูุฏุงุฆููู
    """
    account_mapping = {
        'transformer': '1401',      # ูุญููุงุช
        'meter': '1402',            # ุนุฏุงุฏุงุช
        'cable': '1403',            # ูุงุจูุงุช
        'switchgear': '1404',       # ููุงุทุน
        'solar_panel': '1405',      # ุฃููุงุญ ุดูุณูุฉ
        'generator': '1406',        # ูููุฏุงุช
        'vehicle': '1407',          # ูุฑูุจุงุช
        'equipment': '1408',        # ูุนุฏุงุช
        'furniture': '1409',        # ุฃุซุงุซ
        'computer': '1410',         # ุญุงุณุจุงุช
    }
    
    asset_account = account_mapping.get(asset.category.code, '1400')
    
    return create_journal_entry(
        business_id=asset.business_id,
        entry_date=asset.acquisition_date,
        description=f'ุดุฑุงุก ุฃุตู: {asset.name} ({asset.code})',
        lines=[
            {'account_code': asset_account, 'debit': asset.acquisition_cost, 'credit': 0},
            {'account_code': '1101', 'debit': 0, 'credit': asset.acquisition_cost}  # ุงูููุฏูุฉ
        ],
        reference_type='asset_purchase',
        reference_id=asset.id
    )


def create_depreciation_journal_entry(business_id: UUID, period: str,
                                      entries: list, total: Decimal) -> JournalEntry:
    """
    ุฅูุดุงุก ููุฏ ุงูุฅููุงู ุงูุดูุฑู ุงููุฌูุน
    
    ูู ุญู/ ูุตุฑูู ุงูุฅููุงู (ุญุณุจ ุงููุฆุฉ)
        ุฅูู ุญู/ ูุฌูุน ุงูุฅููุงู (ุญุณุจ ุงููุฆุฉ)
    """
    # ุชุฌููุน ุญุณุจ ุงููุฆุฉ
    by_category = {}
    for entry in entries:
        cat = entry.asset.category.code
        if cat not in by_category:
            by_category[cat] = Decimal('0')
        by_category[cat] += entry.depreciation_amount
    
    lines = []
    for cat, amount in by_category.items():
        expense_account = f'54{cat[-2:]}'  # ูุตุฑูู ุงูุฅููุงู
        accum_account = f'15{cat[-2:]}'    # ูุฌูุน ุงูุฅููุงู
        
        lines.append({'account_code': expense_account, 'debit': amount, 'credit': 0})
        lines.append({'account_code': accum_account, 'debit': 0, 'credit': amount})
    
    return create_journal_entry(
        business_id=business_id,
        entry_date=get_period_end_date(period),
        description=f'ุฅููุงู ุงูุฃุตูู ุงูุซุงุจุชุฉ - {period}',
        lines=lines,
        reference_type='depreciation',
        reference_id=None
    )


def create_maintenance_expense_entry(work_order, cost: Decimal) -> JournalEntry:
    """
    ุฅูุดุงุก ููุฏ ูุตุฑูู ุตูุงูุฉ
    
    ูู ุญู/ ูุตุฑูู ุงูุตูุงูุฉ
        ุฅูู ุญู/ ุงูููุฏูุฉ / ุงููุฎุฒูู
    """
    asset = work_order.asset
    
    lines = [
        {
            'account_code': '5501',  # ูุตุฑูู ุงูุตูุงูุฉ
            'debit': cost,
            'credit': 0,
            'cost_center': asset.cost_center_id
        }
    ]
    
    # ุชูุณูู ุงูุชูููุฉ (ููุงุฏ + ุนูุงูุฉ)
    if work_order.materials_cost > 0:
        lines.append({
            'account_code': '1301',  # ุงููุฎุฒูู
            'debit': 0,
            'credit': work_order.materials_cost
        })
    
    if work_order.labor_cost > 0:
        lines.append({
            'account_code': '1101',  # ุงูููุฏูุฉ
            'debit': 0,
            'credit': work_order.labor_cost
        })
    
    return create_journal_entry(
        business_id=asset.business_id,
        entry_date=date.today(),
        description=f'ูุตุฑูู ุตูุงูุฉ - {work_order.work_order_number}',
        lines=lines,
        reference_type='maintenance',
        reference_id=work_order.id
    )
```


---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ ูููุธุงู

### ูุนูููุงุช ุงููุณุชูุฏุน

| ุงูุนูุตุฑ | ุงููููุฉ |
|--------|--------|
| **ุงุณู ุงููุณุชูุฏุน** | `assets-system` |
| **ุงููููุฐ API** | 3003 |
| **ุงููููุฐ Web** | 4203 |
| **ุจุงุฏุฆุฉ ุงูุฌุฏุงูู** | `asset_` |
| **ูุณุงุฑ API** | `/api/v1/assets` |

### ูููู ุงููุณุชูุฏุน

```
assets-system/
โโโ apps/
โ   โโโ web/                          # Angular Frontend
โ   โ   โโโ src/app/features/
โ   โ   โ   โโโ dashboard/
โ   โ   โ   โโโ assets/
โ   โ   โ   โโโ categories/
โ   โ   โ   โโโ depreciation/
โ   โ   โ   โโโ maintenance/
โ   โ   โ   โ   โโโ preventive/
โ   โ   โ   โ   โโโ corrective/
โ   โ   โ   โโโ work-orders/
โ   โ   โ   โโโ technicians/
โ   โ   โ   โโโ spare-parts/
โ   โ   โ   โโโ reports/
โ   โ   โโโ project.json
โ   โ
โ   โโโ api/                          # NestJS Backend
โ       โโโ src/modules/
โ       โ   โโโ assets/
โ       โ   โโโ categories/
โ       โ   โโโ depreciation/
โ       โ   โโโ maintenance/
โ       โ   โโโ work-orders/
โ       โ   โโโ technicians/
โ       โ   โโโ spare-parts/
โ       โโโ project.json
โ
โโโ prisma/schema.prisma
โโโ package.json
```

### Prisma Schema ุงูุฃุณุงุณู

```prisma
// ==================== Asset System Tables ====================

model asset_categories {
  id                  String   @id @default(uuid()) @db.Uuid
  code                String   @unique @db.VarChar(20)
  name                String   @db.VarChar(100)
  nameEn              String?  @map("name_en") @db.VarChar(100)
  parentId            String?  @map("parent_id") @db.Uuid
  depreciationMethod  String   @default("straight_line") @map("depreciation_method")
  defaultUsefulLife   Int      @default(60) @map("default_useful_life")
  isActive            Boolean  @default(true) @map("is_active")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  
  parent              asset_categories?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children            asset_categories[] @relation("CategoryHierarchy")
  assets              asset_assets[]
  
  @@map("asset_categories")
}

model asset_assets {
  id                      String    @id @default(uuid()) @db.Uuid
  code                    String    @unique @db.VarChar(50)
  name                    String    @db.VarChar(200)
  categoryId              String    @map("category_id") @db.Uuid
  stationId               String?   @map("station_id") @db.Uuid
  serialNumber            String?   @map("serial_number") @db.VarChar(100)
  manufacturer            String?   @db.VarChar(100)
  model                   String?   @db.VarChar(100)
  acquisitionDate         DateTime  @map("acquisition_date") @db.Date
  acquisitionCost         Decimal   @map("acquisition_cost") @db.Decimal(15, 2)
  salvageValue            Decimal   @default(0) @map("salvage_value") @db.Decimal(15, 2)
  usefulLifeMonths        Int       @map("useful_life_months")
  currentValue            Decimal   @map("current_value") @db.Decimal(15, 2)
  accumulatedDepreciation Decimal   @default(0) @map("accumulated_depreciation") @db.Decimal(15, 2)
  monthlyDepreciation     Decimal   @map("monthly_depreciation") @db.Decimal(15, 2)
  status                  String    @default("active") @db.VarChar(20)
  condition               String    @default("good") @db.VarChar(20)
  warrantyEndDate         DateTime? @map("warranty_end_date") @db.Date
  lastMaintenanceDate     DateTime? @map("last_maintenance_date") @db.Date
  createdAt               DateTime  @default(now()) @map("created_at")
  updatedAt               DateTime  @updatedAt @map("updated_at")
  deletedAt               DateTime? @map("deleted_at")
  
  category                asset_categories @relation(fields: [categoryId], references: [id])
  depreciationHistory     asset_depreciation[]
  maintenanceHistory      asset_work_orders[]
  
  @@index([categoryId])
  @@index([stationId])
  @@index([status])
  @@map("asset_assets")
}

model asset_depreciation {
  id                      String   @id @default(uuid()) @db.Uuid
  assetId                 String   @map("asset_id") @db.Uuid
  period                  String   @db.VarChar(7)
  depreciationAmount      Decimal  @map("depreciation_amount") @db.Decimal(15, 2)
  accumulatedDepreciation Decimal  @map("accumulated_depreciation") @db.Decimal(15, 2)
  bookValueBefore         Decimal  @map("book_value_before") @db.Decimal(15, 2)
  bookValueAfter          Decimal  @map("book_value_after") @db.Decimal(15, 2)
  journalEntryId          String?  @map("journal_entry_id") @db.Uuid
  createdAt               DateTime @default(now()) @map("created_at")
  
  asset                   asset_assets @relation(fields: [assetId], references: [id])
  
  @@unique([assetId, period])
  @@map("asset_depreciation")
}

model asset_pm_plans {
  id                String   @id @default(uuid()) @db.Uuid
  code              String   @unique @db.VarChar(50)
  name              String   @db.VarChar(200)
  assetId           String?  @map("asset_id") @db.Uuid
  categoryId        String?  @map("category_id") @db.Uuid
  frequencyType     String   @map("frequency_type") @db.VarChar(20)
  frequencyValue    Int      @map("frequency_value")
  estimatedDuration Decimal? @map("estimated_duration") @db.Decimal(5, 2)
  checklist         Json     @default("[]")
  isActive          Boolean  @default(true) @map("is_active")
  lastGeneratedAt   DateTime? @map("last_generated_at")
  nextDueDate       DateTime? @map("next_due_date") @db.Date
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  @@map("asset_pm_plans")
}

model asset_work_orders {
  id              String    @id @default(uuid()) @db.Uuid
  workOrderNumber String    @unique @map("work_order_number") @db.VarChar(50)
  assetId         String    @map("asset_id") @db.Uuid
  type            String    @db.VarChar(20)
  priority        String    @default("medium") @db.VarChar(20)
  status          String    @default("pending") @db.VarChar(20)
  description     String?   @db.Text
  rootCause       String?   @map("root_cause") @db.Text
  actionTaken     String?   @map("action_taken") @db.Text
  scheduledDate   DateTime? @map("scheduled_date") @db.Date
  startedAt       DateTime? @map("started_at")
  completedAt     DateTime? @map("completed_at")
  estimatedHours  Decimal?  @map("estimated_hours") @db.Decimal(5, 2)
  actualHours     Decimal?  @map("actual_hours") @db.Decimal(5, 2)
  laborCost       Decimal   @default(0) @map("labor_cost") @db.Decimal(15, 2)
  materialsCost   Decimal   @default(0) @map("materials_cost") @db.Decimal(15, 2)
  totalCost       Decimal   @default(0) @map("total_cost") @db.Decimal(15, 2)
  assignedTo      String?   @map("assigned_to") @db.Uuid
  completedBy     String?   @map("completed_by") @db.Uuid
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  
  asset           asset_assets @relation(fields: [assetId], references: [id])
  parts           asset_work_order_parts[]
  
  @@index([assetId])
  @@index([status])
  @@index([type])
  @@map("asset_work_orders")
}

model asset_technicians {
  id            String   @id @default(uuid()) @db.Uuid
  userId        String   @map("user_id") @db.Uuid
  employeeId    String?  @map("employee_id") @db.Uuid
  specialization String  @db.VarChar(100)
  skills        Json     @default("[]")
  certifications Json    @default("[]")
  rating        Decimal  @default(0) @db.Decimal(3, 2)
  isAvailable   Boolean  @default(true) @map("is_available")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  
  @@map("asset_technicians")
}

model asset_spare_parts {
  id            String   @id @default(uuid()) @db.Uuid
  code          String   @unique @db.VarChar(50)
  name          String   @db.VarChar(200)
  categoryId    String?  @map("category_id") @db.Uuid
  unit          String   @db.VarChar(20)
  minStock      Int      @default(0) @map("min_stock")
  maxStock      Int?     @map("max_stock")
  currentStock  Int      @default(0) @map("current_stock")
  unitCost      Decimal  @default(0) @map("unit_cost") @db.Decimal(15, 2)
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  
  @@map("asset_spare_parts")
}

model asset_work_order_parts {
  id            String   @id @default(uuid()) @db.Uuid
  workOrderId   String   @map("work_order_id") @db.Uuid
  sparePartId   String   @map("spare_part_id") @db.Uuid
  quantity      Int
  unitCost      Decimal  @map("unit_cost") @db.Decimal(15, 2)
  totalCost     Decimal  @map("total_cost") @db.Decimal(15, 2)
  createdAt     DateTime @default(now()) @map("created_at")
  
  workOrder     asset_work_orders @relation(fields: [workOrderId], references: [id])
  
  @@map("asset_work_order_parts")
}
```

### Environment Variables

```env
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/electricity_management"
JWT_SECRET="assets-system-secret-key"
API_PORT=3003
CORE_API_URL="http://localhost:3001/api/v1"
DEVELOPER_API_URL="http://localhost:3002/api/v1"
INVENTORY_API_URL="http://localhost:3006/api/v1"
```
